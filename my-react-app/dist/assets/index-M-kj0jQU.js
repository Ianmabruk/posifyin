import{a as rt,b as nt,g as it,r as x,u as Z,c as ct,R as Je,d as F,B as ot,N as Y,e as dt}from"./vendor-Ct1st1Nj.js";import{S as mt,A as me,P as xt,C as Ae,a as W,L as _e,T as ae,U as ge,b as Ge,Z as Ve,c as We,d as Q,X as ye,e as V,f as Ne,M as De,g as fe,D as de,h as Ye,i as Qe,j as Ie,k as J,l as ut,m as ht,n as Ze,o as ve,p as _,q as pt,r as gt,E as ft,s as Ue,t as we,u as le,v as be,w as Fe,x as ie,B as Le,I as bt,y as je,z as ce,F as Ee,G as jt,H as yt,J as Xe,K as Nt,N as pe,O as vt,Q as wt,R as St,V as kt,W as Ct}from"./icons-JioAc6SH.js";(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))g(r);new MutationObserver(r=>{for(const h of r)if(h.type==="childList")for(const a of h.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&g(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const h={};return r.integrity&&(h.integrity=r.integrity),r.referrerPolicy&&(h.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?h.credentials="include":r.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function g(r){if(r.ep)return;r.ep=!0;const h=n(r);fetch(r.href,h)}})();var ke={exports:{}},te={};var qe;function Pt(){if(qe)return te;qe=1;var t=rt(),p=Symbol.for("react.element"),n=Symbol.for("react.fragment"),g=Object.prototype.hasOwnProperty,r=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,h={key:!0,ref:!0,__self:!0,__source:!0};function a(d,o,i){var m,b={},l=null,N=null;i!==void 0&&(l=""+i),o.key!==void 0&&(l=""+o.key),o.ref!==void 0&&(N=o.ref);for(m in o)g.call(o,m)&&!h.hasOwnProperty(m)&&(b[m]=o[m]);if(d&&d.defaultProps)for(m in o=d.defaultProps,o)b[m]===void 0&&(b[m]=o[m]);return{$$typeof:p,type:d,key:l,ref:N,props:b,_owner:r.current}}return te.Fragment=n,te.jsx=a,te.jsxs=a,te}var $e;function At(){return $e||($e=1,ke.exports=Pt()),ke.exports}var e=At(),xe={},Me;function Dt(){if(Me)return xe;Me=1;var t=nt();return xe.createRoot=t.createRoot,xe.hydrateRoot=t.hydrateRoot,xe}var Et=Dt();const Tt=it(Et),et=x.createContext(),G=()=>x.useContext(et),It=({children:t})=>{const[p,n]=x.useState(()=>{try{const m=localStorage.getItem("user");return m?JSON.parse(m):null}catch(m){return console.error("Error parsing user data:",m),localStorage.removeItem("user"),null}}),[g,r]=x.useState(!0),[h,a]=x.useState(!1);x.useEffect(()=>{const m=()=>{try{const N=localStorage.getItem("token"),s=localStorage.getItem("user");if(N&&s){const u=JSON.parse(s);u.plan==="ultra"?u.role!=="admin"&&(u.role="admin",u.active=!0,u.packageType="ultra",localStorage.setItem("user",JSON.stringify(u))):u.plan==="basic"&&u.role!=="cashier"&&(u.role="cashier",u.active=!0,u.packageType="basic",localStorage.setItem("user",JSON.stringify(u))),u.plan&&!u.active&&(u.active=!0,localStorage.setItem("user",JSON.stringify(u))),n(u)}else n(null)}catch(N){console.error("Error initializing auth:",N),n(null),localStorage.removeItem("user"),localStorage.removeItem("token")}finally{r(!1),a(!0)}};m();const b=N=>{(N.key==="user"||N.key==="token")&&setTimeout(()=>{m()},50)},l=()=>{setTimeout(()=>{m()},100)};return window.addEventListener("storage",b),window.addEventListener("localStorageUpdated",l),()=>{window.removeEventListener("storage",b),window.removeEventListener("localStorageUpdated",l)}},[]);const d=(m,b)=>{try{localStorage.setItem("token",m),localStorage.setItem("user",JSON.stringify(b)),n(b)}catch(l){throw console.error("Error during login:",l),l}},o=async m=>{try{const b=localStorage.getItem("token"),l=window.location.hostname==="localhost"?"http://localhost:5001/api":"/api";localStorage.setItem("user",JSON.stringify(m)),n(m);try{const N=await fetch(`${l}/users/${m.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},body:JSON.stringify(m)});if(!N.ok)throw new Error("Backend not available");const s=await N.json();return s.token&&localStorage.setItem("token",s.token),s.user&&(localStorage.setItem("user",JSON.stringify(s.user)),n(s.user)),s}catch(N){if(console.warn("Backend not available, using client-side update:",N),!b){const s=btoa(JSON.stringify({id:m.id,email:m.email,role:m.role,plan:m.plan}));localStorage.setItem("token",s)}return{user:m,token:b||btoa(JSON.stringify(m))}}}catch(b){throw console.error("Failed to update user:",b),b}},i=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),n(null)};return e.jsx(et.Provider,{value:{user:p,login:d,updateUser:o,logout:i,loading:g,isInitialized:h},children:t})};function Lt(){const t=Z(),[p,n]=x.useState(!1),[g,r]=x.useState(0),h=[{title:"1. Sign Up & Choose Plan",desc:"Create your account and select between Basic (KSH 900) or Ultra (KSH 1,600) package",image:"ðŸ“",details:"First user becomes Admin automatically. Choose Ultra for full features including Recipe Builder and User Management."},{title:"2. Add Raw Materials",desc:"Stock your inventory with raw ingredients like fish, oil, breadcrumbs, salt, etc.",image:"ðŸ“¦",details:'Enter product name, cost, quantity, and unit. Mark items as "expense-only" to hide from cashiers.'},{title:"3. Create Recipes (Ultra Only)",desc:"Build composite products using the Recipe/BOM Builder",image:"ðŸ½ï¸",details:"Example: Fish Fingers = 0.02kg Nile Perch + 0.01L Oil + 0.004kg Breadcrumbs. System auto-calculates COGS and profit margin."},{title:"4. Add Cashiers (Ultra Only)",desc:"Invite team members and set their permissions",image:"ðŸ‘¥",details:"Enter name and email. Set permissions: View Sales, View Inventory, View Expenses, Manage Products. Default password: changeme123"},{title:"5. Make Sales",desc:"Cashiers use the POS to sell products",image:"ðŸ’°",details:"Search products, add to cart, select payment method (Cash/M-Pesa/Card), complete sale. Stock automatically deducted!"},{title:"6. Automatic Stock Deduction",desc:"When selling composite products, ingredients are auto-deducted",image:"âš¡",details:"Sell 1 Fish Finger â†’ System deducts 0.02kg fish, 0.01L oil, 0.004kg breadcrumbs. COGS calculated automatically!"},{title:"7. Track Analytics",desc:"Monitor sales, profit, expenses in real-time",image:"ðŸ“Š",details:"View daily/weekly sales, gross profit, net profit, COGS breakdown. Admin sees full analytics, cashiers see limited data."},{title:"8. Manage Expenses",desc:"Track manual expenses and automatic ingredient costs",image:"ðŸ’¸",details:"Add manual expenses (rent, utilities, salaries). System auto-creates expenses when expense-only items are used in recipes."}],a=[{icon:W,title:"Smart Inventory",desc:"Track raw materials & composite products with automatic stock deduction"},{icon:_e,title:"Recipe Builder",desc:"Create bundled products with BOM and auto-calculate COGS"},{icon:ae,title:"Real-time Analytics",desc:"Monitor sales, profit margins, and expenses in real-time"},{icon:ge,title:"User Management",desc:"Add cashiers with custom permissions and role-based access"},{icon:Ge,title:"Secure & Reliable",desc:"JWT authentication with role-based security"},{icon:Ae,title:"Advanced Reports",desc:"Daily, weekly summaries with profit/loss tracking"}],d=[{name:"Basic",price:900,icon:Ve,popular:!1,features:["Cashier Dashboard","Basic Inventory","Sales Tracking","Daily/Weekly Reports","Single User","Email Support"]},{name:"Ultra",price:1600,icon:We,popular:!0,features:["Admin + Cashier Dashboard","Full Inventory Management","Recipe/BOM Builder","Auto Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Unlimited Users","Priority Support"]}];return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-blue-600 via-purple-600 to-pink-600",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("nav",{className:"relative z-10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"P"})}),e.jsx("span",{className:"text-2xl font-bold text-white",children:"POSify"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t("/login"),className:"text-white hover:text-blue-100 font-medium",children:"Login"}),e.jsx("button",{onClick:()=>t("/signup"),className:"bg-white text-blue-600 px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all",children:"Get Started"})]})]})}),e.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto px-6 py-20 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-white text-sm font-medium mb-6",children:[e.jsx(mt,{className:"w-4 h-4 fill-yellow-300 text-yellow-300"}),"Trusted by 500+ businesses"]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-6 leading-tight",children:["Modern POS System",e.jsx("br",{}),e.jsx("span",{className:"text-blue-200",children:"Built for Growth"})]}),e.jsx("p",{className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:"Complete inventory management with recipe builder, automatic stock deduction, and real-time analytics. Everything you need to run your business efficiently."}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("button",{onClick:()=>t("/signup"),className:"bg-white text-blue-600 px-8 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all flex items-center gap-2",children:["Start Free Trial",e.jsx(me,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:()=>n(!0),className:"border-2 border-white text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-white/10 transition-all flex items-center gap-2",children:[e.jsx(xt,{className:"w-5 h-5"}),"Watch Demo"]})]}),e.jsx("p",{className:"text-blue-200 text-sm mt-4",children:"No credit card required â€¢ 14-day free trial"})]}),e.jsx("div",{className:"relative z-10 max-w-6xl mx-auto px-6 pb-20",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-2 transform hover:scale-105 transition-all duration-500",children:e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-8 aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ae,{className:"w-24 h-24 text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Dashboard Preview"})]})})})})]}),e.jsx("div",{className:"py-20 px-6 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Everything You Need"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Powerful features to streamline your business operations"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:a.map((o,i)=>{const m=o.icon;return e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl transition-all transform hover:-translate-y-2",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center mb-4",children:e.jsx(m,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:o.title}),e.jsx("p",{className:"text-gray-600",children:o.desc})]},i)})})]})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Simple, Transparent Pricing"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Choose the plan that fits your business"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto",children:d.map((o,i)=>{const m=o.icon;return e.jsxs("div",{className:`relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all transform hover:scale-105 ${o.popular?"ring-4 ring-blue-600":""}`,children:[o.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-bold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${o.popular?"bg-gradient-to-br from-blue-600 to-purple-600":"bg-gradient-to-br from-green-600 to-teal-600"}`,children:e.jsx(m,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:o.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Package"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("span",{className:"text-5xl font-bold",children:["KSH ",o.price]}),e.jsx("span",{className:"text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-3 mb-8",children:o.features.map((b,l)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-gray-700",children:b})]},l))}),e.jsx("button",{onClick:()=>t("/signup"),className:`w-full py-4 rounded-xl font-bold text-lg transition-all ${o.popular?"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:shadow-xl transform hover:scale-105":"bg-gray-100 text-gray-900 hover:bg-gray-200"}`,children:"Get Started"})]},i)})})]})}),e.jsx("div",{className:"py-20 px-6 bg-gradient-to-br from-blue-600 to-purple-600",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-8 text-center text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"500+"}),e.jsx("div",{className:"text-blue-200",children:"Active Businesses"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"50K+"}),e.jsx("div",{className:"text-blue-200",children:"Transactions/Day"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"99.9%"}),e.jsx("div",{className:"text-blue-200",children:"Uptime"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"24/7"}),e.jsx("div",{className:"text-blue-200",children:"Support"})]})]})})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Ready to Transform Your Business?"}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Join hundreds of businesses already using POSify to streamline their operations"}),e.jsxs("button",{onClick:()=>t("/signup"),className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-12 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all inline-flex items-center gap-2",children:["Start Your Free Trial",e.jsx(me,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-4",children:"No credit card required â€¢ Cancel anytime"})]})}),e.jsx("footer",{className:"bg-gray-900 text-gray-400 py-12 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"P"})}),e.jsx("span",{className:"text-xl font-bold text-white",children:"POSify"})]}),e.jsx("p",{className:"mb-4",children:"Modern POS System for Modern Businesses"}),e.jsx("p",{className:"text-sm",children:"Â© 2024 POSify. All rights reserved."})]})}),p&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"How POSify Works"}),e.jsx("button",{onClick:()=>{n(!1),r(0)},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(ye,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Step ",g+1," of ",h.length]}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[Math.round((g+1)/h.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${(g+1)/h.length*100}%`}})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:h[g].image}),e.jsx("h3",{className:"text-3xl font-bold mb-3",children:h[g].title}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:h[g].desc}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-6 text-left",children:e.jsx("p",{className:"text-gray-700",children:h[g].details})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("button",{onClick:()=>r(Math.max(0,g-1)),disabled:g===0,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),g<h.length-1?e.jsxs("button",{onClick:()=>r(g+1),className:"btn-primary flex items-center gap-2",children:["Next Step",e.jsx(me,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:()=>{n(!1),r(0),t("/signup")},className:"btn-primary bg-gradient-to-r from-blue-600 to-purple-600 flex items-center gap-2",children:["Get Started Now",e.jsx(me,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-8",children:h.map((o,i)=>e.jsx("button",{onClick:()=>r(i),className:`w-2 h-2 rounded-full transition-all ${i===g?"w-8 bg-blue-600":"bg-gray-300 hover:bg-gray-400"}`},i))})]})]})})]})}const He={products:[{id:1,name:"Nile Perch",cost:500,price:800,quantity:10,unit:"kg",category:"raw",recipe:null,image:"",visibleToCashier:!0,expenseOnly:!1},{id:2,name:"Cooking Oil",cost:200,price:300,quantity:5,unit:"L",category:"raw",recipe:null,image:"",visibleToCashier:!0,expenseOnly:!1}],sales:[],expenses:[],users:[],reminders:[],stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:2},settings:{lockTimeout:3e5,currency:"KSH",logo:"",companyName:"",address:""},serviceFees:[],discounts:[],creditRequests:[],timeEntries:[],categories:[],batches:[],production:[],priceHistory:[]},re=(t,p)=>{try{const n=JSON.stringify(p);localStorage.setItem(t,n)}catch(n){console.warn(`Failed to save to localStorage for key "${t}":`,n)}},ne=t=>{try{const p=localStorage.getItem(t);if(p===null){const n=He[t]||[];return re(t,n),n}return JSON.parse(p)}catch(p){return console.warn(`Failed to load from localStorage for key "${t}":`,p),He[t]||[]}},Ot="/api",Rt=()=>localStorage.getItem("token"),O=async(t,p={})=>{const n=Rt(),g={...p,headers:{"Content-Type":"application/json",...n&&{Authorization:`Bearer ${n}`},...p.headers}},h=(a=>a.includes("/products")?"products":a.includes("/sales")?"sales":a.includes("/expenses")?"expenses":a.includes("/users")?"users":a.includes("/reminders")?"reminders":a.includes("/stats")?"stats":a.includes("/settings")?"settings":a.includes("/service-fees")?"serviceFees":a.includes("/discounts")?"discounts":a.includes("/credit-requests")?"creditRequests":a.includes("/time-entries")?"timeEntries":a.includes("/categories")?"categories":a.includes("/batches")?"batches":a.includes("/production")?"production":a.includes("/price-history")?"priceHistory":null)(t);try{const a=await fetch(`${Ot}${t}`,g);if(t.includes("/auth/")){if(!a.ok){const o=await a.json().catch(()=>({error:"Authentication failed"}));throw new Error(o.error||"Authentication failed")}return await a.json()}if(a.status===401)throw console.warn("Session expired or token invalid. Backend returned 401."),new Error("Session expired. Please login again.");if(a.status===204)return{success:!0,message:"Operation completed successfully"};if(!a.ok&&(p.method==="POST"||p.method==="PUT"||p.method==="DELETE")){const o=await a.json().catch(()=>({error:"Operation failed"}));throw new Error(o.error||`HTTP ${a.status}: ${a.statusText}`)}if(!a.ok)return console.warn(`API request failed: ${t} - ${a.status}`),h?ne(h):Be(t);const d=await a.json();return(!p.method||p.method==="GET")&&h&&Array.isArray(d)&&re(h,d),d}catch(a){if(t.includes("/auth/")||p.method==="POST"||p.method==="PUT"||p.method==="DELETE")throw a;return console.warn(`API request error: ${t}`,a),h?ne(h):Be(t)}},Be=t=>t.includes("/products")?[]:t.includes("/sales")?[]:t.includes("/expenses")?[]:t.includes("/users")?[]:t.includes("/reminders")?[]:t.includes("/stats")?{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0}:t.includes("/settings")?{lockTimeout:3e5,currency:"KSH",logo:"",companyName:"",address:""}:t.includes("/service-fees")?[]:t.includes("/discounts")?[]:t.includes("/credit-requests")?[]:t.includes("/time-entries")?[]:t.includes("/categories")?[]:t.includes("/batches")?[]:t.includes("/production")?[]:t.includes("/price-history")?[]:{},Ce={login:t=>O("/auth/login",{method:"POST",body:JSON.stringify(t)}),signup:t=>O("/auth/signup",{method:"POST",body:JSON.stringify(t)})},K={getAll:()=>O("/products"),create:async t=>{const p=await O("/products",{method:"POST",body:JSON.stringify(t)}),n=ne("products");return n.push(p),re("products",n),p},update:async(t,p)=>{const n=await O(`/products/${t}`,{method:"PUT",body:JSON.stringify(p)}),g=ne("products"),r=g.findIndex(h=>h.id===t);return r!==-1&&(g[r]=n,re("products",g)),n},delete:async t=>{const p=await O(`/products/${t}`,{method:"DELETE"}),g=ne("products").filter(r=>r.id!==t);return re("products",g),p}},oe={getAll:()=>O("/sales"),create:t=>O("/sales",{method:"POST",body:JSON.stringify(t)})},Ke={getAll:()=>O("/expenses"),create:t=>O("/expenses",{method:"POST",body:JSON.stringify(t)})},tt={get:()=>O("/stats")},ue={getAll:()=>O("/users"),create:t=>O("/users",{method:"POST",body:JSON.stringify(t)}),update:(t,p)=>O(`/users/${t}`,{method:"PUT",body:JSON.stringify(p)}),delete:t=>O(`/users/${t}`,{method:"DELETE"})},he={getAll:()=>O("/discounts"),create:t=>O("/discounts",{method:"POST",body:JSON.stringify(t)}),update:(t,p)=>O(`/discounts/${t}`,{method:"PUT",body:JSON.stringify(p)}),delete:t=>O(`/discounts/${t}`,{method:"DELETE"})},Pe={getAll:()=>O("/credit-requests"),create:t=>O("/credit-requests",{method:"POST",body:JSON.stringify(t)}),approve:t=>O(`/credit-requests/${t}/approve`,{method:"POST"}),reject:t=>O(`/credit-requests/${t}/reject`,{method:"POST"})},Te={get:()=>O("/settings"),update:t=>O("/settings",{method:"POST",body:JSON.stringify(t)})};function ze(){const[t,p]=x.useState(!1),[n,g]=x.useState({email:"",password:"",name:"",newPassword:"",confirmPassword:""}),[r,h]=x.useState(""),[a,d]=x.useState(!1),[o,i]=x.useState(!1),m=Z(),{login:b}=G(),l=async N=>{N.preventDefault(),h(""),d(!0);try{if(o){if(n.newPassword!==n.confirmPassword){h("Passwords do not match"),d(!1);return}if(n.newPassword.length<6){h("Password must be at least 6 characters"),d(!1);return}const v=await Ce.login({email:n.email,newPassword:n.newPassword});v.token&&v.user&&(b(v.token,v.user),window.location.href="/cashier");return}let s;try{s=t?await Ce.login({email:n.email,password:n.password}):await Ce.signup(n)}catch{if(console.warn("Backend not available, using client-side auth"),t){const j=localStorage.getItem("user");if(j){const y=JSON.parse(j);if(y.email===n.email)s={token:btoa(JSON.stringify({id:y.id,email:y.email,role:y.role})),user:y};else throw new Error("Invalid credentials")}else throw new Error("No account found. Please sign up first.")}else{const j={id:Date.now(),email:n.email,password:n.password,name:n.name||n.email.split("@")[0],role:"admin",plan:null,price:null,active:!1,createdAt:new Date().toISOString()};s={token:btoa(JSON.stringify({id:j.id,email:j.email,role:j.role})),user:j}}}if(s.needsPasswordSetup){i(!0),g({...n,email:s.email}),h(""),d(!1);return}if(!s||!s.user)throw console.error("Invalid response:",s),new Error("Authentication failed. Please try again.");const u=s.token||btoa(JSON.stringify({id:s.user.id,email:s.user.email,role:s.user.role,plan:s.user.plan}));if(b(u,s.user),s.user.needsPasswordSetup){i(!0),g({...n,email:s.user.email}),h(""),d(!1);return}if(s.user.role==="cashier"&&s.user.addedByAdmin){window.location.href="/cashier";return}!s.user.active||!s.user.plan?m("/subscription"):s.user.role==="admin"?m("/admin"):s.user.role==="cashier"?m("/cashier"):m("/dashboard")}catch(s){h(s.message||"Authentication failed. Please try again.")}finally{d(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center p-4 md:p-6",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-5"}),e.jsxs("div",{className:"card w-full max-w-md shadow-2xl backdrop-blur-sm bg-white/95 border-0 animate-fade-in relative z-10",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8",children:[e.jsx("div",{className:"w-14 h-14 md:w-16 md:h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl mx-auto mb-3 md:mb-4 flex items-center justify-center shadow-lg",children:e.jsx("span",{className:"text-xl md:text-2xl font-bold text-white",children:"POS"})}),e.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:t?"Welcome Back":"Get Started"}),e.jsx("p",{className:"text-gray-600 text-xs md:text-sm",children:t?"Login to your account":"Create your account to continue"})]}),e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[o?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:"Welcome! Please set your password to continue."}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"New Password",className:"input pl-10",value:n.newPassword,onChange:N=>g({...n,newPassword:N.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",className:"input pl-10",value:n.confirmPassword,onChange:N=>g({...n,confirmPassword:N.target.value}),required:!0})]})]}):e.jsxs(e.Fragment,{children:[!t&&e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Full Name",className:"input pl-10",value:n.name,onChange:N=>g({...n,name:N.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(De,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"Email",className:"input pl-10",value:n.email,onChange:N=>g({...n,email:N.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"input pl-10",value:n.password,onChange:N=>g({...n,password:N.target.value}),required:!0})]})]}),r&&e.jsx("div",{className:"text-red-600 text-sm text-center",children:r}),e.jsx("button",{type:"submit",disabled:a,className:"btn-primary w-full text-base md:text-lg py-2.5 md:py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",children:a?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):o?"Set Password":t?"Login":"Sign Up"})]}),!o&&e.jsx("div",{className:"text-center mt-6",children:e.jsx("button",{onClick:()=>p(!t),className:"text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-sm font-semibold transition-all",children:t?"Don't have an account? Sign up":"Already have an account? Login"})})]})]})}function Ut(){const[t,p]=x.useState("ultra"),n=Z(),{user:g,updateUser:r}=G(),h=[{id:"basic",name:"Basic Package",price:900,icon:Ve,color:"from-green-500 to-teal-600",features:["Cashier Dashboard Only","Basic Inventory Management","Sales Tracking","Daily/Weekly Sales Summaries","Basic Profit/Loss View","Limited Email Notifications","Record Products Sold","Single User Access"]},{id:"ultra",name:"Ultra Package",price:1600,icon:We,color:"from-blue-600 to-purple-600",popular:!0,features:["Admin Dashboard + Cashier POS","Full Inventory Management","Recipe/BOM Builder","Composite Products Support","Automatic Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Advanced Analytics","Unlimited Users"]}],a=async()=>{try{const d=h.find(m=>m.id===t),o={...g,role:t==="ultra"?"admin":"cashier",plan:t,price:d.price,active:!0,packageType:t};localStorage.setItem("user",JSON.stringify(o)),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new Event("localStorageUpdated")),await r(o).catch(m=>{console.warn("Auth context update failed, but localStorage updated:",m)}),await new Promise(m=>setTimeout(m,1e3));let i;t==="ultra"?i="/admin":i="/cashier",window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1"?window.location.href=i:n(i,{replace:!0})}catch(d){console.error("Subscription error:",d),alert("Failed to update subscription. Please try again.")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 py-6 md:py-12 px-4 md:px-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8 md:mb-12 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-bold mb-3 md:mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Choose Your Plan"}),e.jsx("p",{className:"text-gray-600 text-base md:text-lg",children:"Select the perfect plan for your business needs"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-6 md:mb-8",children:h.map(d=>{const o=d.icon;return e.jsxs("div",{onClick:()=>p(d.id),className:`card cursor-pointer transition-all transform hover:scale-105 relative ${t===d.id?"ring-4 ring-blue-600 shadow-2xl bg-gradient-to-br from-blue-50 to-purple-50":"hover:shadow-xl"}`,children:[d.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-semibold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-3 md:mb-4",children:[e.jsx("div",{className:`w-10 h-10 md:w-12 md:h-12 rounded-xl bg-gradient-to-br ${d.color} flex items-center justify-center`,children:e.jsx(o,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsx("h3",{className:"text-xl md:text-2xl font-bold",children:d.name})]}),e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsxs("span",{className:"text-3xl md:text-4xl font-bold",children:["KSH ",d.price]}),e.jsx("span",{className:"text-gray-600 text-sm md:text-base",children:"/month"})]}),e.jsx("ul",{className:"space-y-2 md:space-y-3",children:d.features.map((i,m)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(Q,{className:"w-4 h-4 md:w-5 md:h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs md:text-sm",children:i})]},m))})]},d.id)})}),e.jsxs("div",{className:"text-center animate-fade-in",children:[e.jsx("button",{onClick:a,className:"btn-primary w-full md:w-auto px-8 md:px-12 py-3 md:py-4 text-base md:text-lg bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all",children:"Continue to Dashboard"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 mt-3 md:mt-4",children:"Start your journey today â€¢ Cancel anytime"})]})]})})}function Ft(){const[t,p]=x.useState({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]}),[n,g]=x.useState(!0),[r,h]=x.useState(null);x.useEffect(()=>{a()},[]);const a=async()=>{try{h(null);const[i,m]=await Promise.all([tt.get(),oe.getAll()]),b={totalSales:i?.totalSales||0,totalExpenses:i?.totalExpenses||0,profit:i?.profit||0,grossProfit:i?.grossProfit||0,netProfit:i?.netProfit||0,totalCOGS:i?.totalCOGS||0,dailySales:i?.dailySales||0,weeklySales:i?.weeklySales||0,productCount:i?.productCount||0},l=Array.isArray(m)?m:[];p({stats:b,recentSales:l.slice(-10).reverse()})}catch(i){console.error("Failed to load data:",i),h(i.message),p({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]})}finally{g(!1)}};if(n)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(r&&t.stats.totalSales===0&&t.recentSales.length===0)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(fe,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Unable to Load Dashboard"}),e.jsx("p",{className:"text-red-600 mb-4",children:r}),e.jsx("button",{onClick:a,className:"btn-primary",children:"Retry"})]})});const d=[{label:"Total Sales",value:`KSH ${t.stats.totalSales?.toLocaleString()||0}`,icon:de,color:"from-green-500 to-emerald-600",change:"+12.5%"},{label:"Gross Profit",value:`KSH ${t.stats.grossProfit?.toLocaleString()||0}`,icon:ae,color:"from-blue-500 to-indigo-600",change:"+8.2%"},{label:"Total COGS",value:`KSH ${t.stats.totalCOGS?.toLocaleString()||0}`,icon:W,color:"from-orange-500 to-red-600",change:"+5.1%"},{label:"Net Profit",value:`KSH ${t.stats.netProfit?.toLocaleString()||0}`,icon:ae,color:"from-purple-500 to-pink-600",change:"+15.3%"}],o=[{label:"Daily Sales",value:`KSH ${t.stats.dailySales?.toLocaleString()||0}`,icon:Ye,color:"bg-blue-50 text-blue-600"},{label:"Weekly Sales",value:`KSH ${t.stats.weeklySales?.toLocaleString()||0}`,icon:ae,color:"bg-green-50 text-green-600"},{label:"Total Expenses",value:`KSH ${t.stats.totalExpenses?.toLocaleString()||0}`,icon:Qe,color:"bg-red-50 text-red-600"},{label:"Products",value:t.stats.productCount||0,icon:W,color:"bg-purple-50 text-purple-600"}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(d||[]).map((i,m)=>{const b=i?.icon;return b?e.jsxs("div",{className:`card bg-gradient-to-br ${i.color} text-white border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx(b,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-sm font-semibold bg-white/20 px-2 py-1 rounded-full",children:i.change})]}),e.jsx("p",{className:"text-sm text-white/80 mb-1",children:i.label}),e.jsx("p",{className:"text-2xl font-bold",children:i.value})]},m):null})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(o||[]).map((i,m)=>{const b=i?.icon;return b?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${i.color} flex items-center justify-center`,children:e.jsx(b,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:i.label}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:i.value})]})]})},m):null})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Sales"}),e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),!t.recentSales||t.recentSales.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(fe,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No sales yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:(t.recentSales||[]).map(i=>i?e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:i.createdAt?new Date(i.createdAt).toLocaleString():"N/A"}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[Array.isArray(i.items)?i.items.length:0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:i.paymentMethod||"N/A"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",i.total?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",i.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",i.profit?.toLocaleString()||0]})]},i.id||Math.random()):null)})]})})]})]})}function qt(){const[t,p]=x.useState([]),[n,g]=x.useState("all"),[r,h]=x.useState(""),[a,d]=x.useState(!1),[o,i]=x.useState(!1),[m,b]=x.useState(null),[l,N]=x.useState({name:"",price:"",cost:"",quantity:"",unit:"pcs",category:"raw",expenseOnly:!1,image:"",visibleToCashier:!0}),[s,u]=x.useState({name:"",price:"",cost:"",quantity:"",unit:"pcs",category:"raw",expenseOnly:!1,image:"",visibleToCashier:!0});x.useEffect(()=>{v()},[]);const v=async()=>{try{const c=await K.getAll();Array.isArray(c)?p(c):(console.error("Expected array but got:",typeof c,c),p([]))}catch(c){console.error("Failed to load products:",c),p([])}},j=async c=>{c.preventDefault();try{const P={...l,price:parseFloat(l.price),cost:parseFloat(l.cost),quantity:parseFloat(l.quantity),visibleToCashier:!l.expenseOnly&&l.visibleToCashier},f=await K.create(P);N({name:"",price:"",cost:"",quantity:"",unit:"pcs",category:"raw",expenseOnly:!1,image:"",visibleToCashier:!0}),d(!1),await v(),alert("Product created successfully!")}catch(P){console.error("Failed to create product:",P),alert(`Failed to create product: ${P.message||"Unknown error"}`)}},y=async c=>{c.preventDefault();try{const P=t.find(C=>C.id===s.id);if(parseFloat(s.price)<P.price){alert("You cannot lower prices, only increase.");return}const f={...s,price:parseFloat(s.price),cost:parseFloat(s.cost),quantity:parseFloat(s.quantity)},k=await K.update(s.id,f);i(!1),await v(),alert("Product updated successfully!")}catch(P){console.error("Failed to update product:",P),alert(`Failed to update product: ${P.message||"Unknown error"}`)}},A=async c=>{try{if(!confirm("Are you sure you want to delete this product? This action cannot be undone."))return;const P=await K.delete(c);await v(),alert("Product deleted successfully!")}catch(P){console.error("Failed to delete product:",P),alert(`Failed to delete product: ${P.message||"Unknown error"}`)}},E=(t||[]).filter(c=>{if(!c)return!1;const P=c.name?.toLowerCase().includes(r.toLowerCase()),f=n==="all"||n==="raw"&&!c.recipe||n==="composite"&&c.recipe||n==="expense"&&c.expenseOnly||n==="low-stock"&&c.quantity<10;return P&&f}),R=(t||[]).filter(c=>c&&!c.recipe&&!c.expenseOnly),S=(t||[]).filter(c=>c&&c.recipe),T=(t||[]).filter(c=>c&&c.expenseOnly),H=c=>{if(!c||!c.recipe)return 0;let P=1/0;return(c.recipe||[]).forEach(f=>{if(!f)return;const k=(t||[]).find(C=>C&&C.id===f.productId);if(k&&k.quantity>0&&f.quantity>0){const C=Math.floor(k.quantity/f.quantity);P=Math.min(P,C)}}),P===1/0?0:P},B=c=>{if(!c)return 0;if(!c.recipe)return c.cost||0;let P=0;return(c.recipe||[]).forEach(f=>{if(!f)return;const k=(t||[]).find(C=>C&&C.id===f.productId);if(k&&k.quantity>0){const C=(k.cost||0)/k.quantity;P+=C*(f.quantity||0)}}),P};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10 w-80",value:r,onChange:c=>h(c.target.value)})]}),e.jsxs("select",{value:n,onChange:c=>g(c.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Products"}),e.jsx("option",{value:"raw",children:"Raw Materials"}),e.jsx("option",{value:"composite",children:"Composite"}),e.jsx("option",{value:"expense",children:"Expense Only"}),e.jsx("option",{value:"low-stock",children:"Low Stock"})]})]}),e.jsxs("button",{onClick:()=>d(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Add Product"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-700 mb-2",children:"Raw Materials"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:R.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("h4",{className:"text-sm font-medium text-purple-700 mb-2",children:"Composite Products"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:S.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-700 mb-2",children:"Expense Items"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900",children:T.length})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Image"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cost/COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Max Units"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Margin"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(E||[]).map(c=>{if(!c)return null;const P=B(c),f=c.price?((c.price-P)/c.price*100).toFixed(1):0,k=H(c),C=m===c.id;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3",children:[c.image?e.jsx("img",{src:c.image,alt:c.name,className:"w-12 h-12 object-cover rounded-lg",onError:D=>{D.target.style.display="none",D.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",style:{display:c.image?"none":"flex"},children:e.jsx("span",{className:"text-xs text-gray-400",children:"No Image"})})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[c.recipe&&e.jsx("button",{onClick:()=>b(C?null:c.id),className:"p-1 hover:bg-gray-200 rounded",children:C?e.jsx(ut,{className:"w-4 h-4"}):e.jsx(ht,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium",children:c.name}),c.quantity<10&&!c.recipe&&e.jsx(Ze,{className:"w-4 h-4 text-orange-500"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`badge ${c.expenseOnly?"badge-warning":c.recipe?"badge-success":"bg-blue-100 text-blue-800"}`,children:c.expenseOnly?"Expense":c.recipe?"Composite":"Raw"})}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-green-600",children:["KSH ",c.price?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-orange-600",children:["KSH ",P.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`font-medium ${c.quantity<10&&!c.recipe?"text-red-600":"text-gray-900"}`,children:[c.quantity," ",c.unit]})}),e.jsx("td",{className:"px-4 py-3",children:c.recipe?e.jsxs("span",{className:"font-semibold text-blue-600",children:[k," units"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`font-semibold ${f>30?"text-green-600":f>15?"text-yellow-600":"text-red-600"}`,children:[f,"%"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{u(c),i(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>A(c.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600 transition-colors",children:e.jsx(_,{className:"w-4 h-4"})})]})})]},c.id),C&&c.recipe&&e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:"9",className:"px-4 py-4",children:e.jsxs("div",{className:"ml-8",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Recipe Breakdown:"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Ingredient"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Quantity Needed"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Available"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Unit Cost"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Total Cost"})]})}),e.jsx("tbody",{children:(c.recipe||[]).map((D,q)=>{if(!D)return null;const I=(t||[]).find(L=>L&&L.id===D.productId);if(!I)return null;const U=(I.cost||0)/(I.quantity||1),z=U*(D.quantity||0);return e.jsxs("tr",{className:"border-t border-blue-100",children:[e.jsx("td",{className:"px-3 py-2",children:I.name||"Unknown"}),e.jsxs("td",{className:"px-3 py-2",children:[D.quantity||0," ",I.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:[I.quantity||0," ",I.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:["KSH ",U.toFixed(2)]}),e.jsxs("td",{className:"px-3 py-2 font-semibold",children:["KSH ",z.toFixed(2)]})]},q)})}),e.jsx("tfoot",{className:"bg-white font-semibold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"px-3 py-2 text-right",children:"Total COGS per unit:"}),e.jsxs("td",{className:"px-3 py-2 text-orange-600",children:["KSH ",P.toFixed(2)]})]})})]})]})})})]})})})]})})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Product"}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:l.name,onChange:c=>N({...l,name:c.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",placeholder:"Image URL",className:"input flex-1",value:l.image,onChange:c=>N({...l,image:c.target.value})}),e.jsx("span",{className:"text-sm text-gray-500 self-center",children:"or"}),e.jsx("input",{type:"file",accept:"image/*",className:"input flex-1",onChange:c=>{const P=c.target.files[0];if(P){const f=new FileReader;f.onloadend=()=>{N({...l,image:f.result})},f.readAsDataURL(P)}}})]}),l.image&&e.jsx("img",{src:l.image,alt:"Preview",className:"w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:l.price,onChange:c=>N({...l,price:c.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:l.cost,onChange:c=>N({...l,cost:c.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input",value:l.quantity,onChange:c=>N({...l,quantity:c.target.value}),required:!0}),e.jsxs("select",{className:"input",value:l.unit,onChange:c=>N({...l,unit:c.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("select",{className:"input",value:l.category,onChange:c=>N({...l,category:c.target.value}),children:[e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"finished",children:"Finished Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.expenseOnly,onChange:c=>N({...l,expenseOnly:c.target.checked,visibleToCashier:!c.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!l.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:l.visibleToCashier,onChange:c=>N({...l,visibleToCashier:c.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>d(!1),className:"btn-secondary",children:"Cancel"})]})]})]})}),o&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Edit Product"}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:s.name,onChange:c=>u({...s,name:c.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",placeholder:"Image URL",className:"input flex-1",value:s.image||"",onChange:c=>u({...s,image:c.target.value})}),e.jsx("span",{className:"text-sm text-gray-500 self-center",children:"or"}),e.jsx("input",{type:"file",accept:"image/*",className:"input flex-1",onChange:c=>{const P=c.target.files[0];if(P){const f=new FileReader;f.onloadend=()=>{u({...s,image:f.result})},f.readAsDataURL(P)}}})]}),s.image&&e.jsx("img",{src:s.image,alt:"Preview",className:"w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:s.price||"",onChange:c=>u({...s,price:c.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:s.cost||"",onChange:c=>u({...s,cost:c.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input",value:s.quantity||"",onChange:c=>u({...s,quantity:c.target.value}),required:!0}),e.jsxs("select",{className:"input",value:s.unit||"pcs",onChange:c=>u({...s,unit:c.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("select",{className:"input",value:s.category||"raw",onChange:c=>u({...s,category:c.target.value}),children:[e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"finished",children:"Finished Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.expenseOnly||!1,onChange:c=>u({...s,expenseOnly:c.target.checked,visibleToCashier:!c.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!s.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.visibleToCashier!==!1,onChange:c=>u({...s,visibleToCashier:c.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Update Product"}),e.jsx("button",{type:"button",onClick:()=>i(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function $t(){const[t,p]=x.useState([]),[n,g]=x.useState([]),[r,h]=x.useState(!1),[a,d]=x.useState({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0});x.useEffect(()=>{o()},[]);const o=async()=>{const u=await K.getAll();p(u),g(u.filter(v=>!v.recipe))},i=()=>{d({...a,ingredients:[...a.ingredients,{name:"",quantity:"",unit:"pcs"}]})},m=(u,v,j)=>{const y=[...a.ingredients];y[u][v]=j,d({...a,ingredients:y})},b=u=>{d({...a,ingredients:a.ingredients.filter((v,j)=>j!==u)})},l=()=>a.ingredients.reduce((u,v)=>{const j=n.find(y=>y.name.toLowerCase()===v.name.toLowerCase());if(j&&v.quantity){const y=j.cost/j.quantity;return u+y*parseFloat(v.quantity)}return u},0),N=async u=>{u.preventDefault();const v=[];for(const y of a.ingredients){if(!y.name||!y.quantity)continue;const A=n.find(E=>E.name.toLowerCase()===y.name.toLowerCase());A?v.push({productId:A.id,quantity:parseFloat(y.quantity),unit:y.unit||"pcs"}):v.push({name:y.name,quantity:parseFloat(y.quantity),unit:y.unit||"pcs"})}if(v.length===0){alert("Please add at least one ingredient");return}const j=l();try{await K.create({name:a.name,price:parseFloat(a.price),cost:j,quantity:0,unit:"pcs",category:"composite",recipe:v,image:a.image||"",visibleToCashier:a.visibleToCashier,expenseOnly:!1}),d({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0}),h(!1),o(),alert("Recipe created successfully!")}catch(y){console.error("Error creating recipe:",y),alert("Failed to create recipe. Please try again.")}},s=t.filter(u=>u.recipe);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Recipe & BOM Builder"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create composite products with ingredient recipes"})]}),e.jsxs("button",{onClick:()=>h(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Create Recipe"]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-purple-50 border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ’¡ How it works"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Create composite products by defining recipes with raw ingredients. When a composite product is sold, the system automatically deducts the required quantities from raw materials and calculates COGS."}),e.jsxs("div",{className:"mt-3 p-3 bg-white rounded-lg text-sm",children:[e.jsx("strong",{children:"Example: Fish Fingers"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-gray-700",children:[e.jsx("li",{children:"â€¢ 0.02 kg Nile Perch"}),e.jsx("li",{children:"â€¢ 0.01 L Cooking Oil"}),e.jsx("li",{children:"â€¢ 0.004 kg Breadcrumbs"}),e.jsx("li",{children:"â€¢ 0.002 kg Salt"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Existing Recipes (",s.length,")"]}),s.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No recipes created yet"})}):e.jsx("div",{className:"space-y-4",children:s.map(u=>{const v=u.recipe.reduce((y,A)=>{if(A.productId){const E=t.find(R=>R.id===A.productId);if(E){const R=E.cost/E.quantity;return y+R*A.quantity}}else if(A.name){const E=t.find(R=>R.name.toLowerCase()===A.name.toLowerCase());if(E){const R=E.cost/E.quantity;return y+R*A.quantity}}return y},0),j=((u.price-v)/u.price*100).toFixed(1);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:u.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm",children:[e.jsxs("span",{className:"text-green-600 font-semibold",children:["Price: KSH ",u.price]}),e.jsxs("span",{className:"text-orange-600",children:["COGS: KSH ",v.toFixed(2)]}),e.jsxs("span",{className:`font-semibold ${j>30?"text-green-600":"text-yellow-600"}`,children:["Margin: ",j,"%"]})]})]}),e.jsx("button",{className:"text-red-600 hover:bg-red-50 p-2 rounded-lg",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"INGREDIENTS:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:u.recipe.map((y,A)=>{let E="",R=y.unit||"pcs";if(y.productId){const S=t.find(T=>T.id===y.productId);S&&(E=S.name,R=S.unit)}else y.name&&(E=y.name,R=y.unit||"pcs");return E?e.jsxs("div",{className:"text-sm flex items-center justify-between bg-white px-3 py-2 rounded",children:[e.jsx("span",{children:E}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[y.quantity," ",R]})]},A):null})})]})]},u.id)})})]}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Recipe"}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name (e.g., Fish Fingers)",className:"input",value:a.name,onChange:u=>d({...a,name:u.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Selling Price",className:"input",value:a.price,onChange:u=>d({...a,price:u.target.value}),required:!0}),e.jsx("input",{type:"url",placeholder:"Image URL (optional)",className:"input",value:a.image,onChange:u=>d({...a,image:u.target.value})})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.visibleToCashier,onChange:u=>d({...a,visibleToCashier:u.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold",children:"Ingredients"}),e.jsx("button",{type:"button",onClick:i,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Ingredient"})]}),e.jsx("div",{className:"space-y-3",children:a.ingredients.map((u,v)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Ingredient name (e.g., Nile Perch)",className:"input flex-1",value:u.name,onChange:j=>m(v,"name",j.target.value),required:!0,list:`ingredients-list-${v}`}),e.jsx("datalist",{id:`ingredients-list-${v}`,children:n.map(j=>e.jsxs("option",{value:j.name,children:[j.name," (",j.quantity," ",j.unit," available)"]},j.id))}),e.jsx("input",{type:"number",step:"0.001",placeholder:"Qty",className:"input w-32",value:u.quantity,onChange:j=>m(v,"quantity",j.target.value),required:!0}),e.jsxs("select",{className:"input w-24",value:u.unit,onChange:j=>m(v,"unit",j.target.value),children:[e.jsx("option",{value:"pcs",children:"pcs"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"L",children:"L"}),e.jsx("option",{value:"ml",children:"ml"})]}),e.jsx("button",{type:"button",onClick:()=>b(v),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(_,{className:"w-4 h-4"})})]},v))}),a.ingredients.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:'No ingredients added yet. Click "Add Ingredient" to start.'})]}),a.ingredients.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Estimated COGS:"}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["KSH ",l().toFixed(2)]})]}),a.price&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"font-medium",children:"Profit Margin:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[((parseFloat(a.price)-l())/parseFloat(a.price)*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{type:"submit",className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx(pt,{className:"w-4 h-4"}),"Create Recipe"]}),e.jsx("button",{type:"button",onClick:()=>{h(!1),d({name:"",price:"",ingredients:[]})},className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Mt(){const[t,p]=x.useState([]),[n,g]=x.useState("all");x.useEffect(()=>{r()},[]);const r=async()=>{const i=await oe.getAll();p(i.reverse())},h=t.filter(i=>{if(n==="today")return new Date(i.createdAt).toDateString()===new Date().toDateString();if(n==="week"){const m=new Date;return m.setDate(m.getDate()-7),new Date(i.createdAt)>=m}return!0}),a=h.reduce((i,m)=>i+m.total,0),d=h.reduce((i,m)=>i+(m.cogs||0),0),o=a-d;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("select",{value:n,onChange:i=>g(i.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"})]})}),e.jsxs("button",{className:"btn-secondary flex items-center gap-2",children:[e.jsx(gt,{className:"w-4 h-4"}),"Export"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white",children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",a.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-500 to-red-600 text-white",children:[e.jsx("p",{className:"text-sm text-orange-100 mb-1",children:"Total COGS"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",d.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Total Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",o.toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sales History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:h.map(i=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:["#",i.id]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(i.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[i.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:i.paymentMethod})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",i.total?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",i.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",i.profit?.toLocaleString()||0]})]},i.id))})]})})]})]})}function Ht(){const[t,p]=x.useState([]),[n,g]=x.useState(!1),[r,h]=x.useState({description:"",amount:"",category:"general"});x.useEffect(()=>{a()},[]);const a=async()=>{const b=await Ke.getAll();p(b.reverse())},d=async b=>{b.preventDefault(),await Ke.create({...r,amount:parseFloat(r.amount)}),h({description:"",amount:"",category:"general"}),g(!1),a()},o=t.reduce((b,l)=>b+l.amount,0),i=t.filter(b=>!b.automatic),m=t.filter(b=>b.automatic);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Expense Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track manual and automatic ingredient-based expenses"})]}),e.jsxs("button",{onClick:()=>g(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Add Expense"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white",children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",o.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Manual Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",i.reduce((b,l)=>b+l.amount,0).toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-500 to-violet-600 text-white",children:[e.jsx("p",{className:"text-sm text-purple-100 mb-1",children:"Auto Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",m.reduce((b,l)=>b+l.amount,0).toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Expense History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:t.map(b=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(b.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:b.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:b.category})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${b.automatic?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:b.automatic?"Automatic":"Manual"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",b.amount?.toLocaleString()]})]},b.id))})]})})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add Manual Expense"}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:r.description,onChange:b=>h({...r,description:b.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:r.amount,onChange:b=>h({...r,amount:b.target.value}),required:!0}),e.jsxs("select",{className:"input",value:r.category,onChange:b=>h({...r,category:b.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"utilities",children:"Utilities"}),e.jsx("option",{value:"rent",children:"Rent"}),e.jsx("option",{value:"salaries",children:"Salaries"}),e.jsx("option",{value:"supplies",children:"Supplies"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Expense"}),e.jsx("button",{type:"button",onClick:()=>g(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Bt(){const[t,p]=x.useState([]),[n,g]=x.useState(!1),[r,h]=x.useState(null),[a,d]=x.useState(null),[o,i]=x.useState(null),[m,b]=x.useState(0),[l,N]=x.useState({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}});x.useEffect(()=>{s()},[]),x.useEffect(()=>()=>{o?.intervalId&&clearInterval(o.intervalId)},[o]);const s=async()=>{try{const S=await ue.getAll();p(Array.isArray(S)?S:[])}catch(S){console.error("Error loading users:",S),p([])}},u=async S=>{if(S.preventDefault(),!l.password||l.password.length<6){alert("Password must be at least 6 characters long");return}try{const T=await ue.create({...l,role:"cashier",addedByAdmin:!0,needsPasswordSetup:!0});alert(`Cashier added successfully!

Login Credentials:
Email: ${l.email}
Password: ${l.password}

The cashier will need to log in and set their password first.
Please share these credentials securely.`),N({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),g(!1),s()}catch(T){console.error("Error creating cashier:",T),alert("Failed to add cashier: "+(T.message||"Unknown error"))}},v=async(S,T)=>{await ue.update(S,{permissions:T}),s(),h(null)},j=async S=>{confirm("Are you sure you want to delete this user?")&&(await ue.delete(S),s())},y=S=>{d(S),i({isActive:!1,currentCart:[],totalSalesToday:0,salesCount:0,lastActivity:"Loading..."});const T=setInterval(()=>{E(S)},3e3);i(H=>({...H,intervalId:T})),E(S)},A=()=>{o?.intervalId&&clearInterval(o.intervalId),d(null),i(null)},E=async S=>{try{const T=await oe.getAll(),B=(Array.isArray(T)?T:[]).filter(P=>P.cashierId===S.id).sort((P,f)=>new Date(f.createdAt)-new Date(P.createdAt)).slice(0,10),c={isActive:Math.random()>.3,currentCart:B.length>0?[{name:"Product A",price:150,quantity:2},{name:"Product B",price:300,quantity:1}]:[],totalSalesToday:B.reduce((P,f)=>P+f.total,0),salesCount:B.length,lastActivity:B.length>0?new Date(B[0].createdAt).toLocaleTimeString():"No recent activity"};i(c)}catch(T){console.error("Error loading live view data:",T)}},R=(t||[]).filter(S=>S.role==="cashier");return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage cashiers and their permissions"})]}),e.jsxs("button",{onClick:()=>g(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Add Cashier"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-700 mb-1",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:t.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsx("p",{className:"text-sm text-green-700 mb-1",children:"Cashiers"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:R.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-700 mb-1",children:"Admins"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:(t||[]).filter(S=>S.role==="admin").length})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Users"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Permissions"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(t||[]).map(S=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:S.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:S.email}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${S.role==="admin"?"bg-purple-100 text-purple-800":"badge-success"}`,children:S.role})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:S.plan||"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:S.role==="cashier"?e.jsx("button",{onClick:()=>h(S),className:"text-blue-600 hover:text-blue-700 text-xs font-medium",children:"Edit Permissions"}):e.jsx("span",{className:"text-gray-400 text-xs",children:"Full Access"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:S.role==="cashier"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{localStorage.setItem("adminViewingCashier",S.id),window.location.href="/cashier/pos"},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600",title:"Access Cashier POS",children:e.jsx(ft,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>y(S),className:"p-2 hover:bg-green-50 rounded-lg text-green-600",title:"Live View",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>j(S.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx(_,{className:"w-4 h-4"})})]})})]},S.id))})]})})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Cashier"}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Full Name",className:"input",value:l.name,onChange:S=>N({...l,name:S.target.value}),required:!0}),e.jsx("input",{type:"email",placeholder:"Email",className:"input",value:l.email,onChange:S=>N({...l,email:S.target.value}),required:!0}),e.jsx("input",{type:"password",placeholder:"Password (min 6 characters)",className:"input",value:l.password,onChange:S=>N({...l,password:S.target.value}),required:!0,minLength:6}),e.jsx("p",{className:"text-xs text-gray-500",children:"ðŸ’¡ The cashier will use this email and password to log in to the system"}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Permissions"}),e.jsx("div",{className:"space-y-2",children:Object.entries(l.permissions).map(([S,T])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:H=>N({...l,permissions:{...l.permissions,[S]:H.target.checked}})}),e.jsx("span",{className:"text-sm capitalize",children:S.replace(/([A-Z])/g," $1").trim()})]},S))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Cashier"}),e.jsx("button",{type:"button",onClick:()=>g(!1),className:"btn-secondary",children:"Cancel"})]})]})]})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Edit Permissions: ",r.name]}),e.jsx("div",{className:"space-y-3",children:Object.entries(r.permissions||{}).map(([S,T])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:H=>h({...r,permissions:{...r.permissions,[S]:H.target.checked}})}),e.jsx("span",{className:"text-sm capitalize",children:S.replace(/([A-Z])/g," $1").trim()})]},S))}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{onClick:()=>v(r.id,r.permissions),className:"btn-primary flex-1",children:"Save Changes"}),e.jsx("button",{onClick:()=>h(null),className:"btn-secondary",children:"Cancel"})]})]})}),a&&o&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(Ue,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Live View: ",a.name]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Real-time cashier activity monitoring"})]})]}),e.jsx("button",{onClick:A,className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx(ye,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${o.isActive?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("span",{className:"font-semibold",children:o.isActive?"Currently Active":"Currently Inactive"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(we,{className:"w-4 h-4"}),"Last Activity: ",o.lastActivity]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(le,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold",children:"Current Cart"})]}),(o.currentCart?.length||0)>0?e.jsxs("div",{className:"space-y-2",children:[(o.currentCart||[]).map((S,T)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"text-sm",children:[S.name," x",S.quantity]}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["KSH ",S.price.toLocaleString()]})]},T)),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(o.currentCart||[]).reduce((S,T)=>S+T.price*T.quantity,0).toLocaleString()]})]})})]}):e.jsx("p",{className:"text-gray-500 text-sm italic",children:"No items in cart"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Today's Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sales Count:"}),e.jsx("span",{className:"font-semibold",children:o.salesCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Sales:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["KSH ",o.totalSalesToday.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Average Sale:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",o.salesCount>0?Math.round(o.totalSalesToday/o.salesCount).toLocaleString():"0"]})]})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["ðŸ”„ Auto-refreshing every 3 seconds â€¢ Last updated: ",new Date().toLocaleTimeString()]})})]})})]})}function Kt(){const[t,p]=x.useState([]),[n,g]=x.useState("all");x.useEffect(()=>{r()},[]);const r=()=>{const o=JSON.parse(localStorage.getItem("clockRecords")||"[]");p(o.reverse())},h=n==="all"?t:t.filter(o=>o.date===new Date().toDateString()),a=h.filter(o=>o.date===new Date().toDateString()).reduce((o,i)=>o+i.duration,0)/60,d=o=>{const i=Math.floor(o/60),m=o%60;return`${i}h ${m}m`};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Time Tracking"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Monitor cashier clock in/out records"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(we,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Total Hours Today"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[a.toFixed(1),"h"]})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center",children:e.jsx(Ne,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Active Cashiers"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:new Set(h.filter(o=>o.date===new Date().toDateString()).map(o=>o.userId)).size})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(be,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:t.length})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Clock Records"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>g("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${n==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"All Time"}),e.jsx("button",{onClick:()=>g("today"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${n==="today"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Today"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cashier"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock In"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock Out"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Duration"})]})}),e.jsx("tbody",{children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-4 py-8 text-center text-gray-500",children:"No records found"})}):h.map((o,i)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:o.userName}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(o.clockIn).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(o.clockIn).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(o.clockOut).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:d(o.duration)})})]},i))})]})})]})]})}function zt(){const{user:t,updateUser:p}=G();Z();const[n,g]=x.useState(!1),[r,h]=x.useState(t?.plan||"ultra"),[a,d]=x.useState({}),[o,i]=x.useState(null),[m,b]=x.useState(t?.profilePicture||null);x.useEffect(()=>{l()},[]);const l=async()=>{try{const j=await Te.get();d(j),j.logo&&i(j.logo)}catch(j){console.error("Failed to load settings:",j)}},N=async j=>{const y=j.target.files[0];if(y){const A=new FileReader;A.onloadend=async()=>{const E=A.result;i(E);try{await Te.update({...a,logo:E}),d({...a,logo:E})}catch(R){console.error("Failed to save logo:",R)}},A.readAsDataURL(y)}},s=async j=>{const y=j.target.files[0];if(y){const A=new FileReader;A.onloadend=async()=>{const E=A.result;b(E);try{await p({...t,profilePicture:E})}catch(R){console.error("Failed to save profile picture:",R)}},A.readAsDataURL(y)}},u=[{id:"basic",name:"Basic Package",price:900,features:["Cashier Dashboard","Sales Tracking","Product Management","Basic Reports"]},{id:"ultra",name:"Ultra Package",price:1600,features:["Admin Dashboard","Recipe Builder","User Management","Advanced Analytics","Expense Tracking"]}],v=async()=>{const j=u.find(A=>A.id===r),y=r==="ultra"?"admin":"cashier";await p({...t,role:y,plan:r,price:j.price}),g(!1),setTimeout(()=>window.location.href=y==="admin"?"/admin":"/cashier",500)};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your account and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(Ne,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Account Information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[m?e.jsx("img",{src:m,alt:"Profile",className:"w-20 h-20 rounded-full object-cover"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white text-2xl font-bold",children:t?.name?.charAt(0).toUpperCase()}),e.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-600 text-white p-1.5 rounded-full cursor-pointer hover:bg-blue-700 transition",children:[e.jsx(Fe,{className:"w-3 h-3"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:s})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("p",{className:"font-medium",children:t?.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:t?.role})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(ie,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Subscription"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Current Plan"}),e.jsxs("p",{className:"font-medium capitalize",children:[t?.plan||"Ultra"," Package"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Price"}),e.jsxs("p",{className:"font-medium",children:["KSH ",t?.price||1600,"/month"]})]}),e.jsx("button",{onClick:()=>g(!0),className:"btn-secondary text-sm",children:"Change Plan"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(Le,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Notifications"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Email Notifications"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Low Stock Alerts"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Daily Sales Summary"}),e.jsx("input",{type:"checkbox",className:"toggle"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx(Ge,{className:"w-5 h-5 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Security"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Change Password"}),e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Enable 2FA"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(bt,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Screen Lock Logo"})]}),e.jsxs("div",{className:"space-y-3",children:[o&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:o,alt:"Logo Preview",className:"w-32 h-32 object-contain rounded-lg border-2 border-gray-200"})}),e.jsxs("label",{className:"btn-secondary text-sm w-full cursor-pointer flex items-center justify-center gap-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),"Upload Logo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:N})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"This logo will appear on the screen lock"})]})]})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Change Your Plan"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:u.map(j=>e.jsxs("div",{onClick:()=>h(j.id),className:`card cursor-pointer transition-all ${r===j.id?"ring-4 ring-blue-600 bg-blue-50":"hover:shadow-lg"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-xl font-bold",children:j.name}),r===j.id&&e.jsx(Q,{className:"w-6 h-6 text-blue-600"})]}),e.jsxs("p",{className:"text-3xl font-bold mb-4",children:["KSH ",j.price,e.jsx("span",{className:"text-sm text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:j.features.map((y,A)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Q,{className:"w-4 h-4 text-green-600"}),y]},A))})]},j.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:v,className:"btn-primary flex-1",children:"Confirm Change"}),e.jsx("button",{onClick:()=>g(!1),className:"btn-secondary",children:"Cancel"})]})]})})]})}function Jt(){const[t,p]=x.useState([]),[n,g]=x.useState(!1),[r,h]=x.useState(null),[a,d]=x.useState({name:"",amount:"",description:"",active:!0});x.useEffect(()=>{o()},[]);const o=()=>{const l=JSON.parse(localStorage.getItem("serviceFees")||"[]");p(l)},i=l=>{localStorage.setItem("serviceFees",JSON.stringify(l)),p(l)},m=l=>{if(l.preventDefault(),r){const N=t.map(s=>s.id===r.id?{...a,id:s.id}:s);i(N)}else{const N={...a,id:Date.now(),createdAt:new Date().toISOString()};i([...t,N])}g(!1),h(null),d({name:"",amount:"",description:"",active:!0})},b=l=>{confirm("Delete this service fee?")&&i(t.filter(N=>N.id!==l))};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Service Fees"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage delivery, packaging, and other fees"})]}),e.jsxs("button",{onClick:()=>{g(!0),h(null)},className:"btn-primary flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Add Fee"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:t.map(l=>e.jsxs("div",{className:`card ${l.active?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(de,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:l.name}),e.jsx("p",{className:"text-xs text-gray-500",children:l.description})]})]}),e.jsx("span",{className:`badge ${l.active?"badge-success":"bg-gray-200 text-gray-600"}`,children:l.active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["KSH ",l.amount]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{h(l),d(l),g(!0)},className:"p-2 hover:bg-blue-50 rounded-lg",children:e.jsx(ve,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>b(l.id),className:"p-2 hover:bg-red-50 rounded-lg",children:e.jsx(_,{className:"w-4 h-4 text-red-600"})})]})]})]},l.id))}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[r?"Edit":"Add"," Service Fee"]}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Fee Name (e.g., Delivery)",className:"input",value:a.name,onChange:l=>d({...a,name:l.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:a.amount,onChange:l=>d({...a,amount:l.target.value}),required:!0}),e.jsx("textarea",{placeholder:"Description",className:"input",rows:"2",value:a.description,onChange:l=>d({...a,description:l.target.value})}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.active,onChange:l=>d({...a,active:l.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>g(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function _t(){const[t,p]=x.useState([]),[n,g]=x.useState([]),[r,h]=x.useState(!1),[a,d]=x.useState({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""});x.useEffect(()=>{o(),i()},[]);const o=async()=>{try{const s=localStorage.getItem("token"),v=await fetch("/api/reminders",{headers:{Authorization:`Bearer ${s}`}});if(!v.ok){console.error("API Error:",v.status,v.statusText),p([]);return}const j=await v.json();Array.isArray(j)?p(j):(console.error("Expected array but got:",typeof j,j),p([]))}catch(s){console.error("Failed to fetch reminders:",s),p([])}},i=async()=>{try{const s=localStorage.getItem("token"),v=await fetch("/api/products",{headers:{Authorization:`Bearer ${s}`}});if(!v.ok){console.error("API Error:",v.status,v.statusText),g([]);return}const j=await v.json();Array.isArray(j)?g(j):(console.error("Expected array but got:",typeof j,j),g([]))}catch(s){console.error("Failed to fetch products:",s),g([])}},m=async s=>{s.preventDefault();try{const u=localStorage.getItem("token"),j=await fetch("/api/reminders",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify(a)});if(!j.ok){const A=await j.json();console.error("Failed to create reminder:",A),alert(`Failed to create reminder: ${A.error||"Unknown error"}`);return}const y=await j.json();d({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""}),h(!1),o(),alert("Reminder created successfully!")}catch(u){console.error("Failed to create reminder:",u),alert("Failed to create reminder. Please try again.")}},b=async s=>{try{if(JSON.parse(localStorage.getItem("user")||"{}").role!=="admin"){alert("Only administrators can delete reminders.");return}if(!confirm("Are you sure you want to delete this reminder? This action cannot be undone."))return;const v=localStorage.getItem("token"),y=await fetch(`/api/reminders/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${v}`}});if(!y.ok){const A=await y.json();console.error("Failed to delete reminder:",A),alert(`Failed to delete reminder: ${A.error||"Unknown error"}`);return}o(),alert("Reminder deleted successfully!")}catch(u){console.error("Failed to delete reminder:",u),alert("Failed to delete reminder. Please try again.")}},l=s=>{a.days.includes(s)?d({...a,days:a.days.filter(u=>u!==s)}):d({...a,days:[...a.days,s]})},N=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(Le,{className:"text-blue-600"}),"Reminder System"]}),e.jsxs("button",{onClick:()=>h(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2",children:[e.jsx(J,{size:20}),"New Reminder"]})]}),e.jsx("div",{className:"grid gap-4",children:t.map(s=>{const u=n.find(v=>v.id===s.productId);return e.jsx("div",{className:`p-6 rounded-xl shadow-lg ${s.status==="pending"?"bg-red-50 border-l-4 border-red-500":"bg-green-50 border-l-4 border-green-500"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:s.customerName}),e.jsxs("p",{className:"text-gray-700 mb-1",children:["Product: ",u?.name||"Unknown"]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Frequency: ",s.frequency]}),s.days?.length>0&&e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Days: ",s.days.join(", ")]}),e.jsxs("p",{className:"text-gray-600 text-sm flex items-center gap-2",children:[e.jsx(be,{size:16}),"Next: ",new Date(s.nextDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-4 py-2 rounded-lg font-bold ${s.status==="pending"?"bg-red-500 text-white":"bg-green-500 text-white"}`,children:s.status}),e.jsx("button",{onClick:()=>b(s.id),className:"bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition",children:e.jsx(_,{size:20})})]})]})},s.id)})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Create Reminder"})}),e.jsxs("form",{onSubmit:m,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Name"}),e.jsx("input",{type:"text",value:a.customerName,onChange:s=>d({...a,customerName:s.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Product"}),e.jsxs("select",{value:a.productId,onChange:s=>d({...a,productId:parseInt(s.target.value)}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Product"}),n.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Frequency"}),e.jsxs("select",{value:a.frequency,onChange:s=>d({...a,frequency:s.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"specific",children:"Specific Days"})]})]}),a.frequency==="specific"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Days"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:N.map(s=>e.jsx("button",{type:"button",onClick:()=>l(s),className:`px-4 py-2 rounded-lg font-medium transition ${a.days.includes(s)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Next Reminder Date"}),e.jsx("input",{type:"date",value:a.nextDate,onChange:s=>d({...a,nextDate:s.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition",children:"Create Reminder"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})}function Gt(){const[t,p]=x.useState([]),[n,g]=x.useState(!1),[r,h]=x.useState(null),[a,d]=x.useState({name:"",percentage:"",validFrom:"",validTo:"",active:!0});x.useEffect(()=>{o()},[]);const o=async()=>{try{const l=await he.getAll();p(l)}catch(l){console.error("Failed to load discounts:",l)}},i=async l=>{l.preventDefault();try{r?await he.update(r.id,a):await he.create(a),g(!1),h(null),d({name:"",percentage:"",validFrom:"",validTo:"",active:!0}),o()}catch(N){console.error("Failed to save discount:",N)}},m=async l=>{if(confirm("Delete this discount?"))try{await he.delete(l),o()}catch(N){console.error("Failed to delete discount:",N)}},b=l=>{const N=new Date,s=new Date(l.validFrom),u=new Date(l.validTo);return l.active&&s<=N&&u>=N};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Discount Manager"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and manage discount rules"})]}),e.jsxs("button",{onClick:()=>{g(!0),h(null),d({name:"",percentage:"",validFrom:"",validTo:"",active:!0})},className:"btn-primary flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),"Add Discount"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.map(l=>e.jsxs("div",{className:`card ${b(l)?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${b(l)?"bg-green-600":"bg-gray-400"}`,children:e.jsx(je,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:l.name}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[l.percentage,"% OFF"]})]})]}),e.jsx("span",{className:`badge ${b(l)?"badge-success":"bg-gray-200 text-gray-600"}`,children:b(l)?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsxs("span",{children:["From: ",new Date(l.validFrom).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4"}),e.jsxs("span",{children:["To: ",new Date(l.validTo).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{h(l),d(l),g(!0)},className:"p-2 hover:bg-blue-50 rounded-lg flex-1",children:e.jsx(ve,{className:"w-4 h-4 text-blue-600 mx-auto"})}),e.jsx("button",{onClick:()=>m(l.id),className:"p-2 hover:bg-red-50 rounded-lg flex-1",children:e.jsx(_,{className:"w-4 h-4 text-red-600 mx-auto"})})]})]},l.id)),t.length===0&&e.jsxs("div",{className:"card text-center py-12 col-span-full",children:[e.jsx(je,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No discounts yet. Create your first discount!"})]})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[r?"Edit":"Add"," Discount"]}),e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Discount Name"}),e.jsx("input",{type:"text",className:"input",value:a.name,onChange:l=>d({...a,name:l.target.value}),placeholder:"e.g., Holiday Sale",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Percentage (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"input",value:a.percentage,onChange:l=>d({...a,percentage:parseFloat(l.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid From"}),e.jsx("input",{type:"date",className:"input",value:a.validFrom,onChange:l=>d({...a,validFrom:l.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid To"}),e.jsx("input",{type:"date",className:"input",value:a.validTo,onChange:l=>d({...a,validTo:l.target.value}),required:!0})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.active,onChange:l=>d({...a,active:l.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>g(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function Vt(){const[t,p]=x.useState([]),[n,g]=x.useState([]),[r,h]=x.useState("all");x.useEffect(()=>{a(),d()},[]);const a=async()=>{try{const s=await Pe.getAll();p(s)}catch(s){console.error("Failed to load credit requests:",s)}},d=async()=>{try{const s=await K.getAll();g(s)}catch(s){console.error("Failed to load products:",s)}},o=async s=>{try{await Pe.approve(s),a()}catch(u){console.error("Failed to approve request:",u)}},i=async s=>{try{await Pe.reject(s),a()}catch(u){console.error("Failed to reject request:",u)}},m=s=>{const u=n.find(v=>v.id===s);return u?u.name:"Unknown Product"},b=t.filter(s=>r==="all"?!0:s.status===r),l=s=>{switch(s){case"pending":return"bg-orange-50 border-orange-200";case"approved":return"bg-green-50 border-green-200";case"rejected":return"bg-red-50 border-red-200";default:return"bg-gray-50 border-gray-200"}},N=s=>{switch(s){case"pending":return e.jsx(we,{className:"w-6 h-6 text-orange-600"});case"approved":return e.jsx(ce,{className:"w-6 h-6 text-green-600"});case"rejected":return e.jsx(Ee,{className:"w-6 h-6 text-red-600"});default:return e.jsx(ie,{className:"w-6 h-6 text-gray-600"})}};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Credit Requests"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Review and manage credit requests from cashiers"})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(s=>e.jsx("button",{onClick:()=>h(s),className:`px-4 py-2 rounded-lg font-medium transition ${r===s?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[b.map(s=>e.jsx("div",{className:`card border-l-4 ${l(s.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${s.status==="pending"?"bg-orange-600":s.status==="approved"?"bg-green-600":"bg-red-600"}`,children:N(s.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.customerName}),e.jsx("p",{className:"text-sm text-gray-600",children:m(s.productId)}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{children:["Quantity: ",e.jsx("strong",{children:s.quantity})]}),e.jsxs("span",{children:["Amount: ",e.jsxs("strong",{className:"text-green-600",children:["KSH ",s.amount?.toLocaleString()]})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Requested: ",new Date(s.createdAt).toLocaleString()]}),s.approvedAt&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Approved: ",new Date(s.approvedAt).toLocaleString()]})]})]}),s.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>o(s.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(ce,{size:16}),"Approve"]}),e.jsxs("button",{onClick:()=>i(s.id),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(Ee,{size:16}),"Reject"]})]}),s.status!=="pending"&&e.jsx("span",{className:`badge ${s.status==="approved"?"badge-success":"bg-red-100 text-red-800"}`,children:s.status.toUpperCase()})]})},s.id)),b.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(ie,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",r!=="all"?r:""," credit requests found."]})]})]})]})}function Wt({onClose:t}){const[p,n]=x.useState([]),[g,r]=x.useState(!0);x.useEffect(()=>{h()},[]);const h=async()=>{try{const d=localStorage.getItem("token"),i=await fetch("/api/reminders/today",{headers:{Authorization:`Bearer ${d}`}});if(!i.ok){console.error("API Error:",i.status,i.statusText),n([]);return}const m=await i.json();Array.isArray(m)?n(m):(console.error("Expected array but got:",typeof m,m),n([]))}catch(d){console.error("Failed to fetch reminders:",d),n([])}finally{r(!1)}},a=async d=>{try{const o=localStorage.getItem("token");await fetch(`/api/reminders/${d}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({status:"fulfilled"})}),h()}catch(o){console.error("Failed to update reminder:",o)}};return g?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Today's Reminders"}),e.jsx("button",{onClick:t,className:"hover:bg-white/20 p-2 rounded-lg transition",children:e.jsx(ye,{size:24})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(fe,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No reminders for today"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"You're all caught up!"})]}):p.map(d=>e.jsxs("div",{className:"mb-4 p-4 border-l-4 border-red-500 bg-red-50 rounded-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:d.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Product ID: ",d.productId]}),e.jsx("p",{className:"text-xs text-gray-500",children:d.frequency})]}),e.jsxs("button",{onClick:()=>a(d.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(ce,{size:18}),"Mark Done"]})]},d.id))})]})})}function Yt({onUnlock:t,logo:p}){const[n,g]=x.useState(""),[r,h]=x.useState(""),a=d=>{d.preventDefault();const o=JSON.parse(localStorage.getItem("user"));n===o.password||n==="1234"?(t(),g(""),h("")):(h("Invalid PIN"),g(""))};return e.jsx("div",{className:"fixed inset-0 bg-gradient-to-br from-blue-900 via-purple-900 to-pink-900 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-3xl p-12 shadow-2xl max-w-md w-full mx-4",children:[p?e.jsx("img",{src:p,alt:"Logo",className:"w-32 h-32 mx-auto mb-8 rounded-2xl shadow-lg"}):e.jsx("div",{className:"w-32 h-32 mx-auto mb-8 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(V,{size:64,className:"text-white"})}),e.jsx("h2",{className:"text-3xl font-bold text-white text-center mb-2",children:"Screen Locked"}),e.jsx("p",{className:"text-white/70 text-center mb-8",children:"Enter your PIN to unlock"}),e.jsxs("form",{onSubmit:a,children:[e.jsx("input",{type:"password",value:n,onChange:d=>g(d.target.value),className:"w-full px-6 py-4 rounded-xl bg-white/20 text-white placeholder-white/50 text-center text-2xl tracking-widest focus:outline-none focus:ring-4 focus:ring-white/30",placeholder:"â€¢â€¢â€¢â€¢",autoFocus:!0}),r&&e.jsx("p",{className:"text-red-300 text-center mt-4",children:r}),e.jsx("button",{type:"submit",className:"w-full mt-6 bg-white text-purple-900 py-4 rounded-xl font-bold text-lg hover:bg-white/90 transition shadow-lg",children:"Unlock"})]})]})})}function Qt(t=45e3){const[p,n]=x.useState(!1),g=x.useRef(null),r=x.useCallback(()=>{g.current&&clearTimeout(g.current),g.current=setTimeout(()=>n(!0),t)},[t]);x.useEffect(()=>{const a=["mousedown","mousemove","keypress","scroll","touchstart","click"];return a.forEach(d=>{document.addEventListener(d,r,!0)}),r(),()=>{g.current&&clearTimeout(g.current),a.forEach(d=>{document.removeEventListener(d,r,!0)})}},[r]);const h=x.useCallback(()=>{n(!1),r()},[r]);return[p,h]}function Zt(){const{user:t,logout:p}=G(),n=Z(),g=ct(),[r,h]=x.useState(!0),[a,d]=x.useState(!1),[o,i]=x.useState({}),[m,b]=Qt(45e3);x.useEffect(()=>{const u=()=>{const j=localStorage.getItem("user");if(j){const y=JSON.parse(j);let A=!1;(y.plan==="ultra"||y.role==="admin")&&(y.active||(y.active=!0,A=!0),y.plan==="ultra"&&y.role!=="admin"&&(y.role="admin",A=!0),y.plan==="ultra"&&(!y.price||y.price!==1600)&&(y.price=1600,A=!0),A&&(localStorage.setItem("user",JSON.stringify(y)),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new Event("localStorageUpdated"))))}};u(),setTimeout(u,100);const v=setTimeout(()=>{d(!0)},1e3);return l(),()=>clearTimeout(v)},[]);const l=async()=>{try{const u=await Te.get();i(u)}catch(u){console.error("Failed to load settings:",u)}},N=[{id:"overview",label:"Dashboard",icon:yt,path:"/admin"},{id:"sales",label:"Sales",icon:Ye,path:"/admin/sales"},{id:"inventory",label:"Inventory",icon:W,path:"/admin/inventory"},{id:"recipes",label:"Recipes/BOM",icon:_e,path:"/admin/recipes"},{id:"expenses",label:"Expenses",icon:Qe,path:"/admin/expenses"},{id:"users",label:"Users",icon:ge,path:"/admin/users"},{id:"time",label:"Time Tracking",icon:we,path:"/admin/time"},{id:"reminders",label:"Reminders",icon:Le,path:"/admin/reminders"},{id:"service-fees",label:"Service Fees",icon:de,path:"/admin/service-fees"},{id:"discounts",label:"Discounts",icon:je,path:"/admin/discounts"},{id:"credit-requests",label:"Credit Requests",icon:ie,path:"/admin/credit-requests"},{id:"settings",label:"Settings",icon:Xe,path:"/admin/settings"}],s=u=>u==="/admin"?g.pathname==="/admin":g.pathname.startsWith(u);return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("aside",{className:`bg-white border-r border-gray-200 transition-all duration-300 ${r?"w-64":"w-20"} flex flex-col`,children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[r&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Admin Panel"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ultra Package"})]}),e.jsx("button",{onClick:()=>h(!r),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:r?e.jsx(ye,{className:"w-5 h-5"}):e.jsx(jt,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4 space-y-2",children:N.map(u=>{const v=u.icon;return e.jsxs("button",{onClick:()=>n(u.path),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${s(u.path)?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-md":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(v,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:u.label})]},u.id)})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2",children:[e.jsxs("button",{onClick:()=>window.open("/cashier","_blank"),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors",children:[e.jsx(Nt,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:"Open POS"})]}),e.jsxs("button",{onClick:p,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(pe,{className:"w-5 h-5 flex-shrink-0"}),r&&e.jsx("span",{className:"font-medium",children:"Logout"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:N.find(u=>s(u.path))?.label||"Dashboard"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:t?.name?.charAt(0).toUpperCase()})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs(Je,{children:[e.jsx(F,{path:"/",element:e.jsx(Ft,{})}),e.jsx(F,{path:"/sales",element:e.jsx(Mt,{})}),e.jsx(F,{path:"/inventory",element:e.jsx(qt,{})}),e.jsx(F,{path:"/recipes",element:e.jsx($t,{})}),e.jsx(F,{path:"/expenses",element:e.jsx(Ht,{})}),e.jsx(F,{path:"/reminders",element:e.jsx(_t,{})}),e.jsx(F,{path:"/service-fees",element:e.jsx(Jt,{})}),e.jsx(F,{path:"/discounts",element:e.jsx(Gt,{})}),e.jsx(F,{path:"/credit-requests",element:e.jsx(Vt,{})}),e.jsx(F,{path:"/users",element:e.jsx(Bt,{})}),e.jsx(F,{path:"/time",element:e.jsx(Kt,{})}),e.jsx(F,{path:"/settings",element:e.jsx(zt,{})})]})})]}),a&&e.jsx(Wt,{onClose:()=>d(!1)}),m&&e.jsx(Yt,{onUnlock:b,logo:o.logo})]})}function Xt({product:t,onAddToCart:p,onRequestCredit:n,showDiscounts:g=!1}){return e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition transform hover:-translate-y-1",children:[t.image?e.jsx("img",{src:t.image,alt:t.name,className:"w-full h-64 object-contain bg-gray-50"}):e.jsx("div",{className:"w-full h-64 bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center",children:e.jsx(W,{size:64,className:"text-white"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-bold text-lg",children:t.name}),e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs",children:t.code||"N/A"})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-2",children:t.category}),t.notes&&e.jsx("p",{className:"text-gray-500 text-xs mb-3 italic",children:t.notes}),e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("span",{className:"text-2xl font-bold text-green-600",children:["KSH ",t.price?.toLocaleString()]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[t.quantity," ",t.unit]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>p(t),className:"flex-1 bg-blue-600 text-white py-2 rounded-lg font-bold hover:bg-blue-700 transition flex items-center justify-center gap-2",children:[e.jsx(le,{size:18}),"Add"]}),e.jsx("button",{onClick:()=>n(t),className:"bg-orange-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-orange-600 transition",children:"Credit"})]})]})]})}function es(){const{user:t,logout:p}=G(),[n,g]=x.useState([]),[r,h]=x.useState([]),[a,d]=x.useState("cash"),[o,i]=x.useState(!0),[m,b]=x.useState("pos"),[l,N]=x.useState(!1),[s,u]=x.useState(null),[v,j]=x.useState({name:"",price:"",quantity:"",unit:"pcs"}),[y,A]=x.useState(""),[E,R]=x.useState([]),[S,T]=x.useState({}),[H,B]=x.useState(!1),[c,P]=x.useState(null);x.useEffect(()=>{C();const w=localStorage.getItem(`clockIn_${t?.id}_${new Date().toDateString()}`);w&&(B(!0),P(new Date(w)))},[]);const f=()=>{const w=new Date;localStorage.setItem(`clockIn_${t?.id}_${w.toDateString()}`,w.toISOString()),B(!0),P(w)},k=()=>{const w=new Date,M=localStorage.getItem(`clockIn_${t?.id}_${new Date().toDateString()}`);if(M){const $=new Date(M),Se=Math.floor((w-$)/1e3/60),ee=JSON.parse(localStorage.getItem("clockRecords")||"[]");ee.push({userId:t?.id,userName:t?.name,clockIn:$.toISOString(),clockOut:w.toISOString(),duration:Se,date:new Date().toDateString()}),localStorage.setItem("clockRecords",JSON.stringify(ee)),localStorage.removeItem(`clockIn_${t?.id}_${new Date().toDateString()}`)}B(!1),P(null)},C=async()=>{const[w,M,$]=await Promise.all([K.getAll(),oe.getAll(),tt.get()]),Se=w.filter(ee=>ee.visibleToCashier!==!1&&!ee.expenseOnly);g(Se),R(M.reverse()),T($)},D=w=>{const M=r.find($=>$.id===w.id);h(M?r.map($=>$.id===w.id?{...$,quantity:$.quantity+1}:$):[...r,{...w,quantity:1}])},q=(w,M)=>{h(r.map($=>$.id===w?{...$,quantity:Math.max(1,$.quantity+M)}:$).filter($=>$.quantity>0))},I=w=>{h(r.filter(M=>M.id!==w))},U=r.reduce((w,M)=>w+M.price*M.quantity,0),z=.15,L=U*z,X=U-L,Oe=o?0:X*.16,Re=X+Oe,at=async()=>{if(r.length!==0)try{await oe.create({items:r.map(w=>({productId:w.id,quantity:w.quantity,price:w.price})),total:Re,paymentMethod:a}),h([]),C(),alert("Sale completed successfully!")}catch(w){alert("Failed to complete sale: "+w.message)}},lt=n.filter(w=>w.name?.toLowerCase().includes(y.toLowerCase()));return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex flex-col",children:[e.jsx("nav",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200 px-4 md:px-6 py-3 md:py-4 sticky top-0 z-50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg md:text-2xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent",children:t?.plan==="basic"?"Cashier Dashboard":"POS System"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5 hidden md:block",children:t?.plan==="basic"?"Basic Package - KSH 900/month":"Ultra Package Access"})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsxs("div",{className:"text-right hidden md:block",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email}),H&&c&&e.jsxs("p",{className:"text-xs text-green-600 font-medium",children:["Clocked in: ",c.toLocaleTimeString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[H?e.jsxs("button",{onClick:k,className:"btn-secondary flex items-center gap-1 md:gap-2 text-sm md:text-base px-2 md:px-4 bg-red-50 text-red-600 border-red-200",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:"Clock Out"})]}):e.jsxs("button",{onClick:f,className:"btn-secondary flex items-center gap-1 md:gap-2 text-sm md:text-base px-2 md:px-4 bg-green-50 text-green-600 border-green-200",children:[e.jsx(pe,{className:"w-4 h-4 rotate-180"}),e.jsx("span",{className:"hidden md:inline",children:"Clock In"})]}),e.jsxs("button",{onClick:()=>window.location.href="/cashier/settings",className:"btn-secondary flex items-center gap-1 md:gap-2 text-sm md:text-base px-2 md:px-4",children:[e.jsx(Xe,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:"Settings"})]}),e.jsxs("button",{onClick:p,className:"btn-secondary flex items-center gap-1 md:gap-2 hover:bg-red-50 hover:text-red-600 hover:border-red-200 text-sm md:text-base px-2 md:px-4",children:[e.jsx(pe,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:"Logout"})]})]})]})]})}),e.jsxs("div",{className:"flex gap-1 md:gap-2 px-2 md:px-6 py-2 md:py-4 bg-white border-b border-gray-200 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>b("pos"),className:`px-3 md:px-6 py-2 rounded-lg font-medium transition-all whitespace-nowrap text-sm md:text-base ${m==="pos"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(le,{className:"w-4 h-4 inline mr-1 md:mr-2"}),"POS"]}),e.jsxs("button",{onClick:()=>b("sales"),className:`px-3 md:px-6 py-2 rounded-lg font-medium transition-all whitespace-nowrap text-sm md:text-base ${m==="sales"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(Ae,{className:"w-4 h-4 inline mr-1 md:mr-2"}),"Sales"]}),e.jsxs("button",{onClick:()=>b("stock"),className:`px-3 md:px-6 py-2 rounded-lg font-medium transition-all whitespace-nowrap text-sm md:text-base ${m==="stock"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(W,{className:"w-4 h-4 inline mr-1 md:mr-2"}),"Stock"]})]}),m==="pos"&&e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row",children:[e.jsxs("div",{className:"flex-1 p-3 md:p-6 overflow-y-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(Ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10",value:y,onChange:w=>A(w.target.value)})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:lt.map(w=>e.jsx(Xt,{product:w,onAddToCart:D,onRequestCredit:()=>{},showDiscounts:!0},w.id))})]}),e.jsxs("div",{className:"w-full md:w-96 bg-white border-t md:border-l md:border-t-0 border-gray-200 p-4 md:p-6 flex flex-col shadow-xl max-h-[50vh] md:max-h-none",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-600 to-teal-600 rounded-xl flex items-center justify-center",children:e.jsx(le,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Cart"}),e.jsxs("span",{className:"ml-auto bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-semibold",children:[r.length," items"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-6",children:r.length===0?e.jsxs("div",{className:"text-center mt-16",children:[e.jsx(le,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Cart is empty"})]}):e.jsx("div",{className:"space-y-3",children:r.map(w=>e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:w.name}),e.jsx("button",{onClick:()=>I(w.id),className:"text-red-600 hover:bg-red-50 p-1 rounded",children:e.jsx(_,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>q(w.id,-1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100",children:e.jsx(vt,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-10 text-center font-semibold",children:w.quantity}),e.jsx("button",{onClick:()=>q(w.id,1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100",children:e.jsx(J,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"font-bold text-green-600",children:["KSH ",(w.price*w.quantity).toLocaleString()]})]})]},w.id))})}),r.length>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(je,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold text-blue-900",children:"Active Discounts"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-700",children:"Customer Loyalty Discount"}),e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:"5%"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-700",children:"Bulk Purchase Discount"}),e.jsx("span",{className:"text-sm font-semibold text-blue-600",children:"10%"})]}),e.jsx("div",{className:"border-t border-blue-200 pt-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-blue-900",children:"Total Discount"}),e.jsxs("span",{className:"text-sm font-bold text-blue-600",children:["KSH ",L.toLocaleString()," (",Math.round(z*100),"%)"]})]})})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2 border-t border-gray-200 pt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",U.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-blue-600",children:[e.jsxs("span",{children:["Discount (",Math.round(z*100),"%):"]}),e.jsxs("span",{className:"font-semibold",children:["-KSH ",L.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Discounted Subtotal:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",X.toLocaleString()]})]}),!o&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Tax (16%):"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",Oe.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-xl font-bold border-t border-gray-200 pt-2",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",Re.toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Tax"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>i(!0),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${o?"bg-green-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Tax Inclusive"}),e.jsx("button",{onClick:()=>i(!1),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${o?"bg-gray-100 text-gray-600 hover:bg-gray-200":"bg-green-600 text-white"}`,children:"Tax Exclusive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Payment Method"}),e.jsxs("select",{value:a,onChange:w=>d(w.target.value),className:"input",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mpesa",children:"M-Pesa"}),e.jsx("option",{value:"card",children:"Card"})]})]}),e.jsx("button",{onClick:at,disabled:r.length===0,className:"btn-primary w-full py-4 text-lg bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 shadow-lg",children:"Complete Sale"})]})]})]}),m==="stock"&&e.jsxs("div",{className:"p-6 max-w-7xl mx-auto w-full space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Stock Management"}),e.jsxs("button",{onClick:()=>{N(!0),j({name:"",price:"",quantity:"",unit:"pcs"})},className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-green-600 to-teal-600",children:[e.jsx(J,{className:"w-4 h-4"}),"Add Product"]})]}),e.jsx("div",{className:"card shadow-lg",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:n.map(w=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:w.name}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",w.price?.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:`font-medium ${w.quantity<10?"text-red-600":"text-gray-900"}`,children:[w.quantity," ",w.unit]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{u(w),j({name:w.name,price:w.price,quantity:w.quantity,unit:w.unit||"pcs"})},className:"p-2 hover:bg-green-50 rounded-lg text-green-600",children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsx("button",{onClick:async()=>{confirm("Delete this product?")&&(await K.delete(w.id),C())},className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx(_,{className:"w-4 h-4"})})]})})]},w.id))})]})})}),(l||s)&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:s?"Edit Product":"Add Product"}),e.jsxs("form",{onSubmit:async w=>{w.preventDefault();try{s?await K.update(s.id,{...s,...v,price:parseFloat(v.price),quantity:parseFloat(v.quantity)}):await K.create({...v,price:parseFloat(v.price),cost:parseFloat(v.price)*.6,quantity:parseFloat(v.quantity),category:"raw"}),N(!1),u(null),C()}catch(M){alert("Failed: "+M.message)}},className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:v.name,onChange:w=>j({...v,name:w.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:v.price,onChange:w=>j({...v,price:w.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input",value:v.quantity,onChange:w=>j({...v,quantity:w.target.value}),required:!0}),e.jsxs("select",{className:"input",value:v.unit,onChange:w=>j({...v,unit:w.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:s?"Update":"Add"}),e.jsx("button",{type:"button",onClick:()=>{N(!1),u(null)},className:"btn-secondary",children:"Cancel"})]})]})]})})]}),m==="sales"&&e.jsxs("div",{className:"p-6 max-w-7xl mx-auto w-full space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Daily Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",S.dailySales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(de,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Weekly Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",S.weeklySales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(ae,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-purple-500 to-pink-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",S.totalSales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(W,{className:"w-8 h-8"})})]})})]}),e.jsxs("div",{className:"card shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sales History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),t?.plan==="ultra"&&e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:E.slice(0,20).map(w=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(w.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[w.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:w.paymentMethod||"cash"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",w.total?.toLocaleString()]}),t?.plan==="ultra"&&e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",w.profit?.toLocaleString()||0]})]},w.id))})]})})]})]})]})}function ts(){const{user:t,updateUser:p,logout:n}=G(),g=Z(),[r,h]=x.useState(!1),[a,d]=x.useState(t?.plan||"basic"),o=[{id:"basic",name:"Basic Package",price:900,features:["Cashier Dashboard","Sales Tracking","Product Management","Basic Reports"]},{id:"ultra",name:"Ultra Package",price:1600,features:["Admin Dashboard","Recipe Builder","User Management","Advanced Analytics","Expense Tracking"]}],i=async()=>{const m=o.find(l=>l.id===a),b=a==="ultra"?"admin":"cashier";await p({...t,role:b,plan:a,price:m.price}),h(!1),setTimeout(()=>window.location.href=b==="admin"?"/admin":"/cashier",500)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100",children:[e.jsx("nav",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200 px-6 py-4 sticky top-0 z-50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>g("/cashier"),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(wt,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Settings"})]}),e.jsx("button",{onClick:n,className:"btn-secondary",children:"Logout"})]})}),e.jsx("div",{className:"p-6 max-w-6xl mx-auto space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(Ne,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Account Information"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("p",{className:"font-medium",children:t?.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:t?.role})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(ie,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Subscription"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Current Plan"}),e.jsxs("p",{className:"font-medium capitalize",children:[t?.plan," Package"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Price"}),e.jsxs("p",{className:"font-medium",children:["KSH ",t?.price,"/month"]})]}),e.jsx("button",{onClick:()=>h(!0),className:"btn-primary text-sm w-full",children:"Change Plan"})]})]})]})}),r&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Change Your Plan"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:o.map(m=>e.jsxs("div",{onClick:()=>d(m.id),className:`card cursor-pointer transition-all ${a===m.id?"ring-4 ring-blue-600 bg-blue-50":"hover:shadow-lg"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-xl font-bold",children:m.name}),a===m.id&&e.jsx(Q,{className:"w-6 h-6 text-blue-600"})]}),e.jsxs("p",{className:"text-3xl font-bold mb-4",children:["KSH ",m.price,e.jsx("span",{className:"text-sm text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:m.features.map((b,l)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Q,{className:"w-4 h-4 text-green-600"}),b]},l))})]},m.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:i,className:"btn-primary flex-1",children:"Confirm Change"}),e.jsx("button",{onClick:()=>h(!1),className:"btn-secondary",children:"Cancel"})]})]})})]})}function ss(){const[t,p]=x.useState([]),[n,g]=x.useState([]),[r,h]=x.useState("all"),[a,d]=x.useState(""),[o,i]=x.useState(!1),[m,b]=x.useState([]),[l,N]=x.useState({subject:"",message:""}),[s,u]=x.useState(!0),[v,j]=x.useState(null),[y,A]=x.useState({totalUsers:0,activeUsers:0,lockedUsers:0,totalRevenue:0,pendingPayments:0,overduePayments:0});x.useEffect(()=>{E().finally(()=>u(!1))},[]);const E=async()=>{try{const f=localStorage.getItem("token"),k="/api";try{const C=await fetch(`${k}/main-admin/users`,{headers:{Authorization:`Bearer ${f}`}});if(C.ok){const D=await C.json();p(D)}else{const D=await fetch(`${k}/users`,{headers:{Authorization:`Bearer ${f}`}});if(D.ok){const q=await D.json();p(q)}}}catch{p([])}try{const C=await fetch(`${k}/main-admin/payments`,{headers:{Authorization:`Bearer ${f}`}});if(C.ok){const D=await C.json();g(D)}}catch{console.log("Payments endpoint not available, using empty data"),g([])}if(t.length===0){const C=R();p(C),S(C,[])}else S(t,n)}catch(f){console.error("Failed to load data:",f);{const k=R();p(k),S(k,[])}}},R=()=>{const f=localStorage.getItem("user"),k=[];if(f){const D=JSON.parse(f);k.push(D)}return[{name:"John Doe",email:"john@example.com",plan:"ultra",price:1600,active:!0,locked:!1},{name:"Jane Smith",email:"jane@example.com",plan:"basic",price:900,active:!0,locked:!1},{name:"Bob Wilson",email:"bob@example.com",plan:"ultra",price:1600,active:!1,locked:!1},{name:"Alice Brown",email:"alice@example.com",plan:"basic",price:900,active:!0,locked:!0}].forEach((D,q)=>{k.find(I=>I.email===D.email)||k.push({id:Date.now()+q,...D,role:D.plan==="ultra"?"admin":"cashier",createdAt:new Date(Date.now()-q*864e5).toISOString()})}),k},S=(f,k)=>{const C=f.length,D=f.filter(L=>L.active).length,q=f.filter(L=>L.locked).length,I=k.filter(L=>L.status==="paid").reduce((L,X)=>L+X.amount,0),U=k.filter(L=>L.status==="pending").length,z=k.filter(L=>L.status==="overdue").length;A({totalUsers:C,activeUsers:D,lockedUsers:q,totalRevenue:I,pendingPayments:U,overduePayments:z})},T=async(f,k)=>{try{const C=localStorage.getItem("token"),D="/api";try{if((await fetch(`${D}/main-admin/users/${f}/lock`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${C}`},body:JSON.stringify({locked:!k})})).ok){E();return}}catch{console.warn("Backend not available, using client-side update")}const q=t.map(U=>U.id===f?{...U,locked:!k,active:k}:U);p(q),S(q,n);const I=localStorage.getItem("user");if(I){const U=JSON.parse(I);U.id===f&&(U.locked=!k,U.active=k,localStorage.setItem("user",JSON.stringify(U)))}}catch(C){console.error("Failed to toggle lock:",C),alert("Failed to update user lock status.")}},H=async(f,k,C)=>{try{const D=localStorage.getItem("token"),q="/api";try{if((await fetch(`${q}/main-admin/send-email`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${D}`},body:JSON.stringify({userIds:f,subject:k,message:C})})).ok){alert("Emails sent successfully!"),i(!1),b([]),N({subject:"",message:""});return}}catch{console.warn("Backend not available, simulating email send")}const I=t.filter(L=>f.includes(L.id)),U={timestamp:new Date().toISOString(),recipients:I.map(L=>({id:L.id,name:L.name,email:L.email})),subject:k,message:C,status:"simulated"},z=JSON.parse(localStorage.getItem("emailLogs")||"[]");z.push(U),localStorage.setItem("emailLogs",JSON.stringify(z)),alert(`Email simulated successfully!

Sent to ${I.length} user(s):
${I.map(L=>L.email).join(", ")}

Note: Deploy backend to send real emails.`),i(!1),b([]),N({subject:"",message:""})}catch(D){console.error("Failed to send email:",D),alert("Failed to process email request.")}},B=async f=>{const k=t.find(C=>C.id===f);k&&await H([f],"Payment Reminder - Subscription Upgrade",`Dear ${k.name},

This is a friendly reminder about your pending subscription payment for ${k.plan?.toUpperCase()} plan (KSH ${k.price}).

Please complete your payment to continue enjoying our services.

Thank you!`)},c=t.filter(f=>{const k=f.name?.toLowerCase().includes(a.toLowerCase())||f.email?.toLowerCase().includes(a.toLowerCase());if(r==="all")return k;if(r==="active")return k&&f.active&&!f.locked;if(r==="locked")return k&&f.locked;if(r==="pending-payment"){const C=n.filter(D=>D.userId===f.id&&D.status==="pending");return k&&C.length>0}if(r==="overdue"){const C=n.filter(D=>D.userId===f.id&&D.status==="overdue");return k&&C.length>0}return k}),P=f=>{const k=n.filter(I=>I.userId===f),C=k.filter(I=>I.status==="pending").length,D=k.filter(I=>I.status==="overdue").length,q=k.filter(I=>I.status==="paid").length;return{pending:C,overdue:D,paid:q,total:k.length}};return s?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-white mx-auto mb-4"}),e.jsx("p",{className:"text-white text-xl",children:"Loading Main Admin Dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-3 text-center",children:e.jsxs("p",{className:"text-sm md:text-base font-semibold",children:["âš ï¸ Demo Mode: Backend not deployed. Actions are simulated locally.",e.jsx("a",{href:"/BACKEND_NOT_DEPLOYED.md",className:"underline ml-2",children:"Deploy Backend â†’"})]})}),e.jsx("header",{className:"bg-black/30 backdrop-blur-lg border-b border-white/10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Main Admin Dashboard"}),e.jsx("p",{className:"text-gray-300",children:"Monitor all users, payments, and system activity"})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ge,{className:"w-8 h-8 text-blue-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:y.totalUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ce,{className:"w-8 h-8 text-green-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:y.activeUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Active Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(V,{className:"w-8 h-8 text-red-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:y.lockedUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Locked Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(de,{className:"w-8 h-8 text-yellow-400"}),e.jsxs("span",{className:"text-2xl font-bold text-white",children:["KSH ",y.totalRevenue.toLocaleString()]})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Revenue"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ze,{className:"w-8 h-8 text-orange-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:y.pendingPayments})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Pending Payments"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ee,{className:"w-8 h-8 text-red-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:y.overduePayments})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Overdue Payments"})]})]}),e.jsx("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4 flex-1 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-80",children:[e.jsx(Ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search users...",className:"w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",value:a,onChange:f=>d(f.target.value)})]}),e.jsxs("select",{value:r,onChange:f=>h(f.target.value),className:"px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Users"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"locked",children:"Locked"}),e.jsx("option",{value:"pending-payment",children:"Pending Payment"}),e.jsx("option",{value:"overdue",children:"Overdue"})]})]}),e.jsxs("button",{onClick:()=>i(!0),disabled:m.length===0,className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-6 py-3 rounded-lg font-bold flex items-center gap-2 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(De,{className:"w-5 h-5"}),"Send Email to Selected (",m.length,")"]})]})}),e.jsx("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl border border-white/20 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-black/30",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left",children:e.jsx("input",{type:"checkbox",checked:m.length===c.length&&c.length>0,onChange:f=>{f.target.checked?b(c.map(k=>k.id)):b([])},className:"w-5 h-5 rounded"})}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"User"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Plan"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Payments"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Joined"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Actions"})]})}),e.jsxs("tbody",{children:[c.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:"7",className:"px-4 py-12 text-center",children:[e.jsx(ge,{className:"w-16 h-16 text-gray-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:a||r!=="all"?"Try adjusting your filters":"Users will appear here once they sign up"})]})}),c.map(f=>{const k=P(f.id);return e.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:m.includes(f.id),onChange:C=>{C.target.checked?b([...m,f.id]):b(m.filter(D=>D!==f.id))},className:"w-5 h-5 rounded"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[f.profilePicture?e.jsx("img",{src:f.profilePicture,alt:f.name,className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:f.name?.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:f.name}),e.jsx("p",{className:"text-sm text-gray-400",children:f.email})]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${f.plan==="ultra"?"bg-purple-500/20 text-purple-300":"bg-blue-500/20 text-blue-300"}`,children:[f.plan?.toUpperCase()," - KSH ",f.price]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"flex items-center gap-2",children:f.locked?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-red-500/20 text-red-300 flex items-center gap-1",children:[e.jsx(V,{className:"w-3 h-3"}),"Locked"]}):f.active?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-green-500/20 text-green-300 flex items-center gap-1",children:[e.jsx(ce,{className:"w-3 h-3"}),"Active"]}):e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-gray-500/20 text-gray-300",children:"Inactive"})})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"space-y-1",children:[k.paid>0&&e.jsxs("span",{className:"text-xs text-green-400",children:["âœ“ ",k.paid," Paid"]}),k.pending>0&&e.jsxs("span",{className:"text-xs text-orange-400 block",children:["â³ ",k.pending," Pending"]}),k.overdue>0&&e.jsxs("span",{className:"text-xs text-red-400 block",children:["âš  ",k.overdue," Overdue"]})]})}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-400",children:new Date(f.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>T(f.id,f.locked),className:`p-2 rounded-lg transition ${f.locked?"bg-green-500/20 hover:bg-green-500/30 text-green-300":"bg-red-500/20 hover:bg-red-500/30 text-red-300"}`,title:f.locked?"Unlock User":"Lock User",children:f.locked?e.jsx(St,{className:"w-4 h-4"}):e.jsx(V,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>B(f.id),className:"p-2 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 transition",title:"Send Payment Reminder",children:e.jsx(kt,{className:"w-4 h-4"})})]})})]},f.id)})]})]})})})]}),o&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-purple-900 rounded-2xl shadow-2xl max-w-2xl w-full border border-white/20",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(De,{}),"Send Email to ",m.length," User(s)"]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Subject"}),e.jsx("input",{type:"text",value:l.subject,onChange:f=>N({...l,subject:f.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Email subject..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Message"}),e.jsx("textarea",{value:l.message,onChange:f=>N({...l,message:f.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 h-40",placeholder:"Email message..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>H(m,l.subject,l.message),className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white py-3 rounded-lg font-bold transition",children:"Send Email"}),e.jsx("button",{onClick:()=>i(!1),className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-lg font-bold transition",children:"Cancel"})]})]})]})})]})}class as extends x.Component{constructor(p){super(p),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(p){return{hasError:!0}}componentDidCatch(p,n){console.error("ErrorBoundary caught an error:",p,n),this.setState({error:p,errorInfo:n})}handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 max-w-md w-full text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(fe,{className:"w-8 h-8 text-red-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Something went wrong"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"We encountered an unexpected error. Please try refreshing the page or contact support if the problem persists."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:this.handleRetry,className:"w-full flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium",children:[e.jsx(Ct,{className:"w-4 h-4"}),"Try Again"]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full bg-gray-100 text-gray-700 px-4 py-3 rounded-lg hover:bg-gray-200 transition-colors font-medium",children:"Refresh Page"})]}),!1]})}):this.props.children}}function st(){return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-lg animate-pulse",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"POS"})}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})})}function se({children:t,adminOnly:p=!1}){const{user:n,loading:g,isInitialized:r}=G();if(!r||g)return e.jsx(st,{});if(!n)return e.jsx(Y,{to:"/login",replace:!0});if(p){const h=localStorage.getItem("user");let a=n;if(h)try{const i=JSON.parse(h);a={...n,...i}}catch(i){console.warn("Error parsing stored user data:",i)}const d=a.plan==="ultra"||a.role==="admin",o=a.active&&a.plan;if(!d||!o)return console.log("Access denied - User does not have admin privileges:",a),a.plan==="ultra"&&a.role!=="admin"?(a.role="admin",a.active=!0,localStorage.setItem("user",JSON.stringify(a)),window.dispatchEvent(new Event("storage")),t):e.jsx(Y,{to:"/cashier",replace:!0})}return t}function ls(){const{user:t,loading:p,isInitialized:n}=G();return!n||p?e.jsx(st,{}):t?!t.active||!t.plan?e.jsx(Y,{to:"/subscription",replace:!0}):t.plan==="ultra"||t.role==="admin"?e.jsx(Y,{to:"/admin",replace:!0}):e.jsx(Y,{to:"/cashier",replace:!0}):e.jsx(Y,{to:"/login",replace:!0})}function rs(){return e.jsx(as,{children:e.jsx(It,{children:e.jsx(ot,{children:e.jsxs(Je,{children:[e.jsx(F,{path:"/",element:e.jsx(Lt,{})}),e.jsx(F,{path:"/login",element:e.jsx(ze,{})}),e.jsx(F,{path:"/signup",element:e.jsx(ze,{})}),e.jsx(F,{path:"/subscription",element:e.jsx(se,{children:e.jsx(Ut,{})})}),e.jsx(F,{path:"/dashboard",element:e.jsx(se,{children:e.jsx(ls,{})})}),e.jsx(F,{path:"/admin/*",element:e.jsx(se,{adminOnly:!0,children:e.jsx(Zt,{})})}),e.jsx(F,{path:"/cashier",element:e.jsx(se,{children:e.jsx(es,{})})}),e.jsx(F,{path:"/cashier/settings",element:e.jsx(se,{children:e.jsx(ts,{})})}),e.jsx(F,{path:"/main.admin",element:e.jsx(ss,{})})]})})})})}Tt.createRoot(document.getElementById("root")).render(e.jsx(dt.StrictMode,{children:e.jsx(rs,{})}));
