import{a as Dt,b as Tt,g as It,r as m,u as ie,c as Et,R as dt,d as q,B as Lt,N as re,e as Ot}from"./vendor-Ct1st1Nj.js";import{S as Rt,A as ve,P as Ut,C as ze,a as te,L as mt,T as xe,U as Pe,b as xt,Z as ut,c as ht,d as le,X as Te,e as ee,f as Ie,M as Je,g as Ae,D as ne,h as pt,i as gt,j as Ve,k as G,l as Ft,m as qt,n as ft,o as Ee,p as V,q as $t,r as Mt,E as Bt,s as tt,t as Le,u as ue,v as De,w as st,x as pe,B as We,I as Ht,y as se,z as ge,F as _e,G as Kt,H as zt,J as bt,K as Jt,N as ke,O as _t,Q as Gt,R as Vt,V as Wt,W as Yt}from"./icons-JioAc6SH.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))u(n);new MutationObserver(n=>{for(const h of n)if(h.type==="childList")for(const a of h.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&u(a)}).observe(document,{childList:!0,subtree:!0});function l(n){const h={};return n.integrity&&(h.integrity=n.integrity),n.referrerPolicy&&(h.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?h.credentials="include":n.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function u(n){if(n.ep)return;n.ep=!0;const h=l(n);fetch(n.href,h)}})();var He={exports:{}},oe={};var at;function Qt(){if(at)return oe;at=1;var t=Dt(),i=Symbol.for("react.element"),l=Symbol.for("react.fragment"),u=Object.prototype.hasOwnProperty,n=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,h={key:!0,ref:!0,__self:!0,__source:!0};function a(p,x,o){var c,f={},d=null,S=null;o!==void 0&&(d=""+o),x.key!==void 0&&(d=""+x.key),x.ref!==void 0&&(S=x.ref);for(c in x)u.call(x,c)&&!h.hasOwnProperty(c)&&(f[c]=x[c]);if(p&&p.defaultProps)for(c in x=p.defaultProps,x)f[c]===void 0&&(f[c]=x[c]);return{$$typeof:i,type:p,key:d,ref:S,props:f,_owner:n.current}}return oe.Fragment=l,oe.jsx=a,oe.jsxs=a,oe}var rt;function Zt(){return rt||(rt=1,He.exports=Qt()),He.exports}var e=Zt(),we={},lt;function Xt(){if(lt)return we;lt=1;var t=Tt();return we.createRoot=t.createRoot,we.hydrateRoot=t.hydrateRoot,we}var es=Xt();const ts=It(es),jt=m.createContext(),Q=()=>m.useContext(jt),ss=({children:t})=>{const[i,l]=m.useState(()=>{try{const c=localStorage.getItem("user");return c?JSON.parse(c):null}catch(c){return console.error("Error parsing user data:",c),localStorage.removeItem("user"),null}}),[u,n]=m.useState(!0),[h,a]=m.useState(!1);m.useEffect(()=>{const c=()=>{try{const S=localStorage.getItem("token"),s=localStorage.getItem("user");if(S&&s){const g=JSON.parse(s);g.plan==="ultra"?g.role!=="admin"&&(g.role="admin",g.active=!0,g.packageType="ultra",localStorage.setItem("user",JSON.stringify(g))):g.plan==="basic"&&g.role!=="cashier"&&(g.role="cashier",g.active=!0,g.packageType="basic",localStorage.setItem("user",JSON.stringify(g))),g.plan&&!g.active&&(g.active=!0,localStorage.setItem("user",JSON.stringify(g))),l(g)}else l(null)}catch(S){console.error("Error initializing auth:",S),l(null),localStorage.removeItem("user"),localStorage.removeItem("token")}finally{n(!1),a(!0)}};c();const f=S=>{(S.key==="user"||S.key==="token")&&setTimeout(()=>{c()},50)},d=()=>{setTimeout(()=>{c()},100)};return window.addEventListener("storage",f),window.addEventListener("localStorageUpdated",d),()=>{window.removeEventListener("storage",f),window.removeEventListener("localStorageUpdated",d)}},[]);const p=(c,f)=>{try{localStorage.setItem("token",c),localStorage.setItem("user",JSON.stringify(f)),l(f)}catch(d){throw console.error("Error during login:",d),d}},x=async c=>{try{const f=localStorage.getItem("token"),d=window.location.hostname==="localhost"?"http://localhost:5001/api":"/api";localStorage.setItem("user",JSON.stringify(c)),l(c);try{const S=await fetch(`${d}/users/${c.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`},body:JSON.stringify(c)});if(!S.ok)throw new Error("Backend not available");const s=await S.json();return s.token&&localStorage.setItem("token",s.token),s.user&&(localStorage.setItem("user",JSON.stringify(s.user)),l(s.user)),s}catch(S){if(console.warn("Backend not available, using client-side update:",S),!f){const s=btoa(JSON.stringify({id:c.id,email:c.email,role:c.role,plan:c.plan}));localStorage.setItem("token",s)}return{user:c,token:f||btoa(JSON.stringify(c))}}}catch(f){throw console.error("Failed to update user:",f),f}},o=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),l(null)};return e.jsx(jt.Provider,{value:{user:i,login:p,updateUser:x,logout:o,loading:u,isInitialized:h},children:t})},ae={products:[{id:1,name:"Nile Perch",cost:500,price:800,quantity:10,unit:"kg",category:"raw",recipe:null,image:"",visibleToCashier:!0,expenseOnly:!1,createdAt:new Date().toISOString()},{id:2,name:"Cooking Oil",cost:200,price:300,quantity:5,unit:"L",category:"raw",recipe:null,image:"",visibleToCashier:!0,expenseOnly:!1,createdAt:new Date().toISOString()},{id:3,name:"Fresh Tomatoes",cost:150,price:250,quantity:20,unit:"kg",category:"raw",recipe:null,image:"",visibleToCashier:!0,expenseOnly:!1,createdAt:new Date().toISOString()},{id:4,name:"Onions",cost:80,price:120,quantity:30,unit:"kg",category:"raw",recipe:null,image:"",visibleToCashier:!0,expenseOnly:!1,createdAt:new Date().toISOString()},{id:5,name:"Grilled Fish Meal",cost:300,price:600,quantity:50,unit:"pcs",category:"finished",recipe:[{productId:1,quantity:.5},{productId:3,quantity:.2},{productId:4,quantity:.1}],image:"",visibleToCashier:!0,expenseOnly:!1,createdAt:new Date().toISOString()}],sales:[],expenses:[],users:[],reminders:[],stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:2},settings:{lockTimeout:3e5,currency:"KSH",logo:"",companyName:"",address:""},serviceFees:[],discounts:[],creditRequests:[],timeEntries:[],categories:[],batches:[],production:[],priceHistory:[]},K=(t,i)=>{try{const l=JSON.stringify(i);localStorage.setItem(t,l)}catch(l){console.warn(`Failed to save to localStorage for key "${t}":`,l)}},Y=t=>{try{const i=localStorage.getItem(t);if(i===null){const l=ae[t]||[];return K(t,l),l}return JSON.parse(i)}catch(i){return console.warn(`Failed to load from localStorage for key "${t}":`,i),ae[t]||[]}},as=()=>{const t=i=>{i.key&&Object.keys(ae).includes(i.key)&&(console.log(`Data changed in another tab: ${i.key}`),window.dispatchEvent(new CustomEvent("localStorageDataChanged",{detail:{key:i.key}})))};return window.addEventListener("storage",t),()=>{window.removeEventListener("storage",t)}},nt=t=>{try{const i=localStorage.getItem(t);if(i===null){const u=ae[t]||[];return K(t,u),u}const l=JSON.parse(i);return t==="products"&&Array.isArray(l)?l.map(n=>({...n,visibleToCashier:n.visibleToCashier!==!1&&!n.expenseOnly,expenseOnly:n.expenseOnly||!1,createdAt:n.createdAt||new Date().toISOString()})):l}catch(i){return console.warn(`Failed to load from localStorage for key "${t}":`,i),ae[t]||[]}},rs=t=>{try{const i=Y(t);K(t,i),console.log(`Data refreshed for key: ${t}`)}catch(i){console.warn(`Failed to refresh data for key "${t}":`,i)}},ls=()=>{try{Object.keys(ae).forEach(t=>{localStorage.getItem(t)||(K(t,ae[t]),console.log(`Initialized localStorage with default data for key: ${t}`))})}catch(t){console.warn("Failed to initialize localStorage:",t)}};function ns(){const t=ie(),[i,l]=m.useState(!1),[u,n]=m.useState(0),h=[{title:"1. Sign Up & Choose Plan",desc:"Create your account and select between Basic (KSH 900) or Ultra (KSH 1,600) package",image:"ðŸ“",details:"First user becomes Admin automatically. Choose Ultra for full features including Recipe Builder and User Management."},{title:"2. Add Raw Materials",desc:"Stock your inventory with raw ingredients like fish, oil, breadcrumbs, salt, etc.",image:"ðŸ“¦",details:'Enter product name, cost, quantity, and unit. Mark items as "expense-only" to hide from cashiers.'},{title:"3. Create Recipes (Ultra Only)",desc:"Build composite products using the Recipe/BOM Builder",image:"ðŸ½ï¸",details:"Example: Fish Fingers = 0.02kg Nile Perch + 0.01L Oil + 0.004kg Breadcrumbs. System auto-calculates COGS and profit margin."},{title:"4. Add Cashiers (Ultra Only)",desc:"Invite team members and set their permissions",image:"ðŸ‘¥",details:"Enter name and email. Set permissions: View Sales, View Inventory, View Expenses, Manage Products. Default password: changeme123"},{title:"5. Make Sales",desc:"Cashiers use the POS to sell products",image:"ðŸ’°",details:"Search products, add to cart, select payment method (Cash/M-Pesa/Card), complete sale. Stock automatically deducted!"},{title:"6. Automatic Stock Deduction",desc:"When selling composite products, ingredients are auto-deducted",image:"âš¡",details:"Sell 1 Fish Finger â†’ System deducts 0.02kg fish, 0.01L oil, 0.004kg breadcrumbs. COGS calculated automatically!"},{title:"7. Track Analytics",desc:"Monitor sales, profit, expenses in real-time",image:"ðŸ“Š",details:"View daily/weekly sales, gross profit, net profit, COGS breakdown. Admin sees full analytics, cashiers see limited data."},{title:"8. Manage Expenses",desc:"Track manual expenses and automatic ingredient costs",image:"ðŸ’¸",details:"Add manual expenses (rent, utilities, salaries). System auto-creates expenses when expense-only items are used in recipes."}],a=[{icon:te,title:"Smart Inventory",desc:"Track raw materials & composite products with automatic stock deduction"},{icon:mt,title:"Recipe Builder",desc:"Create bundled products with BOM and auto-calculate COGS"},{icon:xe,title:"Real-time Analytics",desc:"Monitor sales, profit margins, and expenses in real-time"},{icon:Pe,title:"User Management",desc:"Add cashiers with custom permissions and role-based access"},{icon:xt,title:"Secure & Reliable",desc:"JWT authentication with role-based security"},{icon:ze,title:"Advanced Reports",desc:"Daily, weekly summaries with profit/loss tracking"}],p=[{name:"Basic",price:900,icon:ut,popular:!1,features:["Cashier Dashboard","Basic Inventory","Sales Tracking","Daily/Weekly Reports","Single User","Email Support"]},{name:"Ultra",price:1600,icon:ht,popular:!0,features:["Admin + Cashier Dashboard","Full Inventory Management","Recipe/BOM Builder","Auto Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Unlimited Users","Priority Support"]}];return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-blue-600 via-purple-600 to-pink-600",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-10"}),e.jsx("nav",{className:"relative z-10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-white rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"P"})}),e.jsx("span",{className:"text-2xl font-bold text-white",children:"POSify"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t("/login"),className:"text-white hover:text-blue-100 font-medium",children:"Login"}),e.jsx("button",{onClick:()=>t("/signup"),className:"bg-white text-blue-600 px-6 py-2 rounded-lg font-semibold hover:shadow-lg transition-all",children:"Get Started"})]})]})}),e.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto px-6 py-20 text-center",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 bg-white/20 backdrop-blur-sm px-4 py-2 rounded-full text-white text-sm font-medium mb-6",children:[e.jsx(Rt,{className:"w-4 h-4 fill-yellow-300 text-yellow-300"}),"Trusted by 500+ businesses"]}),e.jsxs("h1",{className:"text-5xl md:text-7xl font-bold text-white mb-6 leading-tight",children:["Modern POS System",e.jsx("br",{}),e.jsx("span",{className:"text-blue-200",children:"Built for Growth"})]}),e.jsx("p",{className:"text-xl text-blue-100 mb-8 max-w-2xl mx-auto",children:"Complete inventory management with recipe builder, automatic stock deduction, and real-time analytics. Everything you need to run your business efficiently."}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsxs("button",{onClick:()=>t("/signup"),className:"bg-white text-blue-600 px-8 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all flex items-center gap-2",children:["Start Free Trial",e.jsx(ve,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:()=>l(!0),className:"border-2 border-white text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-white/10 transition-all flex items-center gap-2",children:[e.jsx(Ut,{className:"w-5 h-5"}),"Watch Demo"]})]}),e.jsx("p",{className:"text-blue-200 text-sm mt-4",children:"No credit card required â€¢ 14-day free trial"})]}),e.jsx("div",{className:"relative z-10 max-w-6xl mx-auto px-6 pb-20",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-2 transform hover:scale-105 transition-all duration-500",children:e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-8 aspect-video flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ze,{className:"w-24 h-24 text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Dashboard Preview"})]})})})})]}),e.jsx("div",{className:"py-20 px-6 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Everything You Need"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Powerful features to streamline your business operations"})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-8",children:a.map((x,o)=>{const c=x.icon;return e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl transition-all transform hover:-translate-y-2",children:[e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center mb-4",children:e.jsx(c,{className:"w-7 h-7 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:x.title}),e.jsx("p",{className:"text-gray-600",children:x.desc})]},o)})})]})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-4",children:"Simple, Transparent Pricing"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Choose the plan that fits your business"})]}),e.jsx("div",{className:"grid md:grid-cols-2 gap-8 max-w-5xl mx-auto",children:p.map((x,o)=>{const c=x.icon;return e.jsxs("div",{className:`relative bg-white rounded-2xl p-8 shadow-lg hover:shadow-2xl transition-all transform hover:scale-105 ${x.popular?"ring-4 ring-blue-600":""}`,children:[x.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-bold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${x.popular?"bg-gradient-to-br from-blue-600 to-purple-600":"bg-gradient-to-br from-green-600 to-teal-600"}`,children:e.jsx(c,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold",children:x.name}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Package"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("span",{className:"text-5xl font-bold",children:["KSH ",x.price]}),e.jsx("span",{className:"text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-3 mb-8",children:x.features.map((f,d)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-gray-700",children:f})]},d))}),e.jsx("button",{onClick:()=>t("/signup"),className:`w-full py-4 rounded-xl font-bold text-lg transition-all ${x.popular?"bg-gradient-to-r from-blue-600 to-purple-600 text-white hover:shadow-xl transform hover:scale-105":"bg-gray-100 text-gray-900 hover:bg-gray-200"}`,children:"Get Started"})]},o)})})]})}),e.jsx("div",{className:"py-20 px-6 bg-gradient-to-br from-blue-600 to-purple-600",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-8 text-center text-white",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"500+"}),e.jsx("div",{className:"text-blue-200",children:"Active Businesses"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"50K+"}),e.jsx("div",{className:"text-blue-200",children:"Transactions/Day"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"99.9%"}),e.jsx("div",{className:"text-blue-200",children:"Uptime"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-5xl font-bold mb-2",children:"24/7"}),e.jsx("div",{className:"text-blue-200",children:"Support"})]})]})})}),e.jsx("div",{className:"py-20 px-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold mb-6",children:"Ready to Transform Your Business?"}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:"Join hundreds of businesses already using POSify to streamline their operations"}),e.jsxs("button",{onClick:()=>t("/signup"),className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-12 py-4 rounded-xl font-bold text-lg hover:shadow-2xl transform hover:scale-105 transition-all inline-flex items-center gap-2",children:["Start Your Free Trial",e.jsx(ve,{className:"w-5 h-5"})]}),e.jsx("p",{className:"text-gray-500 text-sm mt-4",children:"No credit card required â€¢ Cancel anytime"})]})}),e.jsx("footer",{className:"bg-gray-900 text-gray-400 py-12 px-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-white",children:"P"})}),e.jsx("span",{className:"text-xl font-bold text-white",children:"POSify"})]}),e.jsx("p",{className:"mb-4",children:"Modern POS System for Modern Businesses"}),e.jsx("p",{className:"text-sm",children:"Â© 2024 POSify. All rights reserved."})]})}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"How POSify Works"}),e.jsx("button",{onClick:()=>{l(!1),n(0)},className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Te,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Step ",u+1," of ",h.length]}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[Math.round((u+1)/h.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 h-2 rounded-full transition-all duration-300",style:{width:`${(u+1)/h.length*100}%`}})})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:h[u].image}),e.jsx("h3",{className:"text-3xl font-bold mb-3",children:h[u].title}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:h[u].desc}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-6 text-left",children:e.jsx("p",{className:"text-gray-700",children:h[u].details})})]}),e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("button",{onClick:()=>n(Math.max(0,u-1)),disabled:u===0,className:"btn-secondary disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),u<h.length-1?e.jsxs("button",{onClick:()=>n(u+1),className:"btn-primary flex items-center gap-2",children:["Next Step",e.jsx(ve,{className:"w-4 h-4"})]}):e.jsxs("button",{onClick:()=>{l(!1),n(0),t("/signup")},className:"btn-primary bg-gradient-to-r from-blue-600 to-purple-600 flex items-center gap-2",children:["Get Started Now",e.jsx(ve,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"flex items-center justify-center gap-2 mt-8",children:h.map((x,o)=>e.jsx("button",{onClick:()=>n(o),className:`w-2 h-2 rounded-full transition-all ${o===u?"w-8 bg-blue-600":"bg-gray-300 hover:bg-gray-400"}`},o))})]})]})})]})}const is=window.location.hostname==="localhost"?"http://localhost:5002/api":"/api",cs=()=>localStorage.getItem("token"),F=async(t,i={})=>{const l=cs(),u={...i,headers:{"Content-Type":"application/json",...l&&{Authorization:`Bearer ${l}`},...i.headers}},h=(a=>a.includes("/products")?"products":a.includes("/sales")?"sales":a.includes("/expenses")?"expenses":a.includes("/users")?"users":a.includes("/reminders")?"reminders":a.includes("/stats")?"stats":a.includes("/settings")?"settings":a.includes("/service-fees")?"serviceFees":a.includes("/discounts")?"discounts":a.includes("/credit-requests")?"creditRequests":a.includes("/time-entries")?"timeEntries":a.includes("/categories")?"categories":a.includes("/batches")?"batches":a.includes("/production")?"production":a.includes("/price-history")?"priceHistory":null)(t);try{const a=await fetch(`${is}${t}`,u);if(t.includes("/auth/")){if(!a.ok){const x=await a.json().catch(()=>({error:"Authentication failed"}));throw new Error(x.error||"Authentication failed")}return await a.json()}if(a.status===401)throw console.warn("Session expired or token invalid. Backend returned 401."),new Error("Session expired. Please login again.");if(a.status===204)return{success:!0,message:"Operation completed successfully"};if(!a.ok&&(i.method==="POST"||i.method==="PUT"||i.method==="DELETE")){const x=await a.json().catch(()=>({error:"Operation failed"}));throw new Error(x.error||`HTTP ${a.status}: ${a.statusText}`)}if(!a.ok)return console.warn(`API request failed: ${t} - ${a.status}`),h?Y(h):it(t);const p=await a.json();return(!i.method||i.method==="GET")&&h&&Array.isArray(p)&&K(h,p),(i.method==="POST"||i.method==="PUT"||i.method==="DELETE")&&(setTimeout(async()=>{try{if(await isBackendAvailable()){const o=nt(h);if(o&&Array.isArray(o)){for(const c of o)if(c.pendingSync)try{await syncDataToBackend(h,c),c.pendingSync=!1}catch(f){console.warn(`Failed to sync ${h} item:`,f)}K(h,o)}}}catch(x){console.warn("Data sync failed:",x)}},100),os(h)),p}catch(a){if(t.includes("/auth/")||i.method==="POST"||i.method==="PUT"||i.method==="DELETE")throw a;return console.warn(`API request error: ${t}`,a),h?nt(h):it(t)}},it=t=>t.includes("/products")?[]:t.includes("/sales")?[]:t.includes("/expenses")?[]:t.includes("/users")?[]:t.includes("/reminders")?[]:t.includes("/stats")?{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0}:t.includes("/settings")?{lockTimeout:3e5,currency:"KSH",logo:"",companyName:"",address:""}:t.includes("/service-fees")?[]:t.includes("/discounts")?[]:t.includes("/credit-requests")?[]:t.includes("/time-entries")?[]:t.includes("/categories")?[]:t.includes("/batches")?[]:t.includes("/production")?[]:t.includes("/price-history")?[]:{},Ke={login:t=>F("/auth/login",{method:"POST",body:JSON.stringify(t)}),signup:t=>F("/auth/signup",{method:"POST",body:JSON.stringify(t)})},z={getAll:()=>F("/products"),create:async t=>{try{const i=await F("/products",{method:"POST",body:JSON.stringify(t)}),l=Y("products");return l.push(i),K("products",l),i}catch(i){console.warn("Backend not available, saving product locally:",i);const l=Y("products"),u={...t,id:Date.now(),pendingSync:!0,createdAt:new Date().toISOString()};return l.push(u),K("products",l),u}},update:async(t,i)=>{try{const l=await F(`/products/${t}`,{method:"PUT",body:JSON.stringify(i)}),u=Y("products"),n=u.findIndex(h=>h.id===t);return n!==-1&&(u[n]=l,K("products",u)),l}catch(l){console.warn("Backend not available, updating product locally:",l);const u=Y("products"),n=u.findIndex(h=>h.id===t);if(n!==-1)return u[n]={...u[n],...i,pendingSync:!0},K("products",u),u[n];throw l}},delete:async t=>{try{const i=await F(`/products/${t}`,{method:"DELETE"}),u=Y("products").filter(n=>n.id!==t);return K("products",u),i}catch(i){console.warn("Backend not available, marking product for deletion locally:",i);const l=Y("products"),u=l.findIndex(n=>n.id===t);if(u!==-1)return l[u]={...l[u],pendingDelete:!0,pendingSync:!0},K("products",l),{success:!0,message:"Product marked for deletion"};throw i}}},fe={getAll:()=>F("/sales"),create:t=>F("/sales",{method:"POST",body:JSON.stringify(t)})},ct={getAll:()=>F("/expenses"),create:t=>F("/expenses",{method:"POST",body:JSON.stringify(t)})},yt={get:()=>F("/stats")},Se={getAll:()=>F("/users"),create:t=>F("/users",{method:"POST",body:JSON.stringify(t)}),update:(t,i)=>F(`/users/${t}`,{method:"PUT",body:JSON.stringify(i)}),delete:t=>F(`/users/${t}`,{method:"DELETE"})},me={getAll:()=>F("/discounts"),create:t=>F("/discounts",{method:"POST",body:JSON.stringify(t)}),update:(t,i)=>F(`/discounts/${t}`,{method:"PUT",body:JSON.stringify(i)}),delete:t=>F(`/discounts/${t}`,{method:"DELETE"})},he={getAll:()=>F("/credit-requests"),create:t=>F("/credit-requests",{method:"POST",body:JSON.stringify(t)}),approve:t=>F(`/credit-requests/${t}/approve`,{method:"POST"}),reject:t=>F(`/credit-requests/${t}/reject`,{method:"POST"})},Ge={get:()=>F("/settings"),update:t=>F("/settings",{method:"POST",body:JSON.stringify(t)})},os=t=>{const i=`dataUpdate_${t}`;localStorage.setItem(i,Date.now().toString()),typeof window<"u"&&window.localStorage&&window.dispatchEvent(new CustomEvent("dataUpdate",{detail:{dataType:t,timestamp:Date.now()}}))},Ce="/api",ds=async t=>{try{const i=localStorage.getItem("token");if(!i)return!1;const l=await fetch(`${Ce}/users`,{headers:{Authorization:`Bearer ${i}`}});if(l.ok){const n=(await l.json()).find(h=>h.email===t.email);return n?(await fetch(`${Ce}/users/${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(t)})).ok:(await fetch(`${Ce}/users`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify(t)})).ok}}catch(i){return console.warn("Failed to sync user to backend:",i),!1}return!1},ms=()=>{try{const t=localStorage.getItem("user");if(t)return[JSON.parse(t)]}catch(t){console.error("Error getting local users:",t)}return[]},xs=async()=>{try{return(await fetch(`${Ce}/stats`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).ok}catch{return!1}};function ot(){const[t,i]=m.useState(!1),[l,u]=m.useState({email:"",password:"",name:"",newPassword:"",confirmPassword:""}),[n,h]=m.useState(""),[a,p]=m.useState(!1),[x,o]=m.useState(!1),c=ie(),{login:f}=Q(),d=async S=>{S.preventDefault(),h(""),p(!0);try{if(x){if(l.newPassword!==l.confirmPassword){h("Passwords do not match"),p(!1);return}if(l.newPassword.length<6){h("Password must be at least 6 characters"),p(!1);return}const b=await Ke.login({email:l.email,newPassword:l.newPassword});b.token&&b.user&&(f(b.token,b.user),window.location.href="/cashier");return}let s;try{s=t?await Ke.login({email:l.email,password:l.password}):await Ke.signup(l)}catch{if(console.warn("Backend not available, using client-side auth"),t){const y=localStorage.getItem("user");if(y){const N=JSON.parse(y);if(N.email===l.email)s={token:btoa(JSON.stringify({id:N.id,email:N.email,role:N.role})),user:N};else throw new Error("Invalid credentials")}else throw new Error("No account found. Please sign up first.")}else{const y={id:Date.now(),email:l.email,password:l.password,name:l.name||l.email.split("@")[0],role:"admin",plan:null,price:null,active:!1,createdAt:new Date().toISOString()};s={token:btoa(JSON.stringify({id:y.id,email:y.email,role:y.role})),user:y}}}if(s.needsPasswordSetup){o(!0),u({...l,email:s.email}),h(""),p(!1);return}if(!s||!s.user)throw console.error("Invalid response:",s),new Error("Authentication failed. Please try again.");const g=s.token||btoa(JSON.stringify({id:s.user.id,email:s.user.email,role:s.user.role,plan:s.user.plan}));if(f(g,s.user),s.token||setTimeout(async()=>{await xs()&&await ds(s.user)},1e3),s.user.needsPasswordSetup){o(!0),u({...l,email:s.user.email}),h(""),p(!1);return}if(s.user.role==="cashier"&&s.user.addedByAdmin){window.location.href="/cashier";return}!s.user.active||!s.user.plan?c("/subscription"):s.user.role==="admin"?c("/admin"):s.user.role==="cashier"?c("/cashier"):c("/dashboard")}catch(s){h(s.message||"Authentication failed. Please try again.")}finally{p(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center p-4 md:p-6",children:[e.jsx("div",{className:"absolute inset-0 bg-grid-pattern opacity-5"}),e.jsxs("div",{className:"card w-full max-w-md shadow-2xl backdrop-blur-sm bg-white/95 border-0 animate-fade-in relative z-10",children:[e.jsxs("div",{className:"text-center mb-6 md:mb-8",children:[e.jsx("div",{className:"w-14 h-14 md:w-16 md:h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl mx-auto mb-3 md:mb-4 flex items-center justify-center shadow-lg",children:e.jsx("span",{className:"text-xl md:text-2xl font-bold text-white",children:"POS"})}),e.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:t?"Welcome Back":"Get Started"}),e.jsx("p",{className:"text-gray-600 text-xs md:text-sm",children:t?"Login to your account":"Create your account to continue"})]}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[x?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-600 text-center mb-4",children:"Welcome! Please set your password to continue."}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"New Password",className:"input pl-10",value:l.newPassword,onChange:S=>u({...l,newPassword:S.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Confirm Password",className:"input pl-10",value:l.confirmPassword,onChange:S=>u({...l,confirmPassword:S.target.value}),required:!0})]})]}):e.jsxs(e.Fragment,{children:[!t&&e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Full Name",className:"input pl-10",value:l.name,onChange:S=>u({...l,name:S.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Je,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"email",placeholder:"Email",className:"input pl-10",value:l.email,onChange:S=>u({...l,email:S.target.value}),required:!0})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"password",placeholder:"Password",className:"input pl-10",value:l.password,onChange:S=>u({...l,password:S.target.value}),required:!0})]})]}),n&&e.jsx("div",{className:"text-red-600 text-sm text-center",children:n}),e.jsx("button",{type:"submit",disabled:a,className:"btn-primary w-full text-base md:text-lg py-2.5 md:py-3 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",children:a?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):x?"Set Password":t?"Login":"Sign Up"})]}),!x&&e.jsx("div",{className:"text-center mt-6",children:e.jsx("button",{onClick:()=>i(!t),className:"text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-sm font-semibold transition-all",children:t?"Don't have an account? Sign up":"Already have an account? Login"})})]})]})}function us(){const[t,i]=m.useState("ultra"),l=ie(),{user:u,updateUser:n}=Q(),h=[{id:"basic",name:"Basic Package",price:900,icon:ut,color:"from-green-500 to-teal-600",features:["Cashier Dashboard Only","Basic Inventory Management","Sales Tracking","Daily/Weekly Sales Summaries","Basic Profit/Loss View","Limited Email Notifications","Record Products Sold","Single User Access"]},{id:"ultra",name:"Ultra Package",price:1600,icon:ht,color:"from-blue-600 to-purple-600",popular:!0,features:["Admin Dashboard + Cashier POS","Full Inventory Management","Recipe/BOM Builder","Composite Products Support","Automatic Stock Deduction","COGS Calculation","User Management","Permission Controls","Expense Tracking","Advanced Analytics","Unlimited Users"]}],a=async()=>{try{const p=h.find(c=>c.id===t),x={...u,role:t==="ultra"?"admin":"cashier",plan:t,price:p.price,active:!0,packageType:t};localStorage.setItem("user",JSON.stringify(x)),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new Event("localStorageUpdated")),await n(x).catch(c=>{console.warn("Auth context update failed, but localStorage updated:",c)}),await new Promise(c=>setTimeout(c,1e3));let o;t==="ultra"?o="/admin":o="/cashier",window.location.hostname!=="localhost"&&window.location.hostname!=="127.0.0.1"?window.location.href=o:l(o,{replace:!0})}catch(p){console.error("Subscription error:",p),alert("Failed to update subscription. Please try again.")}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 py-6 md:py-12 px-4 md:px-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8 md:mb-12 animate-fade-in",children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-bold mb-3 md:mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Choose Your Plan"}),e.jsx("p",{className:"text-gray-600 text-base md:text-lg",children:"Select the perfect plan for your business needs"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-6 md:mb-8",children:h.map(p=>{const x=p.icon;return e.jsxs("div",{onClick:()=>i(p.id),className:`card cursor-pointer transition-all transform hover:scale-105 relative ${t===p.id?"ring-4 ring-blue-600 shadow-2xl bg-gradient-to-br from-blue-50 to-purple-50":"hover:shadow-xl"}`,children:[p.popular&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-1 rounded-full text-sm font-semibold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-3 md:mb-4",children:[e.jsx("div",{className:`w-10 h-10 md:w-12 md:h-12 rounded-xl bg-gradient-to-br ${p.color} flex items-center justify-center`,children:e.jsx(x,{className:"w-5 h-5 md:w-6 md:h-6 text-white"})}),e.jsx("h3",{className:"text-xl md:text-2xl font-bold",children:p.name})]}),e.jsxs("div",{className:"mb-4 md:mb-6",children:[e.jsxs("span",{className:"text-3xl md:text-4xl font-bold",children:["KSH ",p.price]}),e.jsx("span",{className:"text-gray-600 text-sm md:text-base",children:"/month"})]}),e.jsx("ul",{className:"space-y-2 md:space-y-3",children:p.features.map((o,c)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(le,{className:"w-4 h-4 md:w-5 md:h-5 text-green-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs md:text-sm",children:o})]},c))})]},p.id)})}),e.jsxs("div",{className:"text-center animate-fade-in",children:[e.jsx("button",{onClick:a,className:"btn-primary w-full md:w-auto px-8 md:px-12 py-3 md:py-4 text-base md:text-lg bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 shadow-lg hover:shadow-xl transform hover:scale-105 transition-all",children:"Continue to Dashboard"}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 mt-3 md:mt-4",children:"Start your journey today â€¢ Cancel anytime"})]})]})})}function hs(){const[t,i]=m.useState({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]}),[l,u]=m.useState(!0),[n,h]=m.useState(null);m.useEffect(()=>{a()},[]);const a=async()=>{try{h(null);const[o,c]=await Promise.all([yt.get(),fe.getAll()]),f={totalSales:o?.totalSales||0,totalExpenses:o?.totalExpenses||0,profit:o?.profit||0,grossProfit:o?.grossProfit||0,netProfit:o?.netProfit||0,totalCOGS:o?.totalCOGS||0,dailySales:o?.dailySales||0,weeklySales:o?.weeklySales||0,productCount:o?.productCount||0},d=Array.isArray(c)?c:[];i({stats:f,recentSales:d.slice(-10).reverse()})}catch(o){console.error("Failed to load data:",o),h(o.message),i({stats:{totalSales:0,totalExpenses:0,profit:0,grossProfit:0,netProfit:0,totalCOGS:0,dailySales:0,weeklySales:0,productCount:0},recentSales:[]})}finally{u(!1)}};if(l)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(n&&t.stats.totalSales===0&&t.recentSales.length===0)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 text-center",children:[e.jsx(Ae,{className:"w-12 h-12 text-red-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Unable to Load Dashboard"}),e.jsx("p",{className:"text-red-600 mb-4",children:n}),e.jsx("button",{onClick:a,className:"btn-primary",children:"Retry"})]})});const p=[{label:"Total Sales",value:`KSH ${t.stats.totalSales?.toLocaleString()||0}`,icon:ne,color:"from-green-500 to-emerald-600",change:"+12.5%"},{label:"Gross Profit",value:`KSH ${t.stats.grossProfit?.toLocaleString()||0}`,icon:xe,color:"from-blue-500 to-indigo-600",change:"+8.2%"},{label:"Total COGS",value:`KSH ${t.stats.totalCOGS?.toLocaleString()||0}`,icon:te,color:"from-orange-500 to-red-600",change:"+5.1%"},{label:"Net Profit",value:`KSH ${t.stats.netProfit?.toLocaleString()||0}`,icon:xe,color:"from-purple-500 to-pink-600",change:"+15.3%"}],x=[{label:"Daily Sales",value:`KSH ${t.stats.dailySales?.toLocaleString()||0}`,icon:pt,color:"bg-blue-50 text-blue-600"},{label:"Weekly Sales",value:`KSH ${t.stats.weeklySales?.toLocaleString()||0}`,icon:xe,color:"bg-green-50 text-green-600"},{label:"Total Expenses",value:`KSH ${t.stats.totalExpenses?.toLocaleString()||0}`,icon:gt,color:"bg-red-50 text-red-600"},{label:"Products",value:t.stats.productCount||0,icon:te,color:"bg-purple-50 text-purple-600"}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(p||[]).map((o,c)=>{const f=o?.icon;return f?e.jsxs("div",{className:`card bg-gradient-to-br ${o.color} text-white border-0 shadow-lg hover:shadow-xl transition-all transform hover:scale-105`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center",children:e.jsx(f,{className:"w-6 h-6"})}),e.jsx("span",{className:"text-sm font-semibold bg-white/20 px-2 py-1 rounded-full",children:o.change})]}),e.jsx("p",{className:"text-sm text-white/80 mb-1",children:o.label}),e.jsx("p",{className:"text-2xl font-bold",children:o.value})]},c):null})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:(x||[]).map((o,c)=>{const f=o?.icon;return f?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${o.color} flex items-center justify-center`,children:e.jsx(f,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:o.label}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:o.value})]})]})},c):null})}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Sales"}),e.jsx("button",{className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"View All"})]}),!t.recentSales||t.recentSales.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ae,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No sales yet"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:(t.recentSales||[]).map(o=>o?e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:o.createdAt?new Date(o.createdAt).toLocaleString():"N/A"}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[Array.isArray(o.items)?o.items.length:0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:o.paymentMethod||"N/A"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",o.total?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",o.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",o.profit?.toLocaleString()||0]})]},o.id||Math.random()):null)})]})})]})]})}function ps(){const[t,i]=m.useState([]),[l,u]=m.useState("all"),[n,h]=m.useState(""),[a,p]=m.useState(!1),[x,o]=m.useState(!1),[c,f]=m.useState(null),[d,S]=m.useState(null),[s,g]=m.useState({name:"",price:"",cost:"",quantity:"",unit:"pcs",category:"raw",expenseOnly:!1,image:"",visibleToCashier:!0}),[b,y]=m.useState({name:"",price:"",cost:"",quantity:"",unit:"pcs",category:"raw",expenseOnly:!1,image:"",visibleToCashier:!0});m.useEffect(()=>{P()},[]);const N=(r,k="success")=>{S({message:r,type:k}),setTimeout(()=>S(null),5e3)},P=async()=>{try{const r=await z.getAll();if(Array.isArray(r)){const k=r.filter(v=>!v.pendingDelete);i(k)}else console.error("Expected array but got:",typeof r,r),i([])}catch(r){console.error("Failed to load products:",r),i([])}},L=async r=>{r.preventDefault();try{const k={...s,price:parseFloat(s.price),cost:parseFloat(s.cost),quantity:parseFloat(s.quantity),visibleToCashier:!s.expenseOnly&&s.visibleToCashier!==!1},v=await z.create(k);g({name:"",price:"",cost:"",quantity:"",unit:"pcs",category:"raw",expenseOnly:!1,image:"",visibleToCashier:!0}),p(!1),await P(),N(`âœ… Product "${v.name}" added successfully! ${v.visibleToCashier?"Cashiers can now see this product.":"This product is hidden from cashiers."}`,"success")}catch(k){console.error("Failed to create product:",k),alert(`Failed to create product: ${k.message||"Unknown error"}`)}},U=async r=>{r.preventDefault();try{const k=t.find(D=>D.id===b.id);if(parseFloat(b.price)<k.price){alert("You cannot lower prices, only increase.");return}const v={...b,price:parseFloat(b.price),cost:parseFloat(b.cost),quantity:parseFloat(b.quantity)},T=await z.update(b.id,v);o(!1),await P(),alert("Product updated successfully!")}catch(k){console.error("Failed to update product:",k),alert(`Failed to update product: ${k.message||"Unknown error"}`)}},C=async r=>{try{if(!confirm("Are you sure you want to delete this product? This action cannot be undone."))return;const k=await z.delete(r);i(T=>T.filter(D=>D.id!==r));const v=k?.message||"Product deleted successfully!";alert(v),await P()}catch(k){console.error("Failed to delete product:",k);let v="Failed to delete product";k.message.includes("Failed to execute")||k.message.includes("JSON")?v="Network error. Please check your connection and try again.":k.message.includes("401")||k.message.includes("unauthorized")?v="You are not authorized to delete this product.":k.message.includes("404")||k.message.includes("not found")?v="Product not found. It may have been deleted already.":k.message&&(v=`Failed to delete product: ${k.message}`),alert(v)}},R=(t||[]).filter(r=>{if(!r)return!1;const k=r.name?.toLowerCase().includes(n.toLowerCase()),v=l==="all"||l==="raw"&&!r.recipe||l==="composite"&&r.recipe||l==="expense"&&r.expenseOnly||l==="low-stock"&&r.quantity<10;return k&&v}),$=(t||[]).filter(r=>r&&!r.recipe&&!r.expenseOnly),M=(t||[]).filter(r=>r&&r.recipe),H=(t||[]).filter(r=>r&&r.expenseOnly),B=r=>{if(!r||!r.recipe)return 0;let k=1/0;return(r.recipe||[]).forEach(v=>{if(!v)return;const T=(t||[]).find(D=>D&&D.id===v.productId);if(T&&T.quantity>0&&v.quantity>0){const D=Math.floor(T.quantity/v.quantity);k=Math.min(k,D)}}),k===1/0?0:k},w=r=>{if(!r)return 0;if(!r.recipe)return r.cost||0;let k=0;return(r.recipe||[]).forEach(v=>{if(!v)return;const T=(t||[]).find(D=>D&&D.id===v.productId);if(T&&T.quantity>0){const D=(T.cost||0)/T.quantity;k+=D*(v.quantity||0)}}),k};return e.jsxs("div",{className:"p-6 space-y-6",children:[d&&e.jsx("div",{className:`fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-md ${d.type==="success"?"bg-green-50 border border-green-200 text-green-800":d.type==="error"?"bg-red-50 border border-red-200 text-red-800":"bg-blue-50 border border-blue-200 text-blue-800"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:d.message}),e.jsx("button",{onClick:()=>S(null),className:"ml-2 text-gray-400 hover:text-gray-600",children:"Ã—"})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10 w-80",value:n,onChange:r=>h(r.target.value)})]}),e.jsxs("select",{value:l,onChange:r=>u(r.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Products"}),e.jsx("option",{value:"raw",children:"Raw Materials"}),e.jsx("option",{value:"composite",children:"Composite"}),e.jsx("option",{value:"expense",children:"Expense Only"}),e.jsx("option",{value:"low-stock",children:"Low Stock"})]})]}),e.jsxs("button",{onClick:()=>p(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Add Product"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-700 mb-2",children:"Raw Materials"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:$.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("h4",{className:"text-sm font-medium text-purple-700 mb-2",children:"Composite Products"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:M.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200",children:[e.jsx("h4",{className:"text-sm font-medium text-orange-700 mb-2",children:"Expense Items"}),e.jsx("p",{className:"text-3xl font-bold text-orange-900",children:H.length})]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Image"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cost/COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Max Units"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Margin"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(R||[]).map(r=>{if(!r)return null;const k=w(r),v=r.price?((r.price-k)/r.price*100).toFixed(1):0,T=B(r),D=c===r.id;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3",children:[r.image?e.jsx("img",{src:r.image,alt:r.name,className:"w-12 h-12 object-cover rounded-lg",onError:O=>{O.target.style.display="none",O.target.nextSibling.style.display="flex"}}):null,e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",style:{display:r.image?"none":"flex"},children:e.jsx("span",{className:"text-xs text-gray-400",children:"No Image"})})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[r.recipe&&e.jsx("button",{onClick:()=>f(D?null:r.id),className:"p-1 hover:bg-gray-200 rounded",children:D?e.jsx(Ft,{className:"w-4 h-4"}):e.jsx(qt,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium",children:r.name}),r.quantity<10&&!r.recipe&&e.jsx(ft,{className:"w-4 h-4 text-orange-500"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`badge ${r.expenseOnly?"badge-warning":r.recipe?"badge-success":"bg-blue-100 text-blue-800"}`,children:r.expenseOnly?"Expense":r.recipe?"Composite":"Raw"})}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-green-600",children:["KSH ",r.price?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-orange-600",children:["KSH ",k.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`font-medium ${r.quantity<10&&!r.recipe?"text-red-600":"text-gray-900"}`,children:[r.quantity," ",r.unit]})}),e.jsx("td",{className:"px-4 py-3",children:r.recipe?e.jsxs("span",{className:"font-semibold text-blue-600",children:[T," units"]}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:`font-semibold ${v>30?"text-green-600":v>15?"text-yellow-600":"text-red-600"}`,children:[v,"%"]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{y(r),o(!0)},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600 transition-colors",children:e.jsx(Ee,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>C(r.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600 transition-colors",children:e.jsx(V,{className:"w-4 h-4"})})]})})]},r.id),D&&r.recipe&&e.jsx("tr",{className:"bg-blue-50",children:e.jsx("td",{colSpan:"9",className:"px-4 py-4",children:e.jsxs("div",{className:"ml-8",children:[e.jsx("h4",{className:"font-semibold text-sm text-gray-700 mb-3",children:"Recipe Breakdown:"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-white",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Ingredient"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Quantity Needed"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Available"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Unit Cost"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs font-semibold text-gray-600",children:"Total Cost"})]})}),e.jsx("tbody",{children:(r.recipe||[]).map((O,W)=>{if(!O)return null;const A=(t||[]).find(ce=>ce&&ce.id===O.productId);if(!A)return null;const J=(A.cost||0)/(A.quantity||1),Oe=J*(O.quantity||0);return e.jsxs("tr",{className:"border-t border-blue-100",children:[e.jsx("td",{className:"px-3 py-2",children:A.name||"Unknown"}),e.jsxs("td",{className:"px-3 py-2",children:[O.quantity||0," ",A.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:[A.quantity||0," ",A.unit||"pcs"]}),e.jsxs("td",{className:"px-3 py-2",children:["KSH ",J.toFixed(2)]}),e.jsxs("td",{className:"px-3 py-2 font-semibold",children:["KSH ",Oe.toFixed(2)]})]},W)})}),e.jsx("tfoot",{className:"bg-white font-semibold",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",className:"px-3 py-2 text-right",children:"Total COGS per unit:"}),e.jsxs("td",{className:"px-3 py-2 text-orange-600",children:["KSH ",k.toFixed(2)]})]})})]})]})})})]})})})]})})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Product"}),e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:s.name,onChange:r=>g({...s,name:r.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",placeholder:"Image URL",className:"input flex-1",value:s.image,onChange:r=>g({...s,image:r.target.value})}),e.jsx("span",{className:"text-sm text-gray-500 self-center",children:"or"}),e.jsx("input",{type:"file",accept:"image/*",className:"input flex-1",onChange:r=>{const k=r.target.files[0];if(k){const v=new FileReader;v.onloadend=()=>{g({...s,image:v.result})},v.readAsDataURL(k)}}})]}),s.image&&e.jsx("img",{src:s.image,alt:"Preview",className:"w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:s.price,onChange:r=>g({...s,price:r.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:s.cost,onChange:r=>g({...s,cost:r.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input",value:s.quantity,onChange:r=>g({...s,quantity:r.target.value}),required:!0}),e.jsxs("select",{className:"input",value:s.unit,onChange:r=>g({...s,unit:r.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("select",{className:"input",value:s.category,onChange:r=>g({...s,category:r.target.value}),children:[e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"finished",children:"Finished Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.expenseOnly,onChange:r=>g({...s,expenseOnly:r.target.checked,visibleToCashier:!r.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!s.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.visibleToCashier,onChange:r=>g({...s,visibleToCashier:r.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Product"}),e.jsx("button",{type:"button",onClick:()=>p(!1),className:"btn-secondary",children:"Cancel"})]})]})]})}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Edit Product"}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:b.name,onChange:r=>y({...b,name:r.target.value}),required:!0}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Product Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"url",placeholder:"Image URL",className:"input flex-1",value:b.image||"",onChange:r=>y({...b,image:r.target.value})}),e.jsx("span",{className:"text-sm text-gray-500 self-center",children:"or"}),e.jsx("input",{type:"file",accept:"image/*",className:"input flex-1",onChange:r=>{const k=r.target.files[0];if(k){const v=new FileReader;v.onloadend=()=>{y({...b,image:v.result})},v.readAsDataURL(k)}}})]}),b.image&&e.jsx("img",{src:b.image,alt:"Preview",className:"w-20 h-20 object-cover rounded"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:b.price||"",onChange:r=>y({...b,price:r.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Cost",className:"input",value:b.cost||"",onChange:r=>y({...b,cost:r.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input",value:b.quantity||"",onChange:r=>y({...b,quantity:r.target.value}),required:!0}),e.jsxs("select",{className:"input",value:b.unit||"pcs",onChange:r=>y({...b,unit:r.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"}),e.jsx("option",{value:"ml",children:"Milliliters"})]})]}),e.jsxs("select",{className:"input",value:b.category||"raw",onChange:r=>y({...b,category:r.target.value}),children:[e.jsx("option",{value:"raw",children:"Raw Material"}),e.jsx("option",{value:"finished",children:"Finished Product"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:b.expenseOnly||!1,onChange:r=>y({...b,expenseOnly:r.target.checked,visibleToCashier:!r.target.checked})}),e.jsx("span",{className:"text-sm",children:"Expense Only (Hidden from cashier)"})]}),!b.expenseOnly&&e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:b.visibleToCashier!==!1,onChange:r=>y({...b,visibleToCashier:r.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Update Product"}),e.jsx("button",{type:"button",onClick:()=>o(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function gs(){const[t,i]=m.useState([]),[l,u]=m.useState([]),[n,h]=m.useState(!1),[a,p]=m.useState({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0});m.useEffect(()=>{x()},[]);const x=async()=>{const g=await z.getAll();i(g),u(g.filter(b=>!b.recipe))},o=()=>{p({...a,ingredients:[...a.ingredients,{name:"",quantity:"",unit:"pcs"}]})},c=(g,b,y)=>{const N=[...a.ingredients];N[g][b]=y,p({...a,ingredients:N})},f=g=>{p({...a,ingredients:a.ingredients.filter((b,y)=>y!==g)})},d=()=>a.ingredients.reduce((g,b)=>{const y=l.find(N=>N.name.toLowerCase()===b.name.toLowerCase());if(y&&b.quantity){const N=y.cost/y.quantity;return g+N*parseFloat(b.quantity)}return g},0),S=async g=>{g.preventDefault();const b=[];for(const N of a.ingredients){if(!N.name||!N.quantity)continue;const P=l.find(L=>L.name.toLowerCase()===N.name.toLowerCase());P?b.push({productId:P.id,quantity:parseFloat(N.quantity),unit:N.unit||"pcs"}):b.push({name:N.name,quantity:parseFloat(N.quantity),unit:N.unit||"pcs"})}if(b.length===0){alert("Please add at least one ingredient");return}const y=d();try{await z.create({name:a.name,price:parseFloat(a.price),cost:y,quantity:0,unit:"pcs",category:"composite",recipe:b,image:a.image||"",visibleToCashier:a.visibleToCashier,expenseOnly:!1}),p({name:"",price:"",ingredients:[],image:"",visibleToCashier:!0}),h(!1),x(),alert("Recipe created successfully!")}catch(N){console.error("Error creating recipe:",N),alert("Failed to create recipe. Please try again.")}},s=t.filter(g=>g.recipe);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Recipe & BOM Builder"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create composite products with ingredient recipes"})]}),e.jsxs("button",{onClick:()=>h(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Create Recipe"]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-purple-50 border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ’¡ How it works"}),e.jsx("p",{className:"text-sm text-blue-800",children:"Create composite products by defining recipes with raw ingredients. When a composite product is sold, the system automatically deducts the required quantities from raw materials and calculates COGS."}),e.jsxs("div",{className:"mt-3 p-3 bg-white rounded-lg text-sm",children:[e.jsx("strong",{children:"Example: Fish Fingers"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-gray-700",children:[e.jsx("li",{children:"â€¢ 0.02 kg Nile Perch"}),e.jsx("li",{children:"â€¢ 0.01 L Cooking Oil"}),e.jsx("li",{children:"â€¢ 0.004 kg Breadcrumbs"}),e.jsx("li",{children:"â€¢ 0.002 kg Salt"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Existing Recipes (",s.length,")"]}),s.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No recipes created yet"})}):e.jsx("div",{className:"space-y-4",children:s.map(g=>{const b=g.recipe.reduce((N,P)=>{if(P.productId){const L=t.find(U=>U.id===P.productId);if(L){const U=L.cost/L.quantity;return N+U*P.quantity}}else if(P.name){const L=t.find(U=>U.name.toLowerCase()===P.name.toLowerCase());if(L){const U=L.cost/L.quantity;return N+U*P.quantity}}return N},0),y=((g.price-b)/g.price*100).toFixed(1);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-lg",children:g.name}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm",children:[e.jsxs("span",{className:"text-green-600 font-semibold",children:["Price: KSH ",g.price]}),e.jsxs("span",{className:"text-orange-600",children:["COGS: KSH ",b.toFixed(2)]}),e.jsxs("span",{className:`font-semibold ${y>30?"text-green-600":"text-yellow-600"}`,children:["Margin: ",y,"%"]})]})]}),e.jsx("button",{className:"text-red-600 hover:bg-red-50 p-2 rounded-lg",children:e.jsx(V,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 mb-2",children:"INGREDIENTS:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:g.recipe.map((N,P)=>{let L="",U=N.unit||"pcs";if(N.productId){const C=t.find(R=>R.id===N.productId);C&&(L=C.name,U=C.unit)}else N.name&&(L=N.name,U=N.unit||"pcs");return L?e.jsxs("div",{className:"text-sm flex items-center justify-between bg-white px-3 py-2 rounded",children:[e.jsx("span",{children:L}),e.jsxs("span",{className:"font-semibold text-blue-600",children:[N.quantity," ",U]})]},P):null})})]})]},g.id)})})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create New Recipe"}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name (e.g., Fish Fingers)",className:"input",value:a.name,onChange:g=>p({...a,name:g.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Selling Price",className:"input",value:a.price,onChange:g=>p({...a,price:g.target.value}),required:!0}),e.jsx("input",{type:"url",placeholder:"Image URL (optional)",className:"input",value:a.image,onChange:g=>p({...a,image:g.target.value})})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.visibleToCashier,onChange:g=>p({...a,visibleToCashier:g.target.checked})}),e.jsx("span",{className:"text-sm",children:"Visible to Cashier"})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold",children:"Ingredients"}),e.jsx("button",{type:"button",onClick:o,className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Ingredient"})]}),e.jsx("div",{className:"space-y-3",children:a.ingredients.map((g,b)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",placeholder:"Ingredient name (e.g., Nile Perch)",className:"input flex-1",value:g.name,onChange:y=>c(b,"name",y.target.value),required:!0,list:`ingredients-list-${b}`}),e.jsx("datalist",{id:`ingredients-list-${b}`,children:l.map(y=>e.jsxs("option",{value:y.name,children:[y.name," (",y.quantity," ",y.unit," available)"]},y.id))}),e.jsx("input",{type:"number",step:"0.001",placeholder:"Qty",className:"input w-32",value:g.quantity,onChange:y=>c(b,"quantity",y.target.value),required:!0}),e.jsxs("select",{className:"input w-24",value:g.unit,onChange:y=>c(b,"unit",y.target.value),children:[e.jsx("option",{value:"pcs",children:"pcs"}),e.jsx("option",{value:"kg",children:"kg"}),e.jsx("option",{value:"g",children:"g"}),e.jsx("option",{value:"L",children:"L"}),e.jsx("option",{value:"ml",children:"ml"})]}),e.jsx("button",{type:"button",onClick:()=>f(b),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(V,{className:"w-4 h-4"})})]},b))}),a.ingredients.length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:'No ingredients added yet. Click "Add Ingredient" to start.'})]}),a.ingredients.length>0&&e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Estimated COGS:"}),e.jsxs("span",{className:"text-lg font-bold text-orange-600",children:["KSH ",d().toFixed(2)]})]}),a.price&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"font-medium",children:"Profit Margin:"}),e.jsxs("span",{className:"text-lg font-bold text-green-600",children:[((parseFloat(a.price)-d())/parseFloat(a.price)*100).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsxs("button",{type:"submit",className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[e.jsx($t,{className:"w-4 h-4"}),"Create Recipe"]}),e.jsx("button",{type:"button",onClick:()=>{h(!1),p({name:"",price:"",ingredients:[]})},className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function fs(){const[t,i]=m.useState([]),[l,u]=m.useState("all");m.useEffect(()=>{n()},[]);const n=async()=>{const o=await fe.getAll();i(o.reverse())},h=t.filter(o=>{if(l==="today")return new Date(o.createdAt).toDateString()===new Date().toDateString();if(l==="week"){const c=new Date;return c.setDate(c.getDate()-7),new Date(o.createdAt)>=c}return!0}),a=h.reduce((o,c)=>o+c.total,0),p=h.reduce((o,c)=>o+(c.cogs||0),0),x=a-p;return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("select",{value:l,onChange:o=>u(o.target.value),className:"input w-40",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"})]})}),e.jsxs("button",{className:"btn-secondary flex items-center gap-2",children:[e.jsx(Mt,{className:"w-4 h-4"}),"Export"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white",children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",a.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-orange-500 to-red-600 text-white",children:[e.jsx("p",{className:"text-sm text-orange-100 mb-1",children:"Total COGS"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",p.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Total Profit"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",x.toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sales History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"ID"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"COGS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:h.map(o=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsxs("td",{className:"px-4 py-3 text-sm font-medium",children:["#",o.id]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(o.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[o.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:o.paymentMethod})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",o.total?.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-3 text-sm text-orange-600",children:["KSH ",o.cogs?.toLocaleString()||0]}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",o.profit?.toLocaleString()||0]})]},o.id))})]})})]})]})}function bs(){const[t,i]=m.useState([]),[l,u]=m.useState(!1),[n,h]=m.useState({description:"",amount:"",category:"general"});m.useEffect(()=>{a()},[]);const a=async()=>{const f=await ct.getAll();i(f.reverse())},p=async f=>{f.preventDefault(),await ct.create({...n,amount:parseFloat(n.amount)}),h({description:"",amount:"",category:"general"}),u(!1),a()},x=t.reduce((f,d)=>f+d.amount,0),o=t.filter(f=>!f.automatic),c=t.filter(f=>f.automatic);return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Expense Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Track manual and automatic ingredient-based expenses"})]}),e.jsxs("button",{onClick:()=>u(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Add Expense"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-red-500 to-pink-600 text-white",children:[e.jsx("p",{className:"text-sm text-red-100 mb-1",children:"Total Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",x.toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white",children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Manual Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",o.reduce((f,d)=>f+d.amount,0).toLocaleString()]})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-500 to-violet-600 text-white",children:[e.jsx("p",{className:"text-sm text-purple-100 mb-1",children:"Auto Expenses"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",c.reduce((f,d)=>f+d.amount,0).toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Expense History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Category"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Amount"})]})}),e.jsx("tbody",{children:t.map(f=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(f.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:f.description}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:f.category})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${f.automatic?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"}`,children:f.automatic?"Automatic":"Manual"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-red-600",children:["KSH ",f.amount?.toLocaleString()]})]},f.id))})]})})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add Manual Expense"}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Description",className:"input",value:n.description,onChange:f=>h({...n,description:f.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:n.amount,onChange:f=>h({...n,amount:f.target.value}),required:!0}),e.jsxs("select",{className:"input",value:n.category,onChange:f=>h({...n,category:f.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"utilities",children:"Utilities"}),e.jsx("option",{value:"rent",children:"Rent"}),e.jsx("option",{value:"salaries",children:"Salaries"}),e.jsx("option",{value:"supplies",children:"Supplies"}),e.jsx("option",{value:"other",children:"Other"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Expense"}),e.jsx("button",{type:"button",onClick:()=>u(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function js(){const[t,i]=m.useState([]),[l,u]=m.useState(!1),[n,h]=m.useState(null),[a,p]=m.useState(null),[x,o]=m.useState(null),[c,f]=m.useState(0),[d,S]=m.useState({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}});m.useEffect(()=>{s()},[]),m.useEffect(()=>()=>{x?.intervalId&&clearInterval(x.intervalId)},[x]);const s=async()=>{try{const C=await Se.getAll();i(Array.isArray(C)?C:[])}catch(C){console.error("Error loading users:",C),i([])}},g=async C=>{if(C.preventDefault(),!d.password||d.password.length<6){alert("Password must be at least 6 characters long");return}try{const R=await Se.create({...d,role:"cashier",addedByAdmin:!0,needsPasswordSetup:!0});alert(`Cashier added successfully!

Login Credentials:
Email: ${d.email}
Password: ${d.password}

The cashier will need to log in and set their password first.
Please share these credentials securely.`),S({name:"",email:"",password:"",permissions:{viewSales:!0,viewInventory:!0,viewExpenses:!1,manageProducts:!1}}),u(!1),s()}catch(R){console.error("Error creating cashier:",R),alert("Failed to add cashier: "+(R.message||"Unknown error"))}},b=async(C,R)=>{await Se.update(C,{permissions:R}),s(),h(null)},y=async C=>{confirm("Are you sure you want to delete this user?")&&(await Se.delete(C),s())},N=C=>{p(C),o({isActive:!1,currentCart:[],totalSalesToday:0,salesCount:0,lastActivity:"Loading..."});const R=setInterval(()=>{L(C)},3e3);o($=>({...$,intervalId:R})),L(C)},P=()=>{x?.intervalId&&clearInterval(x.intervalId),p(null),o(null)},L=async C=>{try{const R=await fe.getAll(),M=(Array.isArray(R)?R:[]).filter(B=>B.cashierId===C.id).sort((B,w)=>new Date(w.createdAt)-new Date(B.createdAt)).slice(0,10),H={isActive:Math.random()>.3,currentCart:M.length>0?[{name:"Product A",price:150,quantity:2},{name:"Product B",price:300,quantity:1}]:[],totalSalesToday:M.reduce((B,w)=>B+w.total,0),salesCount:M.length,lastActivity:M.length>0?new Date(M[0].createdAt).toLocaleTimeString():"No recent activity"};o(H)}catch(R){console.error("Error loading live view data:",R)}},U=(t||[]).filter(C=>C.role==="cashier");return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"User Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage cashiers and their permissions"})]}),e.jsxs("button",{onClick:()=>u(!0),className:"btn-primary flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Add Cashier"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-700 mb-1",children:"Total Users"}),e.jsx("p",{className:"text-3xl font-bold text-blue-900",children:t.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:[e.jsx("p",{className:"text-sm text-green-700 mb-1",children:"Cashiers"}),e.jsx("p",{className:"text-3xl font-bold text-green-900",children:U.length})]}),e.jsxs("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:[e.jsx("p",{className:"text-sm text-purple-700 mb-1",children:"Admins"}),e.jsx("p",{className:"text-3xl font-bold text-purple-900",children:(t||[]).filter(C=>C.role==="admin").length})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Users"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Plan"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Permissions"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:(t||[]).map(C=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:C.name}),e.jsx("td",{className:"px-4 py-3 text-sm",children:C.email}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:`badge ${C.role==="admin"?"bg-purple-100 text-purple-800":"badge-success"}`,children:C.role})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-warning",children:C.plan||"N/A"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:C.role==="cashier"?e.jsx("button",{onClick:()=>h(C),className:"text-blue-600 hover:text-blue-700 text-xs font-medium",children:"Edit Permissions"}):e.jsx("span",{className:"text-gray-400 text-xs",children:"Full Access"})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:C.role==="cashier"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{localStorage.setItem("adminViewingCashier",C.id),window.location.href="/cashier/pos"},className:"p-2 hover:bg-blue-50 rounded-lg text-blue-600",title:"Access Cashier POS",children:e.jsx(Bt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>N(C),className:"p-2 hover:bg-green-50 rounded-lg text-green-600",title:"Live View",children:e.jsx(tt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>y(C.id),className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx(V,{className:"w-4 h-4"})})]})})]},C.id))})]})})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Add New Cashier"}),e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Full Name",className:"input",value:d.name,onChange:C=>S({...d,name:C.target.value}),required:!0}),e.jsx("input",{type:"email",placeholder:"Email",className:"input",value:d.email,onChange:C=>S({...d,email:C.target.value}),required:!0}),e.jsx("input",{type:"password",placeholder:"Password (min 6 characters)",className:"input",value:d.password,onChange:C=>S({...d,password:C.target.value}),required:!0,minLength:6}),e.jsx("p",{className:"text-xs text-gray-500",children:"ðŸ’¡ The cashier will use this email and password to log in to the system"}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-3 text-sm",children:"Permissions"}),e.jsx("div",{className:"space-y-2",children:Object.entries(d.permissions).map(([C,R])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:R,onChange:$=>S({...d,permissions:{...d.permissions,[C]:$.target.checked}})}),e.jsx("span",{className:"text-sm capitalize",children:C.replace(/([A-Z])/g," $1").trim()})]},C))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Add Cashier"}),e.jsx("button",{type:"button",onClick:()=>u(!1),className:"btn-secondary",children:"Cancel"})]})]})]})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:["Edit Permissions: ",n.name]}),e.jsx("div",{className:"space-y-3",children:Object.entries(n.permissions||{}).map(([C,R])=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:R,onChange:$=>h({...n,permissions:{...n.permissions,[C]:$.target.checked}})}),e.jsx("span",{className:"text-sm capitalize",children:C.replace(/([A-Z])/g," $1").trim()})]},C))}),e.jsxs("div",{className:"flex gap-2 mt-6",children:[e.jsx("button",{onClick:()=>b(n.id,n.permissions),className:"btn-primary flex-1",children:"Save Changes"}),e.jsx("button",{onClick:()=>h(null),className:"btn-secondary",children:"Cancel"})]})]})}),a&&x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center",children:e.jsx(tt,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Live View: ",a.name]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Real-time cashier activity monitoring"})]})]}),e.jsx("button",{onClick:P,className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx(Te,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-6 p-4 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${x.isActive?"bg-green-500 animate-pulse":"bg-gray-400"}`}),e.jsx("span",{className:"font-semibold",children:x.isActive?"Currently Active":"Currently Inactive"}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(Le,{className:"w-4 h-4"}),"Last Activity: ",x.lastActivity]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ue,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold",children:"Current Cart"})]}),(x.currentCart?.length||0)>0?e.jsxs("div",{className:"space-y-2",children:[(x.currentCart||[]).map((C,R)=>e.jsxs("div",{className:"flex justify-between items-center p-2 bg-gray-50 rounded",children:[e.jsxs("span",{className:"text-sm",children:[C.name," x",C.quantity]}),e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["KSH ",C.price.toLocaleString()]})]},R)),e.jsx("div",{className:"border-t pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between font-bold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",(x.currentCart||[]).reduce((C,R)=>C+R.price*R.quantity,0).toLocaleString()]})]})})]}):e.jsx("p",{className:"text-gray-500 text-sm italic",children:"No items in cart"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Today's Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Sales Count:"}),e.jsx("span",{className:"font-semibold",children:x.salesCount})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Sales:"}),e.jsxs("span",{className:"font-semibold text-green-600",children:["KSH ",x.totalSalesToday.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Average Sale:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",x.salesCount>0?Math.round(x.totalSalesToday/x.salesCount).toLocaleString():"0"]})]})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",children:["ðŸ”„ Auto-refreshing every 3 seconds â€¢ Last updated: ",new Date().toLocaleTimeString()]})})]})})]})}function ys(){const[t,i]=m.useState([]),[l,u]=m.useState("all");m.useEffect(()=>{n()},[]);const n=()=>{const x=JSON.parse(localStorage.getItem("clockRecords")||"[]");i(x.reverse())},h=l==="all"?t:t.filter(x=>x.date===new Date().toDateString()),a=h.filter(x=>x.date===new Date().toDateString()).reduce((x,o)=>x+o.duration,0)/60,p=x=>{const o=Math.floor(x/60),c=x%60;return`${o}h ${c}m`};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Time Tracking"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Monitor cashier clock in/out records"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[e.jsx("div",{className:"card bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center",children:e.jsx(Le,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700",children:"Total Hours Today"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:[a.toFixed(1),"h"]})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-green-50 to-green-100 border-green-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-green-600 rounded-xl flex items-center justify-center",children:e.jsx(Ie,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700",children:"Active Cashiers"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:new Set(h.filter(x=>x.date===new Date().toDateString()).map(x=>x.userId)).size})]})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(De,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-700",children:"Total Records"}),e.jsx("p",{className:"text-2xl font-bold text-purple-900",children:t.length})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Clock Records"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>u("all"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${l==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"All Time"}),e.jsx("button",{onClick:()=>u("today"),className:`px-4 py-2 rounded-lg text-sm font-medium transition-all ${l==="today"?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Today"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cashier"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock In"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Clock Out"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Duration"})]})}),e.jsx("tbody",{children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"px-4 py-8 text-center text-gray-500",children:"No records found"})}):h.map((x,o)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:x.userName}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(x.clockIn).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(x.clockIn).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(x.clockOut).toLocaleTimeString()}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:p(x.duration)})})]},o))})]})})]})]})}function Ns(){const{user:t,updateUser:i}=Q();ie();const[l,u]=m.useState(!1),[n,h]=m.useState(t?.plan||"ultra"),[a,p]=m.useState({}),[x,o]=m.useState(null),[c,f]=m.useState(t?.profilePicture||null);m.useEffect(()=>{d()},[]);const d=async()=>{try{const y=await Ge.get();p(y),y.logo&&o(y.logo)}catch(y){console.error("Failed to load settings:",y)}},S=async y=>{const N=y.target.files[0];if(N){const P=new FileReader;P.onloadend=async()=>{const L=P.result;o(L);try{await Ge.update({...a,logo:L}),p({...a,logo:L})}catch(U){console.error("Failed to save logo:",U)}},P.readAsDataURL(N)}},s=async y=>{const N=y.target.files[0];if(N){const P=new FileReader;P.onloadend=async()=>{const L=P.result;f(L);try{await i({...t,profilePicture:L})}catch(U){console.error("Failed to save profile picture:",U)}},P.readAsDataURL(N)}},g=[{id:"basic",name:"Basic Package",price:900,features:["Cashier Dashboard","Sales Tracking","Product Management","Basic Reports"]},{id:"ultra",name:"Ultra Package",price:1600,features:["Admin Dashboard","Recipe Builder","User Management","Advanced Analytics","Expense Tracking"]}],b=async()=>{const y=g.find(P=>P.id===n),N=n==="ultra"?"admin":"cashier";await i({...t,role:N,plan:n,price:y.price}),u(!1),setTimeout(()=>window.location.href=N==="admin"?"/admin":"/cashier",500)};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Settings"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage your account and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Account Information"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative",children:[c?e.jsx("img",{src:c,alt:"Profile",className:"w-20 h-20 rounded-full object-cover"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white text-2xl font-bold",children:t?.name?.charAt(0).toUpperCase()}),e.jsxs("label",{className:"absolute bottom-0 right-0 bg-blue-600 text-white p-1.5 rounded-full cursor-pointer hover:bg-blue-700 transition",children:[e.jsx(st,{className:"w-3 h-3"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:s})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("p",{className:"font-medium",children:t?.name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:t?.role})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(pe,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Subscription"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Current Plan"}),e.jsxs("p",{className:"font-medium capitalize",children:[t?.plan||"Ultra"," Package"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Price"}),e.jsxs("p",{className:"font-medium",children:["KSH ",t?.price||1600,"/month"]})]}),e.jsx("button",{onClick:()=>u(!0),className:"btn-secondary text-sm",children:"Change Plan"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(We,{className:"w-5 h-5 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Notifications"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Email Notifications"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Low Stock Alerts"}),e.jsx("input",{type:"checkbox",defaultChecked:!0,className:"toggle"})]}),e.jsxs("label",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Daily Sales Summary"}),e.jsx("input",{type:"checkbox",className:"toggle"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-red-100 flex items-center justify-center",children:e.jsx(xt,{className:"w-5 h-5 text-red-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Security"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Change Password"}),e.jsx("button",{className:"btn-secondary text-sm w-full",children:"Enable 2FA"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(Ht,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Screen Lock Logo"})]}),e.jsxs("div",{className:"space-y-3",children:[x&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:x,alt:"Logo Preview",className:"w-32 h-32 object-contain rounded-lg border-2 border-gray-200"})}),e.jsxs("label",{className:"btn-secondary text-sm w-full cursor-pointer flex items-center justify-center gap-2",children:[e.jsx(st,{className:"w-4 h-4"}),"Upload Logo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:S})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"This logo will appear on the screen lock"})]})]})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Change Your Plan"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:g.map(y=>e.jsxs("div",{onClick:()=>h(y.id),className:`card cursor-pointer transition-all ${n===y.id?"ring-4 ring-blue-600 bg-blue-50":"hover:shadow-lg"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-xl font-bold",children:y.name}),n===y.id&&e.jsx(le,{className:"w-6 h-6 text-blue-600"})]}),e.jsxs("p",{className:"text-3xl font-bold mb-4",children:["KSH ",y.price,e.jsx("span",{className:"text-sm text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:y.features.map((N,P)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(le,{className:"w-4 h-4 text-green-600"}),N]},P))})]},y.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:b,className:"btn-primary flex-1",children:"Confirm Change"}),e.jsx("button",{onClick:()=>u(!1),className:"btn-secondary",children:"Cancel"})]})]})})]})}function vs(){const[t,i]=m.useState([]),[l,u]=m.useState(!1),[n,h]=m.useState(null),[a,p]=m.useState({name:"",amount:"",description:"",active:!0});m.useEffect(()=>{x()},[]);const x=()=>{const d=JSON.parse(localStorage.getItem("serviceFees")||"[]");i(d)},o=d=>{localStorage.setItem("serviceFees",JSON.stringify(d)),i(d)},c=d=>{if(d.preventDefault(),n){const S=t.map(s=>s.id===n.id?{...a,id:s.id}:s);o(S)}else{const S={...a,id:Date.now(),createdAt:new Date().toISOString()};o([...t,S])}u(!1),h(null),p({name:"",amount:"",description:"",active:!0})},f=d=>{confirm("Delete this service fee?")&&o(t.filter(S=>S.id!==d))};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Service Fees"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage delivery, packaging, and other fees"})]}),e.jsxs("button",{onClick:()=>{u(!0),h(null)},className:"btn-primary flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Add Fee"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:t.map(d=>e.jsxs("div",{className:`card ${d.active?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(ne,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:d.name}),e.jsx("p",{className:"text-xs text-gray-500",children:d.description})]})]}),e.jsx("span",{className:`badge ${d.active?"badge-success":"bg-gray-200 text-gray-600"}`,children:d.active?"Active":"Inactive"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["KSH ",d.amount]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{h(d),p(d),u(!0)},className:"p-2 hover:bg-blue-50 rounded-lg",children:e.jsx(Ee,{className:"w-4 h-4 text-blue-600"})}),e.jsx("button",{onClick:()=>f(d.id),className:"p-2 hover:bg-red-50 rounded-lg",children:e.jsx(V,{className:"w-4 h-4 text-red-600"})})]})]})]},d.id))}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[n?"Edit":"Add"," Service Fee"]}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Fee Name (e.g., Delivery)",className:"input",value:a.name,onChange:d=>p({...a,name:d.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Amount",className:"input",value:a.amount,onChange:d=>p({...a,amount:d.target.value}),required:!0}),e.jsx("textarea",{placeholder:"Description",className:"input",rows:"2",value:a.description,onChange:d=>p({...a,description:d.target.value})}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.active,onChange:d=>p({...a,active:d.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>u(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function ws(){const[t,i]=m.useState([]),[l,u]=m.useState([]),[n,h]=m.useState(!1),[a,p]=m.useState({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""});m.useEffect(()=>{x(),o()},[]);const x=async()=>{try{const s=localStorage.getItem("token"),b=await fetch("/api/reminders",{headers:{Authorization:`Bearer ${s}`}});if(!b.ok){console.error("API Error:",b.status,b.statusText),i([]);return}const y=await b.json();Array.isArray(y)?i(y):(console.error("Expected array but got:",typeof y,y),i([]))}catch(s){console.error("Failed to fetch reminders:",s),i([])}},o=async()=>{try{const s=localStorage.getItem("token"),b=await fetch("/api/products",{headers:{Authorization:`Bearer ${s}`}});if(!b.ok){console.error("API Error:",b.status,b.statusText),u([]);return}const y=await b.json();Array.isArray(y)?u(y):(console.error("Expected array but got:",typeof y,y),u([]))}catch(s){console.error("Failed to fetch products:",s),u([])}},c=async s=>{s.preventDefault();try{const g=localStorage.getItem("token"),y=await fetch("/api/reminders",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify(a)});if(!y.ok){const P=await y.json();console.error("Failed to create reminder:",P),alert(`Failed to create reminder: ${P.error||"Unknown error"}`);return}const N=await y.json();p({customerName:"",productId:"",frequency:"weekly",days:[],nextDate:""}),h(!1),x(),alert("Reminder created successfully!")}catch(g){console.error("Failed to create reminder:",g),alert("Failed to create reminder. Please try again.")}},f=async s=>{try{if(JSON.parse(localStorage.getItem("user")||"{}").role!=="admin"){alert("Only administrators can delete reminders.");return}if(!confirm("Are you sure you want to delete this reminder? This action cannot be undone."))return;const b=localStorage.getItem("token"),N=await fetch(`/api/reminders/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${b}`}});if(!N.ok){const P=await N.json();console.error("Failed to delete reminder:",P),alert(`Failed to delete reminder: ${P.error||"Unknown error"}`);return}x(),alert("Reminder deleted successfully!")}catch(g){console.error("Failed to delete reminder:",g),alert("Failed to delete reminder. Please try again.")}},d=s=>{a.days.includes(s)?p({...a,days:a.days.filter(g=>g!==s)}):p({...a,days:[...a.days,s]})},S=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-3",children:[e.jsx(We,{className:"text-blue-600"}),"Reminder System"]}),e.jsxs("button",{onClick:()=>h(!0),className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition flex items-center gap-2",children:[e.jsx(G,{size:20}),"New Reminder"]})]}),e.jsx("div",{className:"grid gap-4",children:t.map(s=>{const g=l.find(b=>b.id===s.productId);return e.jsx("div",{className:`p-6 rounded-xl shadow-lg ${s.status==="pending"?"bg-red-50 border-l-4 border-red-500":"bg-green-50 border-l-4 border-green-500"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:s.customerName}),e.jsxs("p",{className:"text-gray-700 mb-1",children:["Product: ",g?.name||"Unknown"]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Frequency: ",s.frequency]}),s.days?.length>0&&e.jsxs("p",{className:"text-gray-600 text-sm mb-1",children:["Days: ",s.days.join(", ")]}),e.jsxs("p",{className:"text-gray-600 text-sm flex items-center gap-2",children:[e.jsx(De,{size:16}),"Next: ",new Date(s.nextDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:`px-4 py-2 rounded-lg font-bold ${s.status==="pending"?"bg-red-500 text-white":"bg-green-500 text-white"}`,children:s.status}),e.jsx("button",{onClick:()=>f(s.id),className:"bg-red-500 text-white p-2 rounded-lg hover:bg-red-600 transition",children:e.jsx(V,{size:20})})]})]})},s.id)})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Create Reminder"})}),e.jsxs("form",{onSubmit:c,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Customer Name"}),e.jsx("input",{type:"text",value:a.customerName,onChange:s=>p({...a,customerName:s.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Product"}),e.jsxs("select",{value:a.productId,onChange:s=>p({...a,productId:parseInt(s.target.value)}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Select Product"}),l.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Frequency"}),e.jsxs("select",{value:a.frequency,onChange:s=>p({...a,frequency:s.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"specific",children:"Specific Days"})]})]}),a.frequency==="specific"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Days"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:S.map(s=>e.jsx("button",{type:"button",onClick:()=>d(s),className:`px-4 py-2 rounded-lg font-medium transition ${a.days.includes(s)?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Next Reminder Date"}),e.jsx("input",{type:"date",value:a.nextDate,onChange:s=>p({...a,nextDate:s.target.value}),className:"w-full px-4 py-3 rounded-lg border focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition",children:"Create Reminder"}),e.jsx("button",{type:"button",onClick:()=>h(!1),className:"px-6 bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300 transition",children:"Cancel"})]})]})]})})]})}function Ss(){const[t,i]=m.useState([]),[l,u]=m.useState(!1),[n,h]=m.useState(null),[a,p]=m.useState({name:"",percentage:"",validFrom:"",validTo:"",active:!0});m.useEffect(()=>{x()},[]);const x=async()=>{try{const d=await me.getAll();i(d)}catch(d){console.error("Failed to load discounts:",d)}},o=async d=>{d.preventDefault();try{n?await me.update(n.id,a):await me.create(a),u(!1),h(null),p({name:"",percentage:"",validFrom:"",validTo:"",active:!0}),x()}catch(S){console.error("Failed to save discount:",S)}},c=async d=>{if(confirm("Delete this discount?"))try{await me.delete(d),x()}catch(S){console.error("Failed to delete discount:",S)}},f=d=>{const S=new Date,s=new Date(d.validFrom),g=new Date(d.validTo);return d.active&&s<=S&&g>=S};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Discount Manager"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Create and manage discount rules"})]}),e.jsxs("button",{onClick:()=>{u(!0),h(null),p({name:"",percentage:"",validFrom:"",validTo:"",active:!0})},className:"btn-primary flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Add Discount"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[t.map(d=>e.jsxs("div",{className:`card ${f(d)?"border-green-200 bg-green-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${f(d)?"bg-green-600":"bg-gray-400"}`,children:e.jsx(se,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:d.name}),e.jsxs("p",{className:"text-2xl font-bold text-red-600",children:[d.percentage,"% OFF"]})]})]}),e.jsx("span",{className:`badge ${f(d)?"badge-success":"bg-gray-200 text-gray-600"}`,children:f(d)?"Active":"Inactive"})]}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4"}),e.jsxs("span",{children:["From: ",new Date(d.validFrom).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"w-4 h-4"}),e.jsxs("span",{children:["To: ",new Date(d.validTo).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{h(d),p(d),u(!0)},className:"p-2 hover:bg-blue-50 rounded-lg flex-1",children:e.jsx(Ee,{className:"w-4 h-4 text-blue-600 mx-auto"})}),e.jsx("button",{onClick:()=>c(d.id),className:"p-2 hover:bg-red-50 rounded-lg flex-1",children:e.jsx(V,{className:"w-4 h-4 text-red-600 mx-auto"})})]})]},d.id)),t.length===0&&e.jsxs("div",{className:"card text-center py-12 col-span-full",children:[e.jsx(se,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No discounts yet. Create your first discount!"})]})]}),l&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold mb-4",children:[n?"Edit":"Add"," Discount"]}),e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Discount Name"}),e.jsx("input",{type:"text",className:"input",value:a.name,onChange:d=>p({...a,name:d.target.value}),placeholder:"e.g., Holiday Sale",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Percentage (%)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:"100",className:"input",value:a.percentage,onChange:d=>p({...a,percentage:parseFloat(d.target.value)}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid From"}),e.jsx("input",{type:"date",className:"input",value:a.validFrom,onChange:d=>p({...a,validFrom:d.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Valid To"}),e.jsx("input",{type:"date",className:"input",value:a.validTo,onChange:d=>p({...a,validTo:d.target.value}),required:!0})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.active,onChange:d=>p({...a,active:d.target.checked})}),e.jsx("span",{className:"text-sm",children:"Active"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:"Save"}),e.jsx("button",{type:"button",onClick:()=>u(!1),className:"btn-secondary",children:"Cancel"})]})]})]})})]})}function ks(){const[t,i]=m.useState([]),[l,u]=m.useState([]),[n,h]=m.useState("all");m.useEffect(()=>{a(),p()},[]);const a=async()=>{try{const s=await he.getAll();i(s)}catch(s){console.error("Failed to load credit requests:",s)}},p=async()=>{try{const s=await z.getAll();u(s)}catch(s){console.error("Failed to load products:",s)}},x=async s=>{try{await he.approve(s),a()}catch(g){console.error("Failed to approve request:",g)}},o=async s=>{try{await he.reject(s),a()}catch(g){console.error("Failed to reject request:",g)}},c=s=>{const g=l.find(b=>b.id===s);return g?g.name:"Unknown Product"},f=t.filter(s=>n==="all"?!0:s.status===n),d=s=>{switch(s){case"pending":return"bg-orange-50 border-orange-200";case"approved":return"bg-green-50 border-green-200";case"rejected":return"bg-red-50 border-red-200";default:return"bg-gray-50 border-gray-200"}},S=s=>{switch(s){case"pending":return e.jsx(Le,{className:"w-6 h-6 text-orange-600"});case"approved":return e.jsx(ge,{className:"w-6 h-6 text-green-600"});case"rejected":return e.jsx(_e,{className:"w-6 h-6 text-red-600"});default:return e.jsx(pe,{className:"w-6 h-6 text-gray-600"})}};return e.jsxs("div",{className:"p-4 md:p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Credit Requests"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Review and manage credit requests from cashiers"})]}),e.jsx("div",{className:"flex gap-2",children:["all","pending","approved","rejected"].map(s=>e.jsx("button",{onClick:()=>h(s),className:`px-4 py-2 rounded-lg font-medium transition ${n===s?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[f.map(s=>e.jsx("div",{className:`card border-l-4 ${d(s.status)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[e.jsx("div",{className:`w-12 h-12 rounded-lg flex items-center justify-center ${s.status==="pending"?"bg-orange-600":s.status==="approved"?"bg-green-600":"bg-red-600"}`,children:S(s.status)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.customerName}),e.jsx("p",{className:"text-sm text-gray-600",children:c(s.productId)}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm",children:[e.jsxs("span",{children:["Quantity: ",e.jsx("strong",{children:s.quantity})]}),e.jsxs("span",{children:["Amount: ",e.jsxs("strong",{className:"text-green-600",children:["KSH ",s.amount?.toLocaleString()]})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Requested: ",new Date(s.createdAt).toLocaleString()]}),s.approvedAt&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Approved: ",new Date(s.approvedAt).toLocaleString()]})]})]}),s.status==="pending"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>x(s.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(ge,{size:16}),"Approve"]}),e.jsxs("button",{onClick:()=>o(s.id),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(_e,{size:16}),"Reject"]})]}),s.status!=="pending"&&e.jsx("span",{className:`badge ${s.status==="approved"?"badge-success":"bg-red-100 text-red-800"}`,children:s.status.toUpperCase()})]})},s.id)),f.length===0&&e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(pe,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-gray-500",children:["No ",n!=="all"?n:""," credit requests found."]})]})]})]})}function Cs({onClose:t}){const[i,l]=m.useState([]),[u,n]=m.useState(!0);m.useEffect(()=>{h()},[]);const h=async()=>{try{const p=localStorage.getItem("token"),o=await fetch("/api/reminders/today",{headers:{Authorization:`Bearer ${p}`}});if(!o.ok){console.error("API Error:",o.status,o.statusText),l([]);return}const c=await o.json();Array.isArray(c)?l(c):(console.error("Expected array but got:",typeof c,c),l([]))}catch(p){console.error("Failed to fetch reminders:",p),l([])}finally{n(!1)}},a=async p=>{try{const x=localStorage.getItem("token");await fetch(`/api/reminders/${p}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${x}`},body:JSON.stringify({status:"fulfilled"})}),h()}catch(x){console.error("Failed to update reminder:",x)}};return u?null:e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Today's Reminders"}),e.jsx("button",{onClick:t,className:"hover:bg-white/20 p-2 rounded-lg transition",children:e.jsx(Te,{size:24})})]}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-[60vh]",children:i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ae,{className:"mx-auto h-12 w-12 text-green-500 mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"No reminders for today"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"You're all caught up!"})]}):i.map(p=>e.jsxs("div",{className:"mb-4 p-4 border-l-4 border-red-500 bg-red-50 rounded-lg flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-800",children:p.customerName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Product ID: ",p.productId]}),e.jsx("p",{className:"text-xs text-gray-500",children:p.frequency})]}),e.jsxs("button",{onClick:()=>a(p.id),className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition",children:[e.jsx(ge,{size:18}),"Mark Done"]})]},p.id))})]})})}function Ps({onUnlock:t,logo:i}){const[l,u]=m.useState(""),[n,h]=m.useState(""),a=p=>{p.preventDefault();const x=JSON.parse(localStorage.getItem("user"));l===x.password||l==="1234"?(t(),u(""),h("")):(h("Invalid PIN"),u(""))};return e.jsx("div",{className:"fixed inset-0 bg-gradient-to-br from-blue-900 via-purple-900 to-pink-900 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-3xl p-12 shadow-2xl max-w-md w-full mx-4",children:[i?e.jsx("img",{src:i,alt:"Logo",className:"w-32 h-32 mx-auto mb-8 rounded-2xl shadow-lg"}):e.jsx("div",{className:"w-32 h-32 mx-auto mb-8 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(ee,{size:64,className:"text-white"})}),e.jsx("h2",{className:"text-3xl font-bold text-white text-center mb-2",children:"Screen Locked"}),e.jsx("p",{className:"text-white/70 text-center mb-8",children:"Enter your PIN to unlock"}),e.jsxs("form",{onSubmit:a,children:[e.jsx("input",{type:"password",value:l,onChange:p=>u(p.target.value),className:"w-full px-6 py-4 rounded-xl bg-white/20 text-white placeholder-white/50 text-center text-2xl tracking-widest focus:outline-none focus:ring-4 focus:ring-white/30",placeholder:"â€¢â€¢â€¢â€¢",autoFocus:!0}),n&&e.jsx("p",{className:"text-red-300 text-center mt-4",children:n}),e.jsx("button",{type:"submit",className:"w-full mt-6 bg-white text-purple-900 py-4 rounded-xl font-bold text-lg hover:bg-white/90 transition shadow-lg",children:"Unlock"})]})]})})}function As(t=45e3){const[i,l]=m.useState(!1),u=m.useRef(null),n=m.useCallback(()=>{u.current&&clearTimeout(u.current),u.current=setTimeout(()=>l(!0),t)},[t]);m.useEffect(()=>{const a=["mousedown","mousemove","keypress","scroll","touchstart","click"];return a.forEach(p=>{document.addEventListener(p,n,!0)}),n(),()=>{u.current&&clearTimeout(u.current),a.forEach(p=>{document.removeEventListener(p,n,!0)})}},[n]);const h=m.useCallback(()=>{l(!1),n()},[n]);return[i,h]}function Ds(){const{user:t,logout:i}=Q(),l=ie(),u=Et(),[n,h]=m.useState(!0),[a,p]=m.useState(!1),[x,o]=m.useState({}),[c,f]=As(45e3);m.useEffect(()=>{const g=()=>{const y=localStorage.getItem("user");if(y){const N=JSON.parse(y);let P=!1;(N.plan==="ultra"||N.role==="admin")&&(N.active||(N.active=!0,P=!0),N.plan==="ultra"&&N.role!=="admin"&&(N.role="admin",P=!0),N.plan==="ultra"&&(!N.price||N.price!==1600)&&(N.price=1600,P=!0),P&&(localStorage.setItem("user",JSON.stringify(N)),window.dispatchEvent(new Event("storage")),window.dispatchEvent(new Event("localStorageUpdated"))))}};g(),setTimeout(g,100);const b=setTimeout(()=>{p(!0)},1e3);return d(),()=>clearTimeout(b)},[]);const d=async()=>{try{const g=await Ge.get();o(g)}catch(g){console.error("Failed to load settings:",g)}},S=[{id:"overview",label:"Dashboard",icon:zt,path:"/admin"},{id:"sales",label:"Sales",icon:pt,path:"/admin/sales"},{id:"inventory",label:"Inventory",icon:te,path:"/admin/inventory"},{id:"recipes",label:"Recipes/BOM",icon:mt,path:"/admin/recipes"},{id:"expenses",label:"Expenses",icon:gt,path:"/admin/expenses"},{id:"users",label:"Users",icon:Pe,path:"/admin/users"},{id:"time",label:"Time Tracking",icon:Le,path:"/admin/time"},{id:"reminders",label:"Reminders",icon:We,path:"/admin/reminders"},{id:"service-fees",label:"Service Fees",icon:ne,path:"/admin/service-fees"},{id:"discounts",label:"Discounts",icon:se,path:"/admin/discounts"},{id:"credit-requests",label:"Credit Requests",icon:pe,path:"/admin/credit-requests"},{id:"settings",label:"Settings",icon:bt,path:"/admin/settings"}],s=g=>g==="/admin"?u.pathname==="/admin":u.pathname.startsWith(g);return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("aside",{className:`bg-white border-r border-gray-200 transition-all duration-300 ${n?"w-64":"w-20"} flex flex-col`,children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[n&&e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Admin Panel"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Ultra Package"})]}),e.jsx("button",{onClick:()=>h(!n),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:n?e.jsx(Te,{className:"w-5 h-5"}):e.jsx(Kt,{className:"w-5 h-5"})})]})}),e.jsx("nav",{className:"flex-1 p-4 space-y-2",children:S.map(g=>{const b=g.icon;return e.jsxs("button",{onClick:()=>l(g.path),className:`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-all ${s(g.path)?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-md":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx(b,{className:"w-5 h-5 flex-shrink-0"}),n&&e.jsx("span",{className:"font-medium",children:g.label})]},g.id)})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2",children:[e.jsxs("button",{onClick:()=>window.open("/cashier","_blank"),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors",children:[e.jsx(Jt,{className:"w-5 h-5 flex-shrink-0"}),n&&e.jsx("span",{className:"font-medium",children:"Open POS"})]}),e.jsxs("button",{onClick:i,className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:[e.jsx(ke,{className:"w-5 h-5 flex-shrink-0"}),n&&e.jsx("span",{className:"font-medium",children:"Logout"})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:S.find(g=>s(g.path))?.label||"Dashboard"})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email})]}),e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:t?.name?.charAt(0).toUpperCase()})]})]})}),e.jsx("main",{className:"flex-1 overflow-auto",children:e.jsxs(dt,{children:[e.jsx(q,{path:"/",element:e.jsx(hs,{})}),e.jsx(q,{path:"/sales",element:e.jsx(fs,{})}),e.jsx(q,{path:"/inventory",element:e.jsx(ps,{})}),e.jsx(q,{path:"/recipes",element:e.jsx(gs,{})}),e.jsx(q,{path:"/expenses",element:e.jsx(bs,{})}),e.jsx(q,{path:"/reminders",element:e.jsx(ws,{})}),e.jsx(q,{path:"/service-fees",element:e.jsx(vs,{})}),e.jsx(q,{path:"/discounts",element:e.jsx(Ss,{})}),e.jsx(q,{path:"/credit-requests",element:e.jsx(ks,{})}),e.jsx(q,{path:"/users",element:e.jsx(js,{})}),e.jsx(q,{path:"/time",element:e.jsx(ys,{})}),e.jsx(q,{path:"/settings",element:e.jsx(Ns,{})})]})})]}),a&&e.jsx(Cs,{onClose:()=>p(!1)}),c&&e.jsx(Ps,{onUnlock:f,logo:x.logo})]})}function Ts({originalPrice:t,onApply:i}){const[l,u]=m.useState([]),[n,h]=m.useState(null),[a,p]=m.useState(!0);m.useEffect(()=>{x()},[]);const x=async()=>{try{p(!0);const c=await me.getAll(),f=new Date,d=c.filter(S=>S.active!==!1&&(!S.validFrom||new Date(S.validFrom)<=f)&&(!S.validTo||new Date(S.validTo)>=f));u(d)}catch(c){console.error("Failed to fetch discounts:",c),u([])}finally{p(!1)}},o=c=>{h(c);const f=t*c.percentage/100,d=t-f;i({discount:c,newPrice:d,discountAmount:f})};return a?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading discounts..."})]}):l.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(se,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No active discounts available"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Check with administrator to set up discounts"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(se,{className:"w-5 h-5 text-blue-600"}),"Available Discounts"]}),l.map(c=>{const f=t*c.percentage/100,d=t-f;return e.jsx("button",{onClick:()=>o(c),className:`w-full p-4 rounded-lg border-2 transition-all hover:shadow-md ${n?.id===c.id?"border-green-500 bg-green-50 shadow-md":"border-gray-200 hover:border-blue-400 hover:bg-blue-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-bold text-gray-900",children:c.name}),e.jsxs("span",{className:"bg-blue-600 text-white px-2 py-1 rounded text-sm font-semibold",children:[c.percentage,"% OFF"]})]}),c.description&&e.jsx("p",{className:"text-sm text-gray-600",children:c.description}),c.validFrom&&c.validTo&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Valid: ",new Date(c.validFrom).toLocaleDateString()," - ",new Date(c.validTo).toLocaleDateString()]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsxs("p",{className:"text-gray-400 line-through text-sm",children:["KSH ",t.toLocaleString()]}),e.jsxs("p",{className:"text-green-600 font-bold text-lg",children:["KSH ",d.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Save KSH ",f.toLocaleString()]})]})]})},c.id)})]})}function Is({product:t,onAddToCart:i,onRequestCredit:l,showDiscounts:u=!1}){return e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition transform hover:-translate-y-1",children:[t.image?e.jsx("img",{src:t.image,alt:t.name,className:"w-full h-64 object-contain bg-gray-50"}):e.jsx("div",{className:"w-full h-64 bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center",children:e.jsx(te,{size:64,className:"text-white"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-bold text-lg",children:t.name}),e.jsx("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs",children:t.code||"N/A"})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-2",children:t.category}),t.notes&&e.jsx("p",{className:"text-gray-500 text-xs mb-3 italic",children:t.notes}),e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("span",{className:"text-2xl font-bold text-green-600",children:["KSH ",t.price?.toLocaleString()]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[t.quantity," ",t.unit]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>i(t),className:"flex-1 bg-blue-600 text-white py-2 rounded-lg font-bold hover:bg-blue-700 transition flex items-center justify-center gap-2",children:[e.jsx(ue,{size:18}),"Add"]}),e.jsx("button",{onClick:()=>l(t),className:"bg-orange-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-orange-600 transition",children:"Credit"})]})]})]})}function Es(){const{user:t,logout:i}=Q(),[l,u]=m.useState([]),[n,h]=m.useState([]),[a,p]=m.useState("cash"),[x,o]=m.useState(!0),[c,f]=m.useState("pos"),[d,S]=m.useState(!1),[s,g]=m.useState(null),[b,y]=m.useState({name:"",price:"",quantity:"",unit:"pcs"}),[N,P]=m.useState(""),[L,U]=m.useState([]),[C,R]=m.useState({}),[$,M]=m.useState(!1),[H,B]=m.useState(null),[w,r]=m.useState(!1),[k,v]=m.useState([]),[T,D]=m.useState([]),[O,W]=m.useState(null),[A,J]=m.useState({type:"percentage",value:"",reason:"",items:[]}),[Oe,ce]=m.useState(Date.now()),[Re,Ye]=m.useState(0),[Ue,be]=m.useState(!1);m.useEffect(()=>{Z();const j=localStorage.getItem(`clockIn_${t?.id}_${new Date().toDateString()}`);j&&(M(!0),B(new Date(j)));const I=setInterval(()=>{console.log("ðŸ”„ Auto-refreshing products..."),be(!0),Z().finally(()=>{be(!1),ce(Date.now()),Ye(E=>E+1)})},3e4);return()=>clearInterval(I)},[]);const vt=()=>{const j=new Date;localStorage.setItem(`clockIn_${t?.id}_${j.toDateString()}`,j.toISOString()),M(!0),B(j)},wt=()=>{const j=new Date,I=localStorage.getItem(`clockIn_${t?.id}_${new Date().toDateString()}`);if(I){const E=new Date(I),qe=Math.floor((j-E)/1e3/60),Ne=JSON.parse(localStorage.getItem("clockRecords")||"[]");Ne.push({userId:t?.id,userName:t?.name,clockIn:E.toISOString(),clockOut:j.toISOString(),duration:qe,date:new Date().toDateString()}),localStorage.setItem("clockRecords",JSON.stringify(Ne)),localStorage.removeItem(`clockIn_${t?.id}_${new Date().toDateString()}`)}M(!1),B(null)},Z=async()=>{try{const[j,I,E,qe,Ne]=await Promise.all([z.getAll(),fe.getAll(),yt.get(),he.getAll().catch(()=>[]),T.getAll().catch(()=>[])]),$e=j.filter(_=>{const Me=!_.expenseOnly&&!_.pendingDelete,Be=_.visibleToCashier!==!1;return _.id<=5&&console.log(`Product ${_.name}:`,{expenseOnly:_.expenseOnly,visibleToCashier:_.visibleToCashier,pendingDelete:_.pendingDelete,isVisible:Me,isNotHidden:Be,finalInclude:Me&&Be}),Me&&Be});console.log("Loaded products for cashier:",{total:j.length,visible:$e.length,visibleProductNames:$e.map(_=>_.name)}),u($e),U(I.reverse()),R(E),v(qe),D(Ne)}catch(j){console.error("Error loading data:",j),u([]),U([]),R({}),v([]),D([])}},St=j=>{const I=n.find(E=>E.id===j.id);h(I?n.map(E=>E.id===j.id?{...E,quantity:E.quantity+1}:E):[...n,{...j,quantity:1}])},Qe=(j,I)=>{h(n.map(E=>E.id===j?{...E,quantity:Math.max(1,E.quantity+I)}:E).filter(E=>E.quantity>0))},kt=j=>{h(n.filter(I=>I.id!==j))},Ct=async j=>{j.preventDefault();try{const I={type:A.type,value:parseFloat(A.value),reason:A.reason,items:n.map(E=>({productId:E.id,quantity:E.quantity,price:E.price})),requestedBy:t?.id,requestedByName:t?.name,subtotal:X,createdAt:new Date().toISOString()};await he.create(I),r(!1),J({type:"percentage",value:"",reason:"",items:[]}),await Z(),alert("Discount request submitted successfully!")}catch(I){console.error("Failed to request discount:",I),alert("Failed to request discount: "+I.message)}},X=n.reduce((j,I)=>j+I.price*I.quantity,0),Fe=O?O.percentage/100:.05,je=X*Fe,ye=X-je,Ze=x?0:ye*.16,Xe=ye+Ze,Pt=({discount:j,newPrice:I,discountAmount:E})=>{W(j)},At=async()=>{if(n.length!==0)try{await fe.create({items:n.map(j=>({productId:j.id,quantity:j.quantity,price:j.price})),total:Xe,paymentMethod:a}),h([]),Z(),alert("Sale completed successfully!")}catch(j){alert("Failed to complete sale: "+j.message)}},et=l.filter(j=>j.name?.toLowerCase().includes(N.toLowerCase()));return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex flex-col",children:[e.jsx("nav",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200 px-4 md:px-6 py-3 md:py-4 sticky top-0 z-50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg md:text-2xl font-bold bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent",children:t?.plan==="basic"?"Cashier Dashboard":"POS System"}),e.jsx("p",{className:"text-xs text-gray-500 mt-0.5 hidden md:block",children:t?.plan==="basic"?"Basic Package - KSH 900/month":"Ultra Package Access"})]}),e.jsxs("div",{className:"flex items-center gap-2 md:gap-4",children:[e.jsxs("div",{className:"text-right hidden md:block",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t?.name}),e.jsx("p",{className:"text-xs text-gray-500",children:t?.email}),$&&H&&e.jsxs("p",{className:"text-xs text-green-600 font-medium",children:["Clocked in: ",H.toLocaleTimeString()]}),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:Ue?e.jsxs("span",{className:"text-blue-600 flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-pulse"}),"Updating..."]}):e.jsxs("span",{children:["Last update: ",new Date(Oe).toLocaleTimeString()]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[$?e.jsxs("button",{onClick:wt,className:"btn-secondary flex items-center gap-1 md:gap-2 text-sm md:text-base px-2 md:px-4 bg-red-50 text-red-600 border-red-200",children:[e.jsx(ke,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:"Clock Out"})]}):e.jsxs("button",{onClick:vt,className:"btn-secondary flex items-center gap-1 md:gap-2 text-sm md:text-base px-2 md:px-4 bg-green-50 text-green-600 border-green-200",children:[e.jsx(ke,{className:"w-4 h-4 rotate-180"}),e.jsx("span",{className:"hidden md:inline",children:"Clock In"})]}),e.jsxs("button",{onClick:()=>window.location.href="/cashier/settings",className:"btn-secondary flex items-center gap-1 md:gap-2 text-sm md:text-base px-2 md:px-4",children:[e.jsx(bt,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:"Settings"})]}),e.jsxs("button",{onClick:i,className:"btn-secondary flex items-center gap-1 md:gap-2 hover:bg-red-50 hover:text-red-600 hover:border-red-200 text-sm md:text-base px-2 md:px-4",children:[e.jsx(ke,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:"Logout"})]})]})]})]})}),e.jsxs("div",{className:"flex gap-1 md:gap-2 px-2 md:px-6 py-2 md:py-4 bg-white border-b border-gray-200 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>f("pos"),className:`px-3 md:px-6 py-2 rounded-lg font-medium transition-all whitespace-nowrap text-sm md:text-base ${c==="pos"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(ue,{className:"w-4 h-4 inline mr-1 md:mr-2"}),"POS"]}),e.jsxs("button",{onClick:()=>f("sales"),className:`px-3 md:px-6 py-2 rounded-lg font-medium transition-all whitespace-nowrap text-sm md:text-base ${c==="sales"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(ze,{className:"w-4 h-4 inline mr-1 md:mr-2"}),"Sales"]}),e.jsxs("button",{onClick:()=>f("stock"),className:`px-3 md:px-6 py-2 rounded-lg font-medium transition-all whitespace-nowrap text-sm md:text-base ${c==="stock"?"bg-gradient-to-r from-green-600 to-teal-600 text-white shadow-md":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[e.jsx(te,{className:"w-4 h-4 inline mr-1 md:mr-2"}),"Stock"]})]}),c==="pos"&&e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row",children:[e.jsxs("div",{className:"flex-1 p-3 md:p-6 overflow-y-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"input pl-10",value:N,onChange:j=>P(j.target.value)})]}),e.jsxs("button",{onClick:()=>{console.log("ðŸ”„ Manual refresh triggered"),be(!0),Z().finally(()=>{be(!1),ce(Date.now()),Ye(j=>j+1)})},disabled:Ue,className:"btn-secondary flex items-center gap-2 px-4 py-2",title:"Refresh products manually",children:[e.jsx("svg",{className:`w-4 h-4 ${Ue?"animate-spin":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Refresh"]})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["ðŸ’¡ Products auto-refresh every 30 seconds. Current products: ",et.length,Re>0&&e.jsxs("span",{className:"ml-2 text-green-600",children:["â€¢ Updated ",Re," time",Re!==1?"s":""," this session"]})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6",children:et.map(j=>e.jsx(Is,{product:j,onAddToCart:St,onRequestCredit:()=>{},showDiscounts:!0},j.id))})]}),e.jsxs("div",{className:"w-full md:w-96 bg-white border-t md:border-l md:border-t-0 border-gray-200 p-4 md:p-6 flex flex-col shadow-xl max-h-[50vh] md:max-h-none",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-600 to-teal-600 rounded-xl flex items-center justify-center",children:e.jsx(ue,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold",children:"Cart"}),e.jsxs("span",{className:"ml-auto bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm font-semibold",children:[n.length," items"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-6",children:n.length===0?e.jsxs("div",{className:"text-center mt-16",children:[e.jsx(ue,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"Cart is empty"})]}):e.jsx("div",{className:"space-y-3",children:n.map(j=>e.jsxs("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:j.name}),e.jsx("button",{onClick:()=>kt(j.id),className:"text-red-600 hover:bg-red-50 p-1 rounded",children:e.jsx(V,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>Qe(j.id,-1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100",children:e.jsx(_t,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-10 text-center font-semibold",children:j.quantity}),e.jsx("button",{onClick:()=>Qe(j.id,1),className:"w-8 h-8 rounded-lg bg-white shadow-sm flex items-center justify-center hover:bg-gray-100",children:e.jsx(G,{className:"w-4 h-4"})})]}),e.jsxs("span",{className:"font-bold text-green-600",children:["KSH ",(j.price*j.quantity).toLocaleString()]})]})]},j.id))})}),n.length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl p-4 mb-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-4 h-4 text-white"})}),e.jsx("h4",{className:"font-semibold text-blue-900",children:"Available Discounts"})]}),T.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"max-h-48 overflow-y-auto",children:e.jsx(Ts,{originalPrice:X,onApply:Pt})}),O&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"text-green-700 font-medium",children:["Applied: ",O.name]})}),e.jsxs("span",{className:"text-green-600 font-bold",children:[O.percentage,"%"]})]})})]}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"No active discounts available"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Check with admin to set up discounts"})]}),e.jsxs("div",{className:"border-t-2 border-blue-300 pt-2 mt-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-blue-900",children:"Total Discount Applied"}),e.jsxs("span",{className:"text-sm font-bold text-blue-600",children:["KSH ",je.toLocaleString()," (",Math.round(Fe*100),"%)"]})]}),O&&e.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["Applied discount: ",O.name," (",O.percentage,"%)"]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-gradient-to-r from-orange-50 to-yellow-50 border border-orange-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ne,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"text-sm font-medium text-orange-900",children:"Need Additional Discount?"})]}),e.jsx("p",{className:"text-xs text-orange-700 mb-3",children:"Request manager approval for special discounts due to customer circumstances, bulk orders, or promotional events."}),e.jsx("button",{onClick:()=>r(!0),className:"w-full px-4 py-3 bg-gradient-to-r from-orange-500 to-yellow-500 text-white rounded-lg hover:from-orange-600 hover:to-yellow-600 transition-all text-sm font-semibold shadow-md hover:shadow-lg transform hover:-translate-y-0.5",children:"ðŸ’° Request Manager Discount Approval"})]})]}),k.length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4 mb-4",children:[e.jsx("h4",{className:"font-semibold text-yellow-900 mb-3",children:"Pending Discount Requests"}),e.jsxs("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:[k.slice(0,3).map(j=>e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-yellow-200",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:j.type==="percentage"?`${j.value}%`:`KSH ${j.value}`}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${j.status==="pending"?"bg-yellow-100 text-yellow-800":j.status==="approved"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:j.status})]}),e.jsx("p",{className:"text-xs text-gray-600 truncate",children:j.reason})]},j.id)),k.length>3&&e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["+",k.length-3," more requests"]})]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2 border-t border-gray-200 pt-4",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",X.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-blue-600",children:[e.jsxs("span",{children:["Discount (",Math.round(Fe*100),"%):"]}),e.jsxs("span",{className:"font-semibold",children:["-KSH ",je.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Discounted Subtotal:"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",ye.toLocaleString()]})]}),!x&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Tax (16%):"}),e.jsxs("span",{className:"font-semibold",children:["KSH ",Ze.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between text-xl font-bold border-t border-gray-200 pt-2",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-green-600",children:["KSH ",Xe.toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Tax"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>o(!0),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${x?"bg-green-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Tax Inclusive"}),e.jsx("button",{onClick:()=>o(!1),className:`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all ${x?"bg-gray-100 text-gray-600 hover:bg-gray-200":"bg-green-600 text-white"}`,children:"Tax Exclusive"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold mb-2",children:"Payment Method"}),e.jsxs("select",{value:a,onChange:j=>p(j.target.value),className:"input",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"mpesa",children:"M-Pesa"}),e.jsx("option",{value:"card",children:"Card"})]})]}),e.jsx("button",{onClick:At,disabled:n.length===0,className:"btn-primary w-full py-4 text-lg bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 shadow-lg",children:"Complete Sale"})]})]})]}),c==="stock"&&e.jsxs("div",{className:"p-6 max-w-7xl mx-auto w-full space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Stock Management"}),e.jsxs("button",{onClick:()=>{S(!0),y({name:"",price:"",quantity:"",unit:"pcs"})},className:"btn-primary flex items-center gap-2 bg-gradient-to-r from-green-600 to-teal-600",children:[e.jsx(G,{className:"w-4 h-4"}),"Add Product"]})]}),e.jsx("div",{className:"card shadow-lg",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Product"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Price"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Stock"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:l.filter(j=>!j.pendingDelete&&j.visibleToCashier!==!1).map(j=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-sm font-medium",children:j.name}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",j.price?.toLocaleString()]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("span",{className:`font-medium ${j.quantity<10?"text-red-600":"text-gray-900"}`,children:[j.quantity," ",j.unit]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{g(j),y({name:j.name,price:j.price,quantity:j.quantity,unit:j.unit||"pcs"})},className:"p-2 hover:bg-green-50 rounded-lg text-green-600",children:e.jsx(Ee,{className:"w-4 h-4"})}),e.jsx("button",{onClick:async()=>{if(confirm("Delete this product? This action cannot be undone."))try{await z.delete(j.id),u(I=>I.filter(E=>E.id!==j.id)),alert("Product deleted successfully!"),Z()}catch(I){console.error("Failed to delete product:",I);let E="Failed to delete product";I.message.includes("Failed to execute")||I.message.includes("JSON")?E="Network error. Please check your connection and try again.":I.message.includes("401")||I.message.includes("unauthorized")?E="You are not authorized to delete this product.":I.message.includes("404")||I.message.includes("not found")?E="Product not found. It may have been deleted already.":I.message&&(E=`Failed to delete product: ${I.message}`),alert(E)}},className:"p-2 hover:bg-red-50 rounded-lg text-red-600",children:e.jsx(V,{className:"w-4 h-4"})})]})})]},j.id))})]})})}),(d||s)&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:s?"Edit Product":"Add Product"}),e.jsxs("form",{onSubmit:async j=>{j.preventDefault();try{s?await z.update(s.id,{...s,...b,price:parseFloat(b.price),quantity:parseFloat(b.quantity)}):await z.create({...b,price:parseFloat(b.price),cost:parseFloat(b.price)*.6,quantity:parseFloat(b.quantity),category:"raw"}),S(!1),g(null),Z()}catch(I){alert("Failed: "+I.message)}},className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Product Name",className:"input",value:b.name,onChange:j=>y({...b,name:j.target.value}),required:!0}),e.jsx("input",{type:"number",step:"0.01",placeholder:"Price",className:"input",value:b.price,onChange:j=>y({...b,price:j.target.value}),required:!0}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("input",{type:"number",step:"0.01",placeholder:"Quantity",className:"input",value:b.quantity,onChange:j=>y({...b,quantity:j.target.value}),required:!0}),e.jsxs("select",{className:"input",value:b.unit,onChange:j=>y({...b,unit:j.target.value}),children:[e.jsx("option",{value:"pcs",children:"Pieces"}),e.jsx("option",{value:"kg",children:"Kilograms"}),e.jsx("option",{value:"L",children:"Liters"}),e.jsx("option",{value:"g",children:"Grams"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"submit",className:"btn-primary flex-1",children:s?"Update":"Add"}),e.jsx("button",{type:"button",onClick:()=>{S(!1),g(null)},className:"btn-secondary",children:"Cancel"})]})]})]})})]}),c==="sales"&&e.jsxs("div",{className:"p-6 max-w-7xl mx-auto w-full space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"card bg-gradient-to-br from-green-500 to-emerald-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-100 mb-1",children:"Daily Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",C.dailySales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(ne,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-blue-500 to-indigo-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-100 mb-1",children:"Weekly Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",C.weeklySales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(xe,{className:"w-8 h-8"})})]})}),e.jsx("div",{className:"card bg-gradient-to-br from-purple-500 to-pink-600 text-white border-0 shadow-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-purple-100 mb-1",children:"Total Sales"}),e.jsxs("p",{className:"text-3xl font-bold",children:["KSH ",C.totalSales?.toLocaleString()||0]})]}),e.jsx("div",{className:"w-14 h-14 bg-white/20 rounded-2xl flex items-center justify-center",children:e.jsx(te,{className:"w-8 h-8"})})]})})]}),e.jsxs("div",{className:"card shadow-lg",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sales History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Date & Time"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Payment"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Total"}),t?.plan==="ultra"&&e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Profit"})]})}),e.jsx("tbody",{children:L.slice(0,20).map(j=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 text-sm",children:new Date(j.createdAt).toLocaleString()}),e.jsxs("td",{className:"px-4 py-3 text-sm",children:[j.items?.length||0," items"]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"badge badge-success",children:j.paymentMethod||"cash"})}),e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-green-600",children:["KSH ",j.total?.toLocaleString()]}),t?.plan==="ultra"&&e.jsxs("td",{className:"px-4 py-3 text-sm font-semibold text-blue-600",children:["KSH ",j.profit?.toLocaleString()||0]})]},j.id))})]})})]})]}),w&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-orange-500 to-yellow-500 rounded-xl flex items-center justify-center",children:e.jsx(se,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Request Manager Discount Approval"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Submit a discount request for manager review"})]})]}),e.jsxs("form",{onSubmit:Ct,className:"space-y-5",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ“‹ Cart Summary"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Items in Cart:"}),e.jsx("span",{className:"font-semibold text-blue-900 ml-2",children:n.length})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Current Subtotal:"}),e.jsxs("span",{className:"font-semibold text-blue-900 ml-2",children:["KSH ",X.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"Applied Discounts:"}),e.jsxs("span",{className:"font-semibold text-green-600 ml-2",children:["KSH ",je.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-700",children:"After Discounts:"}),e.jsxs("span",{className:"font-semibold text-blue-900 ml-2",children:["KSH ",ye.toLocaleString()]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Discount Type"}),e.jsxs("select",{className:"input",value:A.type,onChange:j=>J({...A,type:j.target.value}),children:[e.jsx("option",{value:"percentage",children:"ðŸ“Š Percentage (%)"}),e.jsx("option",{value:"fixed",children:"ðŸ’° Fixed Amount (KSH)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:A.type==="percentage"?"Discount Percentage":"Discount Amount (KSH)"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:A.type==="percentage"?"100":X.toString(),placeholder:A.type==="percentage"?"10":"500",className:"input",value:A.value,onChange:j=>J({...A,value:j.target.value}),required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"ðŸŽ¯ Reason for Discount Request"}),e.jsx("textarea",{className:"input",placeholder:"Please provide detailed reasoning for this discount request. Examples: Customer loyalty, bulk purchase, damaged packaging, special occasion, competitor pricing, etc.",rows:"4",value:A.reason,onChange:j=>J({...A,reason:j.target.value}),required:!0}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," Be specific about customer circumstances or business reasons to help managers approve requests faster."]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-5 h-5 bg-yellow-500 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5",children:e.jsx("span",{className:"text-white text-xs font-bold",children:"!"})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-semibold text-yellow-800 mb-1",children:"Important Notes:"}),e.jsxs("ul",{className:"text-yellow-700 space-y-1 text-xs",children:[e.jsx("li",{children:"â€¢ Manager approval is required for all discount requests"}),e.jsx("li",{children:"â€¢ Large discounts (greater than 20%) may require additional authorization"}),e.jsx("li",{children:"â€¢ All requests are logged and monitored for compliance"})]})]})]})}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"submit",className:"flex-1 btn-primary bg-gradient-to-r from-orange-500 to-yellow-500 hover:from-orange-600 hover:to-yellow-600 text-white font-semibold py-3 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all",children:"ðŸ“¤ Submit Discount Request"}),e.jsx("button",{type:"button",onClick:()=>{r(!1),J({type:"percentage",value:"",reason:"",items:[]})},className:"btn-secondary px-6",children:"Cancel"})]})]})]})})]})}function Ls(){const{user:t,updateUser:i,logout:l}=Q(),u=ie(),[n,h]=m.useState(!1),[a,p]=m.useState(t?.plan||"basic"),x=[{id:"basic",name:"Basic Package",price:900,features:["Cashier Dashboard","Sales Tracking","Product Management","Basic Reports"]},{id:"ultra",name:"Ultra Package",price:1600,features:["Admin Dashboard","Recipe Builder","User Management","Advanced Analytics","Expense Tracking"]}],o=async()=>{const c=x.find(d=>d.id===a),f=a==="ultra"?"admin":"cashier";await i({...t,role:f,plan:a,price:c.price}),h(!1),setTimeout(()=>window.location.href=f==="admin"?"/admin":"/cashier",500)};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100",children:[e.jsx("nav",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200 px-6 py-4 sticky top-0 z-50 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>u("/cashier"),className:"p-2 hover:bg-gray-100 rounded-lg",children:e.jsx(Gt,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Settings"})]}),e.jsx("button",{onClick:l,className:"btn-secondary",children:"Logout"})]})}),e.jsx("div",{className:"p-6 max-w-6xl mx-auto space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Account Information"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("p",{className:"font-medium",children:t?.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:t?.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Role"}),e.jsx("p",{className:"font-medium capitalize",children:t?.role})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(pe,{className:"w-5 h-5 text-purple-600"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"Subscription"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Current Plan"}),e.jsxs("p",{className:"font-medium capitalize",children:[t?.plan," Package"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Price"}),e.jsxs("p",{className:"font-medium",children:["KSH ",t?.price,"/month"]})]}),e.jsx("button",{onClick:()=>h(!0),className:"btn-primary text-sm w-full",children:"Change Plan"})]})]})]})}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx("h3",{className:"text-2xl font-bold mb-6",children:"Change Your Plan"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:x.map(c=>e.jsxs("div",{onClick:()=>p(c.id),className:`card cursor-pointer transition-all ${a===c.id?"ring-4 ring-blue-600 bg-blue-50":"hover:shadow-lg"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-xl font-bold",children:c.name}),a===c.id&&e.jsx(le,{className:"w-6 h-6 text-blue-600"})]}),e.jsxs("p",{className:"text-3xl font-bold mb-4",children:["KSH ",c.price,e.jsx("span",{className:"text-sm text-gray-600",children:"/month"})]}),e.jsx("ul",{className:"space-y-2",children:c.features.map((f,d)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx(le,{className:"w-4 h-4 text-green-600"}),f]},d))})]},c.id))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:o,className:"btn-primary flex-1",children:"Confirm Change"}),e.jsx("button",{onClick:()=>h(!1),className:"btn-secondary",children:"Cancel"})]})]})})]})}function Os(){const[t,i]=m.useState([]),[l,u]=m.useState([]),[n,h]=m.useState("all"),[a,p]=m.useState(""),[x,o]=m.useState(!1),[c,f]=m.useState([]),[d,S]=m.useState({subject:"",message:""}),[s,g]=m.useState(!0),[b,y]=m.useState(null),[N,P]=m.useState({totalUsers:0,activeUsers:0,lockedUsers:0,totalRevenue:0,pendingPayments:0,overduePayments:0});m.useEffect(()=>{L().finally(()=>g(!1))},[]);const L=async()=>{try{const w=localStorage.getItem("token"),r="/api";let k=!1;try{const v=await fetch(`${r}/main-admin/users`,{headers:{Authorization:`Bearer ${w}`}});if(v.ok){const T=await v.json();i(T),k=!0}else{const T=await fetch(`${r}/users`,{headers:{Authorization:`Bearer ${w}`}});if(T.ok){const D=await T.json();i(D),k=!0}}}catch(v){console.warn("Backend not available for users:",v)}if(!k){const v=ms();i(v)}try{const v=await fetch(`${r}/main-admin/payments`,{headers:{Authorization:`Bearer ${w}`}});if(v.ok){const T=await v.json();u(T)}}catch{console.log("Payments endpoint not available, using empty data"),u([])}if(t.length===0){const v=U();i(v),C(v,[])}else C(t,l)}catch(w){console.error("Failed to load data:",w);{const r=U();i(r),C(r,[])}}},U=()=>{const w=localStorage.getItem("user"),r=[];if(w){const v=JSON.parse(w);r.push(v)}return[{name:"John Doe",email:"john@example.com",plan:"ultra",price:1600,active:!0,locked:!1},{name:"Jane Smith",email:"jane@example.com",plan:"basic",price:900,active:!0,locked:!1},{name:"Bob Wilson",email:"bob@example.com",plan:"ultra",price:1600,active:!1,locked:!1},{name:"Alice Brown",email:"alice@example.com",plan:"basic",price:900,active:!0,locked:!0}].forEach((v,T)=>{r.find(D=>D.email===v.email)||r.push({id:Date.now()+T,...v,role:v.plan==="ultra"?"admin":"cashier",createdAt:new Date(Date.now()-T*864e5).toISOString()})}),r},C=(w,r)=>{const k=w.length,v=w.filter(A=>A.active).length,T=w.filter(A=>A.locked).length,D=r.filter(A=>A.status==="paid").reduce((A,J)=>A+J.amount,0),O=r.filter(A=>A.status==="pending").length,W=r.filter(A=>A.status==="overdue").length;P({totalUsers:k,activeUsers:v,lockedUsers:T,totalRevenue:D,pendingPayments:O,overduePayments:W})},R=async(w,r)=>{try{const k=localStorage.getItem("token"),v="/api";try{if((await fetch(`${v}/main-admin/users/${w}/lock`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k}`},body:JSON.stringify({locked:!r})})).ok){L();return}}catch{console.warn("Backend not available, using client-side update")}const T=t.map(O=>O.id===w?{...O,locked:!r,active:r}:O);i(T),C(T,l);const D=localStorage.getItem("user");if(D){const O=JSON.parse(D);O.id===w&&(O.locked=!r,O.active=r,localStorage.setItem("user",JSON.stringify(O)))}}catch(k){console.error("Failed to toggle lock:",k),alert("Failed to update user lock status.")}},$=async(w,r,k)=>{try{const v=localStorage.getItem("token"),T="/api";try{if((await fetch(`${T}/main-admin/send-email`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v}`},body:JSON.stringify({userIds:w,subject:r,message:k})})).ok){alert("Emails sent successfully!"),o(!1),f([]),S({subject:"",message:""});return}}catch{console.warn("Backend not available, simulating email send")}const D=t.filter(A=>w.includes(A.id)),O={timestamp:new Date().toISOString(),recipients:D.map(A=>({id:A.id,name:A.name,email:A.email})),subject:r,message:k,status:"simulated"},W=JSON.parse(localStorage.getItem("emailLogs")||"[]");W.push(O),localStorage.setItem("emailLogs",JSON.stringify(W)),alert(`Email simulated successfully!

Sent to ${D.length} user(s):
${D.map(A=>A.email).join(", ")}

Note: Deploy backend to send real emails.`),o(!1),f([]),S({subject:"",message:""})}catch(v){console.error("Failed to send email:",v),alert("Failed to process email request.")}},M=async w=>{const r=t.find(k=>k.id===w);r&&await $([w],"Payment Reminder - Subscription Upgrade",`Dear ${r.name},

This is a friendly reminder about your pending subscription payment for ${r.plan?.toUpperCase()} plan (KSH ${r.price}).

Please complete your payment to continue enjoying our services.

Thank you!`)},H=t.filter(w=>{const r=w.name?.toLowerCase().includes(a.toLowerCase())||w.email?.toLowerCase().includes(a.toLowerCase());if(n==="all")return r;if(n==="active")return r&&w.active&&!w.locked;if(n==="locked")return r&&w.locked;if(n==="trial")return r&&(!w.active||!w.plan);if(n==="pending-payment"){const k=l.filter(v=>v.userId===w.id&&v.status==="pending");return r&&k.length>0}if(n==="overdue"){const k=l.filter(v=>v.userId===w.id&&v.status==="overdue");return r&&k.length>0}return r}),B=w=>{const r=l.filter(D=>D.userId===w),k=r.filter(D=>D.status==="pending").length,v=r.filter(D=>D.status==="overdue").length,T=r.filter(D=>D.status==="paid").length;return{pending:k,overdue:v,paid:T,total:r.length}};return s?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-white mx-auto mb-4"}),e.jsx("p",{className:"text-white text-xl",children:"Loading Main Admin Dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-3 text-center",children:e.jsxs("p",{className:"text-sm md:text-base font-semibold",children:["âš ï¸ Demo Mode: Backend not deployed. Actions are simulated locally.",e.jsx("a",{href:"/BACKEND_NOT_DEPLOYED.md",className:"underline ml-2",children:"Deploy Backend â†’"})]})}),e.jsx("header",{className:"bg-black/30 backdrop-blur-lg border-b border-white/10 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Main Admin Dashboard"}),e.jsx("p",{className:"text-gray-300",children:"Monitor all users, payments, and system activity"})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Pe,{className:"w-8 h-8 text-blue-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:N.totalUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ge,{className:"w-8 h-8 text-green-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:N.activeUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Active Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ee,{className:"w-8 h-8 text-red-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:N.lockedUsers})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Locked Users"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ne,{className:"w-8 h-8 text-yellow-400"}),e.jsxs("span",{className:"text-2xl font-bold text-white",children:["KSH ",N.totalRevenue.toLocaleString()]})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Total Revenue"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ft,{className:"w-8 h-8 text-orange-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:N.pendingPayments})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Pending Payments"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(_e,{className:"w-8 h-8 text-red-400"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:N.overduePayments})]}),e.jsx("p",{className:"text-gray-300 text-sm",children:"Overdue Payments"})]})]}),e.jsx("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex gap-4 flex-1 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-80",children:[e.jsx(Ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search users...",className:"w-full pl-10 pr-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",value:a,onChange:w=>p(w.target.value)})]}),e.jsxs("select",{value:n,onChange:w=>h(w.target.value),className:"px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Users"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"locked",children:"Locked"}),e.jsx("option",{value:"trial",children:"Free Trial"}),e.jsx("option",{value:"pending-payment",children:"Pending Payment"}),e.jsx("option",{value:"overdue",children:"Overdue"})]})]}),e.jsxs("button",{onClick:()=>o(!0),disabled:c.length===0,className:"bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white px-6 py-3 rounded-lg font-bold flex items-center gap-2 transition disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(Je,{className:"w-5 h-5"}),"Send Email to Selected (",c.length,")"]})]})}),e.jsx("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl border border-white/20 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-black/30",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left",children:e.jsx("input",{type:"checkbox",checked:c.length===H.length&&H.length>0,onChange:w=>{w.target.checked?f(H.map(r=>r.id)):f([])},className:"w-5 h-5 rounded"})}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"User"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Plan"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Status"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Payments"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Joined"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-gray-200",children:"Actions"})]})}),e.jsxs("tbody",{children:[H.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:"7",className:"px-4 py-12 text-center",children:[e.jsx(Pe,{className:"w-16 h-16 text-gray-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"No users found"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:a||n!=="all"?"Try adjusting your filters":"Users will appear here once they sign up"})]})}),H.map(w=>{const r=B(w.id);return e.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsx("input",{type:"checkbox",checked:c.includes(w.id),onChange:k=>{k.target.checked?f([...c,w.id]):f(c.filter(v=>v!==w.id))},className:"w-5 h-5 rounded"})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[w.profilePicture?e.jsx("img",{src:w.profilePicture,alt:w.name,className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center text-white font-bold",children:w.name?.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:w.name}),e.jsx("p",{className:"text-sm text-gray-400",children:w.email})]})]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${w.plan==="ultra"?"bg-purple-500/20 text-purple-300":"bg-blue-500/20 text-blue-300"}`,children:[w.plan?.toUpperCase()," - KSH ",w.price]})}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("div",{className:"flex items-center gap-2",children:w.locked?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-red-500/20 text-red-300 flex items-center gap-1",children:[e.jsx(ee,{className:"w-3 h-3"}),"Locked"]}):w.active?e.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-green-500/20 text-green-300 flex items-center gap-1",children:[e.jsx(ge,{className:"w-3 h-3"}),"Active"]}):e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-bold bg-gray-500/20 text-gray-300",children:"Inactive"})})}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"space-y-1",children:[r.paid>0&&e.jsxs("span",{className:"text-xs text-green-400",children:["âœ“ ",r.paid," Paid"]}),r.pending>0&&e.jsxs("span",{className:"text-xs text-orange-400 block",children:["â³ ",r.pending," Pending"]}),r.overdue>0&&e.jsxs("span",{className:"text-xs text-red-400 block",children:["âš  ",r.overdue," Overdue"]})]})}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-400",children:new Date(w.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>R(w.id,w.locked),className:`p-2 rounded-lg transition ${w.locked?"bg-green-500/20 hover:bg-green-500/30 text-green-300":"bg-red-500/20 hover:bg-red-500/30 text-red-300"}`,title:w.locked?"Unlock User":"Lock User",children:w.locked?e.jsx(Vt,{className:"w-4 h-4"}):e.jsx(ee,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>M(w.id),className:"p-2 rounded-lg bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 transition",title:"Send Payment Reminder",children:e.jsx(Wt,{className:"w-4 h-4"})})]})})]},w.id)})]})]})})})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-gray-900 to-purple-900 rounded-2xl shadow-2xl max-w-2xl w-full border border-white/20",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-white rounded-t-2xl",children:e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Je,{}),"Send Email to ",c.length," User(s)"]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Subject"}),e.jsx("input",{type:"text",value:d.subject,onChange:w=>S({...d,subject:w.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Email subject..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Message"}),e.jsx("textarea",{value:d.message,onChange:w=>S({...d,message:w.target.value}),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 h-40",placeholder:"Email message..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>$(c,d.subject,d.message),className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white py-3 rounded-lg font-bold transition",children:"Send Email"}),e.jsx("button",{onClick:()=>o(!1),className:"px-6 py-3 bg-white/10 hover:bg-white/20 text-white rounded-lg font-bold transition",children:"Cancel"})]})]})]})})]})}class Rs extends m.Component{constructor(i){super(i),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(i){return{hasError:!0}}componentDidCatch(i,l){console.error("ErrorBoundary caught an error:",i,l),this.setState({error:i,errorInfo:l})}handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-6",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-8 max-w-md w-full text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(Ae,{className:"w-8 h-8 text-red-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Something went wrong"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"We encountered an unexpected error. Please try refreshing the page or contact support if the problem persists."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:this.handleRetry,className:"w-full flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium",children:[e.jsx(Yt,{className:"w-4 h-4"}),"Try Again"]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full bg-gray-100 text-gray-700 px-4 py-3 rounded-lg hover:bg-gray-200 transition-colors font-medium",children:"Refresh Page"})]}),!1]})}):this.props.children}}function Nt(){return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-lg animate-pulse",children:e.jsx("span",{className:"text-2xl font-bold text-white",children:"POS"})}),e.jsx("p",{className:"text-gray-600",children:"Loading..."})]})})}function de({children:t,adminOnly:i=!1}){const{user:l,loading:u,isInitialized:n}=Q();if(!n||u)return e.jsx(Nt,{});if(!l)return e.jsx(re,{to:"/login",replace:!0});if(i){const h=localStorage.getItem("user");let a=l;if(h)try{const o=JSON.parse(h);a={...l,...o}}catch(o){console.warn("Error parsing stored user data:",o)}const p=a.plan==="ultra"||a.role==="admin",x=a.active&&a.plan;if(!p||!x)return console.log("Access denied - User does not have admin privileges:",a),a.plan==="ultra"&&a.role!=="admin"?(a.role="admin",a.active=!0,localStorage.setItem("user",JSON.stringify(a)),window.dispatchEvent(new Event("storage")),t):e.jsx(re,{to:"/cashier",replace:!0})}return t}function Us(){const{user:t,loading:i,isInitialized:l}=Q();return!l||i?e.jsx(Nt,{}):t?!t.active||!t.plan?e.jsx(re,{to:"/subscription",replace:!0}):t.plan==="ultra"||t.role==="admin"?e.jsx(re,{to:"/admin",replace:!0}):e.jsx(re,{to:"/cashier",replace:!0}):e.jsx(re,{to:"/login",replace:!0})}function Fs(){return m.useEffect(()=>{ls();const t=as(),i=l=>{l.detail?.key&&(console.log(`Data changed, refreshing: ${l.detail.key}`),rs(l.detail.key))};return window.addEventListener("localStorageDataChanged",i),()=>{t(),window.removeEventListener("localStorageDataChanged",i)}},[]),e.jsx(Rs,{children:e.jsx(ss,{children:e.jsx(Lt,{children:e.jsxs(dt,{children:[e.jsx(q,{path:"/",element:e.jsx(ns,{})}),e.jsx(q,{path:"/login",element:e.jsx(ot,{})}),e.jsx(q,{path:"/signup",element:e.jsx(ot,{})}),e.jsx(q,{path:"/subscription",element:e.jsx(de,{children:e.jsx(us,{})})}),e.jsx(q,{path:"/dashboard",element:e.jsx(de,{children:e.jsx(Us,{})})}),e.jsx(q,{path:"/admin/*",element:e.jsx(de,{adminOnly:!0,children:e.jsx(Ds,{})})}),e.jsx(q,{path:"/cashier",element:e.jsx(de,{children:e.jsx(Es,{})})}),e.jsx(q,{path:"/cashier/settings",element:e.jsx(de,{children:e.jsx(Ls,{})})}),e.jsx(q,{path:"/main.admin",element:e.jsx(Os,{})})]})})})})}ts.createRoot(document.getElementById("root")).render(e.jsx(Ot.StrictMode,{children:e.jsx(Fs,{})}));
